<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="在数据库领域，分级存储是一种常见的需求，即将一部分较旧的数据转存至本地其他磁盘卷（通常是更低速的磁盘卷）或对象存储方案中。较旧的数据（冷数据）通常不会被用户频繁查询或计算，但是存储在本地会占用大量磁盘资源，因此将不常用的数据存储在对象存储中，或将其从高速磁盘（如 SSD）转存至较低速的磁盘（如 HDD），可以有效节约资源开销。本文将介绍 DolphinDB 的分级存储功能的基本原理和如何使用。 ..."/><meta name="DC.rights.owner" content="(C) 版权 2024"/><meta name="copyright" content="(C) 版权 2024"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="分级存储"/><title>分级存储</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20240704100525325/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20240704100525325/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;分级存储&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;分级存储&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:12;25:83&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-简介&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;1. 简介&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;在数据库领域，分级存储是一种常见的需求，即将一部分较旧的数据转存至本地其他磁盘卷（通常是更低速的磁盘卷）或对象存储方案中。较旧的数据（冷数据）通常不会被用户频繁查询或计算，但是存储在本地会占用大量磁盘资源，因此将不常用的数据存储在对象存储中，或将其从高速磁盘（如 SSD）转存至较低速的磁盘（如 HDD），可以有效节约资源开销。本文将介绍 DolphinDB 的分级存储功能的基本原理和如何使用。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-使用介绍&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;2. 使用介绍&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-参数配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;2.1. 参数配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;在使用分级存储前，需要先配置相应的参数：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;13:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;冷数据磁盘卷配置项 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;13:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;coldVolumes&lt;/codeph&gt;&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;15:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;coldVolumes=file:/{your_local_path},s3://{your_bucket_name}/{s3_path_prefix}&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;我们使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;19:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;coldVolumes&lt;/codeph&gt; 配置项来指定存储冷数据的文件目录。该参数支持配置为本地路径（以 *file:/* 开头）或者 s3 路径（以 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;19:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;s3://&lt;/i&gt; 开头）。也可指定多个路径，路径间用逗号隔开。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;例如：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;coldVolumes=file://home/mypath/hdd/&amp;lt;ALIAS&amp;gt;,s3://bucket1/data/&amp;lt;ALIAS&amp;gt;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;注意&lt;/b&gt;：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;29:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;不同数据节点需要配置不同的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;29:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;coldVolumes&lt;/codeph&gt; 路径，否则可能会造成不同 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;29:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;datanode&lt;/codeph&gt; 间数据的相互覆盖。这里通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;29:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&amp;lt;ALIAS&amp;gt;&lt;/codeph&gt; 宏定义，让每个 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;29:85&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;datanode&lt;/codeph&gt; 将数据放到 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:2;29:102&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;/home/mypath/hdd/&lt;/i&gt; 目录下按照节点别名命名的目录中。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;31:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;如果您配置了 S3 路径，那么还需要配置 AWS S3 插件，以及 S3 的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;31:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;AccessKeyId&lt;/codeph&gt;，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;31:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;SecretAccessKey&lt;/codeph&gt;，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;31:72&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;Region&lt;/codeph&gt;, &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;31:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;EndPoint&lt;/codeph&gt; 等信息：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;33:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;pluginDir=plugins //指定节点的插件目录，需要将AWS S3插件放到plugins目录下 preloadModules=plugins::awss3 //系统启动后自动加载AWS S3插件 s3AccessKeyId={your_access_key_id} s3SecretAccessKey={your_access_screet_key} s3Region={your_s3_region} s3Endpoint={your_s3_Endpoint}&lt;/codeblock&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;有关配置的详情，参考：&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/db_distr_comp/cfg/cfg_para_ref.html#configparamref__tieredstoragesection&#34; scope=&#34;external&#34; xtrc=&#34;xref:1;42:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;?ditaot usertext?&gt;分级存储&lt;/xref&gt;。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;43:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;有关 AWS S3 插件的用法，参考：&lt;xref class=&#34;- topic/xref &#34; format=&#34;html&#34; href=&#34;https://docs.dolphindb.cn/zh/plugins/aws/aws.html&#34; scope=&#34;external&#34; xtrc=&#34;xref:2;43:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;?ditaot usertext?&gt;aws 插件&lt;/xref&gt; 。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-设置数据迁移范围&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;47:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;47:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;2.2. 设置数据迁移范围&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;47:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;49:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;在 DolphinDB 中，您可以使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;49:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;setRetentionPolicy&lt;/codeph&gt; 函数的参数 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:3;49:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;hoursToColdVolume&lt;/i&gt; 来配置数据的保留时间。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;51:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;假设在上文中，我们已经配置了 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;51:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;coldVolumes&lt;/codeph&gt;：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;coldVolumes=file://home/dolphindb/tiered_store/&amp;lt;ALIAS&amp;gt;&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;DolphinDB 通过数据的时间列来确定需要迁移的数据，所以需要对应的数据库存在时间分区的分区方案。首先，我们先创建一个时间列 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;57:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;VALUE&lt;/codeph&gt; 分区的数据库，并写入最近十五天的数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;db = database(&#34;dfs://db1&#34;, VALUE, (date(now()) - 14)..date(now())) //创建一个按照时间列VALUE分区的数据库 data = table((date(now()) - 14)..date(now()) as cdate, 1..15 as val) //创建一个table，时间列为最近15天 tbl = db.createPartitionedTable(data, &#34;table1&#34;, `cdate) tbl.append!(data)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;66:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;接着，我们使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;66:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;setRetentionPolicy&lt;/codeph&gt; 函数做如下配置：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;68:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;超过五天（120h）的数据将会被迁移至冷数据层，超过三十天（720h）的数据将会删除。因为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;68:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;database&lt;/codeph&gt; 只有一层 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;68:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;VALUE&lt;/codeph&gt; 分区，所以时间列分区维度为 0。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;70:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;setRetentionPolicy(db, 720, 0, 120)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;23-触发数据迁移&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;76:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;76:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;2.3. 触发数据迁移&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;76:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;78:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;设置之后，DolphinDB 会在后台每隔 1 小时检查并迁移范围内的数据。这里为了演示方便，我们使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;78:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;moveHotDataToColdVolume&lt;/codeph&gt;函数来手动触发迁移。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;80:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;pnodeRun(moveHotDataToColdVolume) //在每个datanode上执行函数，手动触发迁移&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;之后，DolphinDB 会发起最近 15 天到最近 7 天的分区的数据迁移任务。DolphinDB 使用原有的 recovery 机制实现数据的迁移，可以通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:18;84:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;getRecoveryTaskStatus&lt;/codeph&gt;函数来查看 recovery 任务的执行状态：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;rpc(getControllerAlias(), getRecoveryTaskStatus) //可以看到创建了最近15天到最近7天的数据迁移任务&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;可能的结果样式（省略某些列）：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;6&#34; xtrc=&#34;tgroup:1;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:4;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:5;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:6;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;92:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;92:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;TaskId&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;92:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;92:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;TaskType&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;92:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;92:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;ChunkPath&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:4;92:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;92:76&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;Source&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:5;92:88&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;92:89&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;Dest&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:6;92:99&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;92:100&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;Status&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;94:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;94:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:7;94:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;2059a13f-00d7-1c9e-a644-7a23ca7bbdc2&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:8;94:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;LoadRebalance&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:9;94:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;/db1/20230209/4&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:10;94:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;NODE0&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:11;94:88&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;NODE0&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:12;94:99&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;Finish&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:13;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;…&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:14;95:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;…&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:15;95:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;…&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:16;95:75&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;…&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:17;95:88&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;…&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:18;95:99&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;…&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:1;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;98:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;如果配置了多个 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:19;98:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;coldVolumes&lt;/codeph&gt;，会随机将分区迁往不同的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:20;98:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;coldVolumes&lt;/codeph&gt;。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;如果 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:21;99:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;coldVolumes&lt;/codeph&gt; 是本地路径，会使用文件拷贝的方式进行迁移。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;100:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;如果 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:22;100:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;coldVolumes&lt;/codeph&gt; 是 S3 路径，会使用 AWS S3 插件进行多线程的上传，速度相对于本地路径可能较慢。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;在迁移时，分区会暂时不可用。&lt;/li&gt;&lt;/ol&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;当 recovery 任务结束之后，已经被迁移的分区权限变为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:23;103:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;READ_ONLY&lt;/codeph&gt;，我们可以使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:24;103:51&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;select&lt;/codeph&gt; 语句进行查询，但是不能使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:25;103:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;update&lt;/codeph&gt;, &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:26;103:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;delete&lt;/codeph&gt;, &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:27;103:94&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;append!&lt;/codeph&gt; 等语句进行更新、删除或写入。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;select * from tbl where cdate = date(now()) - 10 //查询迁移后的数据 update tbl set val = 0 where cdate = date(now()) - 10 //更新迁移后的数据。会报错 “Writing to chunk {ChunkID} is not allowed.”&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;特殊地，我们使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:28;110:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;dropTable&lt;/codeph&gt;，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:29;110:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;dropParititon&lt;/codeph&gt;，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:30;110:38&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;dropDatabase&lt;/codeph&gt; 等 drop DDL 操作来进行数据的整体删除时，对象存储上对应的分区数据也会被删除。这里不再赘述。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;您可以使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:31;112:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;getClusterChunksStatus&lt;/codeph&gt; 函数查看对应分区的权限：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;rpc(getControllerAlias(), getClusterChunksStatus)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;118:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;可能的结果样式（省略了某些列）：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:2;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:7;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:8;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:9;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:19;120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;120:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;chunkId&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:20;120:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;120:42&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;file&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:21;120:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;120:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;permission&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:22;122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;ef23ce84-f455-06b7-6842-c85e46acdaac&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:23;122:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;/db1/20230216/4&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:24;122:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;READ_ONLY（已经被迁移的分区）&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:25;123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;260ab856-f796-4a87-3d4b-993632fb09d9&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:26;123:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;/db1/20230223/4&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:27;123:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;READ_WRITE（没有被迁移的分区）&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-机制介绍&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;3. 机制介绍&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-自动数据迁移触发机制&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;3.1. 自动数据迁移触发机制&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;129:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;131:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:32;131:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;setRetentionPolicy&lt;/codeph&gt; 函数设置好后，DolphinDB 会使用后台工作线程，每隔 1 小时按照数据库的时间分区检查在 [当前时间 - &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:4;131:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;hoursToColdVolume&lt;/i&gt; - 10 天，当前时间 - &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:5;131:116&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;hoursToColdVolume&lt;/i&gt;) 范围内是否存在需要被迁移的数据，如果存在，则触发数据迁移，生成对应的 recovery 任务。在触发时，工作线程可能不会一次性将所有的符合条件的分区全部迁移，而是以 DB 为单位，每隔一小时迁移一个 DB 下所有待迁移的数据，从而减少 recovery 的压力，提高可用性。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;133:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;举例来说，假设有两个 DB：&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:33;133:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;dfs://db1&lt;/codeph&gt;，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:34;133:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;dfs://db2&lt;/codeph&gt;。它们都按照时间分区。&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:6;133:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;hoursToColdVolume&lt;/i&gt; 设置 120h，即保留 5 天内的数据：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;135:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;在 2023.02.20 17:00 时，工作线程可能会将 db1 下所有 2023.02.05~2023.02.15（但不包含 02.15）的分区进行迁移。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;136:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;在 2023.02.20 18:00 时，可能会将 db2 下的所有 2023.02.05~2023.02.15（但不包含 02.15）的分区进行迁移。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;如果工作线程的检查覆盖完整的一天，会保证在 2023.02.20 这一天结束前将所有 db 的 2023.02.05~2023.02.15（但不包含 02.15）的分区进行迁移。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-数据迁移机制&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;3.2. 数据迁移机制&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;分级存储依托于 DolphinDB 的 recovery 机制，以分区为单位，将每个节点的分区副本迁移到低速磁盘或者 S3 对象存储中。数据迁移内部的大致流程：&lt;/p&gt;&lt;ol class=&#34;- topic/ol &#34; xtrc=&#34;ol:2;145:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;145:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;用户使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:35;145:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;setRetentionPolicy&lt;/codeph&gt; 函数设置 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:7;145:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;hoursToColdVolume&lt;/i&gt; 来配置数据的保留时间。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;DolphinDB 后台线程根据时间分区检查需要被迁移的数据，创建 recovery 任务。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;147:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;执行 recovery 任务，上传或拷贝对应的数据文件到对应的 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:8;147:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;S3/&lt;/i&gt; 本地路径。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;修改分区元数据，更新分区路径，修改分区权限为 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:36;148:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;READ_ONLY&lt;/codeph&gt;。&lt;/li&gt;&lt;/ol&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;33-数据读取机制&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;150:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;150:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;3.3. 数据读取机制&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;150:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;当使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:37;152:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;select&lt;/codeph&gt; 语句读取数据时，如果对应的分区文件位于 S3 上，我们会使用 S3 插件的相关 API 来代替本地文件 API 来进行数据读取、获取文件长度、获取目录下的所有文件等文件操作，其余读取流程与正常的引擎读取流程一致。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;154:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;因为 S3 的网络请求相比于本地磁盘读取过于慢，且保存到 S3 上的文件不会被修改。基于此，DolphinDB 将文件长度等部分元数据以及读取的文件数据存入缓存。如果读取的数据已经被缓存，则不需要再通过 S3 文件 API 创建网络请求，而是从缓存中读取返回，从而节省了昂贵的网络开销。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-总结&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;4. 总结&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;156:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;158:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;DolphinDB 的分级存储功能，能够将冷数据定期迁移至低速磁盘或云端，同时支持 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:38;158:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/hierarchical_storage.md&#34;&gt;select&lt;/codeph&gt; 语句进行正常的读取、计算，能够满足金融及物联网用户节省高速存储资源、降低无谓资源开销的需求。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/hierarchical_storage.md"/><meta name="wh-out-relpath" content="tutorials/hierarchical_storage.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20240704100525"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20240704100525"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="分级存储" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://www.dolphindb.cn" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>

            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/DolphinDB_TopN.html">数据库</a></div></div></li><li class="active"><div class="topicref" data-id="分级存储"><div class="title"><a href="../tutorials/hierarchical_storage.html">分级存储</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="new_chap_about_sect_ddb_docs_intro-d9529e87" class="topicref" data-id="new_chap_about_sect_ddb_docs_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_docs_intro.html" id="new_chap_about_sect_ddb_docs_intro-d9529e87-link">文档使用说明</a><div class="wh-tooltip"><p class="shortdesc">如何获取 DolphinDB 帮助信息</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap1_getstarted-d9529e140" class="topicref" data-id="chap1_getstarted" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap1_getstarted-d9529e140-link" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9529e140-link"><span class="keyword label">快速上手</span></a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9529e335" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9529e335-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9529e335-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9529e2313" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9529e2313-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9529e2313-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9529e3490" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9529e3490-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9529e3490-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e7385" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e7385-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9529e7385-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9529e7812" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9529e7812-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9529e7812-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9529e16490" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9529e16490-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9529e16490-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9529e26503" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9529e26503-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9529e26503-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9529e86456" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9529e86456-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9529e86456-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9529e91976" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9529e91976-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9529e91976-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9529e94749" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9529e94749-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9529e94749-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9529e94980" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9529e94980-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9529e94980-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e95033" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e95033-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/import_data.html" id="tocId-d9529e95033-link">数据导入</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9529e95264" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9529e95264-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DolphinDB_TopN.html" id="tocId-d9529e95264-link">数据库</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="topn-系列函数-d9529e95265" class="topicref" data-id="topn-系列函数" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DolphinDB_TopN.html" id="topn-系列函数-d9529e95265-link">TopN 系列函数</a></div></div></li><li role="treeitem"><div data-tocid="tsdb-存储引擎简介-d9529e95311" class="topicref" data-id="tsdb-存储引擎简介" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tsdb_engine.html" id="tsdb-存储引擎简介-d9529e95311-link">TSDB 存储引擎简介</a></div></div></li><li role="treeitem"><div data-tocid="tsdb-存储引擎详解-d9529e95357" class="topicref" data-id="tsdb-存储引擎详解" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tsdb_explained.html" id="tsdb-存储引擎详解-d9529e95357-link">TSDB 存储引擎详解</a></div></div></li><li role="treeitem"><div data-tocid="数据库分区-d9529e95403" class="topicref" data-id="数据库分区" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database.html" id="数据库分区-d9529e95403-link">数据库分区</a></div></div></li><li role="treeitem"><div data-tocid="分布式表数据更新原理和性能-d9529e95449" class="topicref" data-id="分布式表数据更新原理和性能" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphindb_update.html" id="分布式表数据更新原理和性能-d9529e95449-link">分布式表数据更新原理和性能</a></div></div></li><li role="treeitem" class="active"><div data-tocid="分级存储-d9529e95495" class="topicref" data-id="分级存储" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hierarchical_storage.html" id="分级存储-d9529e95495-link">分级存储</a></div></div></li><li role="treeitem"><div data-tocid="sql-标准化-d9529e95541" class="topicref" data-id="sql-标准化" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/std_sql_ddb.html" id="sql-标准化-d9529e95541-link">SQL 标准化</a></div></div></li><li role="treeitem"><div data-tocid="redo-log-和-cache-engine-d9529e95587" class="topicref" data-id="redo-log-和-cache-engine" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/redoLog_cacheEngine.html" id="redo-log-和-cache-engine-d9529e95587-link">redo log 和 cache engine</a></div></div></li><li role="treeitem"><div data-tocid="debezium--kafka-实时同步-mysql-数据到-dolphindb-d9529e95633" class="topicref" data-id="debezium--kafka-实时同步-mysql-数据到-dolphindb" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Debezium_and_Kafka_data_sync.html" id="debezium--kafka-实时同步-mysql-数据到-dolphindb-d9529e95633-link">Debezium + Kafka 实时同步 MySQL 数据到 DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb-d9529e95679" class="topicref" data-id="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Debezium_Kafka_Oracle_sync.html" id="debeziumkafka-实时同步-oracle-11g-数据到-dolphindb-d9529e95679-link">Debezium+Kafka 实时同步 Oracle 11g 数据到 DolphinDB</a></div></div></li><li role="treeitem"><div data-tocid="使用-summary-函数生成大规模数据统计信息-d9529e95725" class="topicref" data-id="使用-summary-函数生成大规模数据统计信息" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/generate_large_scale_statistics_with_summary.html" id="使用-summary-函数生成大规模数据统计信息-d9529e95725-link">使用 summary 函数生成大规模数据统计信息</a></div></div></li><li role="treeitem"><div data-tocid="软删除-d9529e95772" class="topicref" data-id="软删除" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/soft_delete.html" id="软删除-d9529e95772-link">软删除</a></div></div></li><li role="treeitem"><div data-tocid="建库建表最容易忽略的十个细节-d9529e95818" class="topicref" data-id="建库建表最容易忽略的十个细节" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/database_and_table_creation_details.html" id="建库建表最容易忽略的十个细节-d9529e95818-link">建库建表最容易忽略的十个细节</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-catalog-使用教程-d9529e95864" class="topicref" data-id="dolphindb-catalog-使用教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/catalog.html" id="dolphindb-catalog-使用教程-d9529e95864-link">DolphinDB Catalog 使用教程</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e95910" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e95910-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/memory_management.html" id="tocId-d9529e95910-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e96325" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e96325-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hybrid_programming_paradigms.html" id="tocId-d9529e96325-link">编程语言</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e97155" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e97155-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/data_sync_among_clusters.html" id="tocId-d9529e97155-link">安全与容灾</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e97386" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e97386-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_tutorial.html" id="tocId-d9529e97386-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e97893" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e97893-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DECIMAL.html" id="tocId-d9529e97893-link">数值处理</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_modules-d9529e97986" class="topicref" data-id="chap7_tutorials_modules" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_modules-d9529e97986-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="chap7_tutorials_modules-d9529e97986-link"><span class="keyword label">模块</span></a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="plugins_apply-d9529e98493" class="topicref" data-id="plugins_apply" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action plugins_apply-d9529e98493-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/plugins_apply.html" id="plugins_apply-d9529e98493-link">插件应用</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e98631" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e98631-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphinscheduler_integration.html" id="tocId-d9529e98631-link">金融场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e100707" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e100707-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/iot_examples.html" id="tocId-d9529e100707-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e101629" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e101629-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/cluster_scaleout_perf_test.html" id="tocId-d9529e101629-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e101769" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e101769-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_1.html" id="tocId-d9529e101769-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">分级存储</h1><div class="- topic/body body"></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-简介"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 简介</h2><div class="- topic/body body"><p class="- topic/p p">在数据库领域，分级存储是一种常见的需求，即将一部分较旧的数据转存至本地其他磁盘卷（通常是更低速的磁盘卷）或对象存储方案中。较旧的数据（冷数据）通常不会被用户频繁查询或计算，但是存储在本地会占用大量磁盘资源，因此将不常用的数据存储在对象存储中，或将其从高速磁盘（如 SSD）转存至较低速的磁盘（如 HDD），可以有效节约资源开销。本文将介绍 DolphinDB 的分级存储功能的基本原理和如何使用。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title3" id="2-使用介绍"><h2 class="- topic/title title topictitle2" id="ariaid-title3">2. 使用介绍</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="21-参数配置"><h3 class="- topic/title title topictitle3" id="ariaid-title4">2.1. 参数配置</h3><div class="- topic/body body"><p class="- topic/p p">在使用分级存储前，需要先配置相应的参数：</p><p class="- topic/p p">冷数据磁盘卷配置项 <code class="+ topic/ph pr-d/codeph ph codeph">coldVolumes</code></p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>coldVolumes=file:/{your_local_path},s3://{your_bucket_name}/{s3_path_prefix}</code></pre><p class="- topic/p p">我们使用 <code class="+ topic/ph pr-d/codeph ph codeph">coldVolumes</code> 配置项来指定存储冷数据的文件目录。该参数支持配置为本地路径（以 *file:/* 开头）或者 s3 路径（以 <em class="+ topic/ph hi-d/i ph i">s3://</em> 开头）。也可指定多个路径，路径间用逗号隔开。</p><p class="- topic/p p">例如：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>coldVolumes=file://home/mypath/hdd/&lt;ALIAS&gt;,s3://bucket1/data/&lt;ALIAS&gt;</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>：</p><p class="- topic/p p">不同数据节点需要配置不同的 <code class="+ topic/ph pr-d/codeph ph codeph">coldVolumes</code> 路径，否则可能会造成不同 <code class="+ topic/ph pr-d/codeph ph codeph">datanode</code> 间数据的相互覆盖。这里通过 <code class="+ topic/ph pr-d/codeph ph codeph">&lt;ALIAS&gt;</code> 宏定义，让每个 <code class="+ topic/ph pr-d/codeph ph codeph">datanode</code> 将数据放到 <em class="+ topic/ph hi-d/i ph i">/home/mypath/hdd/</em> 目录下按照节点别名命名的目录中。</p><p class="- topic/p p">如果您配置了 S3 路径，那么还需要配置 AWS S3 插件，以及 S3 的 <code class="+ topic/ph pr-d/codeph ph codeph">AccessKeyId</code>，<code class="+ topic/ph pr-d/codeph ph codeph">SecretAccessKey</code>，<code class="+ topic/ph pr-d/codeph ph codeph">Region</code>, <code class="+ topic/ph pr-d/codeph ph codeph">EndPoint</code> 等信息：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>pluginDir=plugins //指定节点的插件目录，需要将AWS S3插件放到plugins目录下
preloadModules=plugins::awss3 //系统启动后自动加载AWS S3插件
s3AccessKeyId={your_access_key_id}
s3SecretAccessKey={your_access_screet_key}
s3Region={your_s3_region}
s3Endpoint={your_s3_Endpoint}</code></pre><ul class="- topic/ul ul"><li class="- topic/li li">有关配置的详情，参考：<a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/db_distr_comp/cfg/cfg_para_ref.html#configparamref__tieredstoragesection" target="_blank" rel="external noopener">分级存储</a>。</li><li class="- topic/li li">有关 AWS S3 插件的用法，参考：<a class="- topic/xref xref" href="https://docs.dolphindb.cn/zh/plugins/aws/aws.html" target="_blank" rel="external noopener">aws 插件</a> 。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="22-设置数据迁移范围"><h3 class="- topic/title title topictitle3" id="ariaid-title5">2.2. 设置数据迁移范围</h3><div class="- topic/body body"><p class="- topic/p p">在 DolphinDB 中，您可以使用 <code class="+ topic/ph pr-d/codeph ph codeph">setRetentionPolicy</code> 函数的参数 <em class="+ topic/ph hi-d/i ph i">hoursToColdVolume</em> 来配置数据的保留时间。</p><p class="- topic/p p">假设在上文中，我们已经配置了 <code class="+ topic/ph pr-d/codeph ph codeph">coldVolumes</code>：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>coldVolumes=file://home/dolphindb/tiered_store/&lt;ALIAS&gt;</code></pre><p class="- topic/p p">DolphinDB 通过数据的时间列来确定需要迁移的数据，所以需要对应的数据库存在时间分区的分区方案。首先，我们先创建一个时间列 <code class="+ topic/ph pr-d/codeph ph codeph">VALUE</code> 分区的数据库，并写入最近十五天的数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>db = database("dfs://db1", VALUE, (date(now()) - 14)..date(now())) //创建一个按照时间列VALUE分区的数据库
data = table((date(now()) - 14)..date(now()) as cdate, 1..15 as val) //创建一个table，时间列为最近15天
tbl = db.createPartitionedTable(data, "table1", `cdate)
tbl.append!(data)</code></pre><p class="- topic/p p">接着，我们使用 <code class="+ topic/ph pr-d/codeph ph codeph">setRetentionPolicy</code> 函数做如下配置：</p><p class="- topic/p p">超过五天（120h）的数据将会被迁移至冷数据层，超过三十天（720h）的数据将会删除。因为 <code class="+ topic/ph pr-d/codeph ph codeph">database</code> 只有一层 <code class="+ topic/ph pr-d/codeph ph codeph">VALUE</code> 分区，所以时间列分区维度为 0。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>setRetentionPolicy(db, 720, 0, 120)</code></pre></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="23-触发数据迁移"><h3 class="- topic/title title topictitle3" id="ariaid-title6">2.3. 触发数据迁移</h3><div class="- topic/body body"><p class="- topic/p p">设置之后，DolphinDB 会在后台每隔 1 小时检查并迁移范围内的数据。这里为了演示方便，我们使用 <code class="+ topic/ph pr-d/codeph ph codeph">moveHotDataToColdVolume</code>函数来手动触发迁移。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>pnodeRun(moveHotDataToColdVolume) //在每个datanode上执行函数，手动触发迁移</code></pre><p class="- topic/p p">之后，DolphinDB 会发起最近 15 天到最近 7 天的分区的数据迁移任务。DolphinDB 使用原有的 recovery 机制实现数据的迁移，可以通过 <code class="+ topic/ph pr-d/codeph ph codeph">getRecoveryTaskStatus</code>函数来查看 recovery 任务的执行状态：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), getRecoveryTaskStatus) //可以看到创建了最近15天到最近7天的数据迁移任务</code></pre><p class="- topic/p p">可能的结果样式（省略某些列）：</p><div class="table-container"><table class="- topic/table table" data-cols="6"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-触发数据迁移__entry__1"><strong class="+ topic/ph hi-d/b ph b">TaskId</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-触发数据迁移__entry__2"><strong class="+ topic/ph hi-d/b ph b">TaskType</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-触发数据迁移__entry__3"><strong class="+ topic/ph hi-d/b ph b">ChunkPath</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-触发数据迁移__entry__4"><strong class="+ topic/ph hi-d/b ph b">Source</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-触发数据迁移__entry__5"><strong class="+ topic/ph hi-d/b ph b">Dest</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-触发数据迁移__entry__6"><strong class="+ topic/ph hi-d/b ph b">Status</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__1">2059a13f-00d7-1c9e-a644-7a23ca7bbdc2</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__2">LoadRebalance</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__3">/db1/20230209/4</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__4">NODE0</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__5">NODE0</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__6">Finish</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__1">…</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__2">…</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__3">…</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__4">…</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__5">…</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__6">…</td></tr></tbody></table></div><ol class="- topic/ol ol"><li class="- topic/li li">如果配置了多个 <code class="+ topic/ph pr-d/codeph ph codeph">coldVolumes</code>，会随机将分区迁往不同的 <code class="+ topic/ph pr-d/codeph ph codeph">coldVolumes</code>。</li><li class="- topic/li li">如果 <code class="+ topic/ph pr-d/codeph ph codeph">coldVolumes</code> 是本地路径，会使用文件拷贝的方式进行迁移。</li><li class="- topic/li li">如果 <code class="+ topic/ph pr-d/codeph ph codeph">coldVolumes</code> 是 S3 路径，会使用 AWS S3 插件进行多线程的上传，速度相对于本地路径可能较慢。</li><li class="- topic/li li">在迁移时，分区会暂时不可用。</li></ol><p class="- topic/p p">当 recovery 任务结束之后，已经被迁移的分区权限变为 <code class="+ topic/ph pr-d/codeph ph codeph">READ_ONLY</code>，我们可以使用 <code class="+ topic/ph pr-d/codeph ph codeph">select</code> 语句进行查询，但是不能使用 <code class="+ topic/ph pr-d/codeph ph codeph">update</code>, <code class="+ topic/ph pr-d/codeph ph codeph">delete</code>, <code class="+ topic/ph pr-d/codeph ph codeph">append!</code> 等语句进行更新、删除或写入。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select * from tbl where cdate = date(now()) - 10 //查询迁移后的数据
update tbl set val = 0 where cdate = date(now()) - 10 //更新迁移后的数据。会报错 “Writing to chunk {ChunkID} is not allowed.”</code></pre><p class="- topic/p p">特殊地，我们使用 <code class="+ topic/ph pr-d/codeph ph codeph">dropTable</code>，<code class="+ topic/ph pr-d/codeph ph codeph">dropParititon</code>，<code class="+ topic/ph pr-d/codeph ph codeph">dropDatabase</code> 等 drop DDL 操作来进行数据的整体删除时，对象存储上对应的分区数据也会被删除。这里不再赘述。</p><p class="- topic/p p">您可以使用 <code class="+ topic/ph pr-d/codeph ph codeph">getClusterChunksStatus</code> 函数查看对应分区的权限：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), getClusterChunksStatus)</code></pre><p class="- topic/p p">可能的结果样式（省略了某些列）：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-触发数据迁移__entry__19"><strong class="+ topic/ph hi-d/b ph b">chunkId</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-触发数据迁移__entry__20"><strong class="+ topic/ph hi-d/b ph b">file</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="23-触发数据迁移__entry__21"><strong class="+ topic/ph hi-d/b ph b">permission</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__19">ef23ce84-f455-06b7-6842-c85e46acdaac</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__20">/db1/20230216/4</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__21">READ_ONLY（已经被迁移的分区）</td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__19">260ab856-f796-4a87-3d4b-993632fb09d9</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__20">/db1/20230223/4</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="23-触发数据迁移__entry__21">READ_WRITE（没有被迁移的分区）</td></tr></tbody></table></div></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title7" id="3-机制介绍"><h2 class="- topic/title title topictitle2" id="ariaid-title7">3. 机制介绍</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title8" id="31-自动数据迁移触发机制"><h3 class="- topic/title title topictitle3" id="ariaid-title8">3.1. 自动数据迁移触发机制</h3><div class="- topic/body body"><p class="- topic/p p">使用 <code class="+ topic/ph pr-d/codeph ph codeph">setRetentionPolicy</code> 函数设置好后，DolphinDB 会使用后台工作线程，每隔 1 小时按照数据库的时间分区检查在 [当前时间 - <em class="+ topic/ph hi-d/i ph i">hoursToColdVolume</em> - 10 天，当前时间 - <em class="+ topic/ph hi-d/i ph i">hoursToColdVolume</em>) 范围内是否存在需要被迁移的数据，如果存在，则触发数据迁移，生成对应的 recovery 任务。在触发时，工作线程可能不会一次性将所有的符合条件的分区全部迁移，而是以 DB 为单位，每隔一小时迁移一个 DB 下所有待迁移的数据，从而减少 recovery 的压力，提高可用性。</p><p class="- topic/p p">举例来说，假设有两个 DB：<code class="+ topic/ph pr-d/codeph ph codeph">dfs://db1</code>，<code class="+ topic/ph pr-d/codeph ph codeph">dfs://db2</code>。它们都按照时间分区。<em class="+ topic/ph hi-d/i ph i">hoursToColdVolume</em> 设置 120h，即保留 5 天内的数据：</p><ul class="- topic/ul ul"><li class="- topic/li li">在 2023.02.20 17:00 时，工作线程可能会将 db1 下所有 2023.02.05~2023.02.15（但不包含 02.15）的分区进行迁移。</li><li class="- topic/li li">在 2023.02.20 18:00 时，可能会将 db2 下的所有 2023.02.05~2023.02.15（但不包含 02.15）的分区进行迁移。</li><li class="- topic/li li">如果工作线程的检查覆盖完整的一天，会保证在 2023.02.20 这一天结束前将所有 db 的 2023.02.05~2023.02.15（但不包含 02.15）的分区进行迁移。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="32-数据迁移机制"><h3 class="- topic/title title topictitle3" id="ariaid-title9">3.2. 数据迁移机制</h3><div class="- topic/body body"><p class="- topic/p p">分级存储依托于 DolphinDB 的 recovery 机制，以分区为单位，将每个节点的分区副本迁移到低速磁盘或者 S3 对象存储中。数据迁移内部的大致流程：</p><ol class="- topic/ol ol"><li class="- topic/li li">用户使用 <code class="+ topic/ph pr-d/codeph ph codeph">setRetentionPolicy</code> 函数设置 <em class="+ topic/ph hi-d/i ph i">hoursToColdVolume</em> 来配置数据的保留时间。</li><li class="- topic/li li">DolphinDB 后台线程根据时间分区检查需要被迁移的数据，创建 recovery 任务。</li><li class="- topic/li li">执行 recovery 任务，上传或拷贝对应的数据文件到对应的 <em class="+ topic/ph hi-d/i ph i">S3/</em> 本地路径。</li><li class="- topic/li li">修改分区元数据，更新分区路径，修改分区权限为 <code class="+ topic/ph pr-d/codeph ph codeph">READ_ONLY</code>。</li></ol></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title10" id="33-数据读取机制"><h3 class="- topic/title title topictitle3" id="ariaid-title10">3.3. 数据读取机制</h3><div class="- topic/body body"><p class="- topic/p p">当使用 <code class="+ topic/ph pr-d/codeph ph codeph">select</code> 语句读取数据时，如果对应的分区文件位于 S3 上，我们会使用 S3 插件的相关 API 来代替本地文件 API 来进行数据读取、获取文件长度、获取目录下的所有文件等文件操作，其余读取流程与正常的引擎读取流程一致。</p><p class="- topic/p p">因为 S3 的网络请求相比于本地磁盘读取过于慢，且保存到 S3 上的文件不会被修改。基于此，DolphinDB 将文件长度等部分元数据以及读取的文件数据存入缓存。如果读取的数据已经被缓存，则不需要再通过 S3 文件 API 创建网络请求，而是从缓存中读取返回，从而节省了昂贵的网络开销。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title11" id="4-总结"><h2 class="- topic/title title topictitle2" id="ariaid-title11">4. 总结</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 的分级存储功能，能够将冷数据定期迁移至低速磁盘或云端，同时支持 <code class="+ topic/ph pr-d/codeph ph codeph">select</code> 语句进行正常的读取、计算，能够满足金融及物联网用户节省高速存储资源、降低无谓资源开销的需求。</p></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E7%AE%80%E4%BB%8B" data-tocid="1-简介">1. 简介</a></li><li class="topic-item"><a href="#2-%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D" data-tocid="2-使用介绍">2. 使用介绍</a><ul><li class="topic-item"><a href="#21-%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE" data-tocid="21-参数配置">2.1. 参数配置</a></li><li class="topic-item"><a href="#22-%E8%AE%BE%E7%BD%AE%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E8%8C%83%E5%9B%B4" data-tocid="22-设置数据迁移范围">2.2. 设置数据迁移范围</a></li><li class="topic-item"><a href="#23-%E8%A7%A6%E5%8F%91%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB" data-tocid="23-触发数据迁移">2.3. 触发数据迁移</a></li></ul></li><li class="topic-item"><a href="#3-%E6%9C%BA%E5%88%B6%E4%BB%8B%E7%BB%8D" data-tocid="3-机制介绍">3. 机制介绍</a><ul><li class="topic-item"><a href="#31-%E8%87%AA%E5%8A%A8%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6" data-tocid="31-自动数据迁移触发机制">3.1. 自动数据迁移触发机制</a></li><li class="topic-item"><a href="#32-%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E6%9C%BA%E5%88%B6" data-tocid="32-数据迁移机制">3.2. 数据迁移机制</a></li><li class="topic-item"><a href="#33-%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96%E6%9C%BA%E5%88%B6" data-tocid="33-数据读取机制">3.3. 数据读取机制</a></li></ul></li><li class="topic-item"><a href="#4-%E6%80%BB%E7%BB%93" data-tocid="4-总结">4. 总结</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2024 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>