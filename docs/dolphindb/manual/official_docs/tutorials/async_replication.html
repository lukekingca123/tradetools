<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="异步复制是进行集群间数据同步的一种方式。在金融交易、物联网、互联网/移动互联网等应用场景中，复杂的业务对数据一致性和可靠性提出了极高的要求。与同步复制相比，异步复制网络延迟更低、吞吐量更高、故障风险更小。 DolphinDB 提供的异步复制功能通过异步方式，将主集群复制到从集群，使主从集群数据一致，是集群异地容灾的一个解决方案。 ..."/><meta name="DC.rights.owner" content="(C) 版权 2024"/><meta name="copyright" content="(C) 版权 2024"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="集群间异步复制"/><title>集群间异步复制</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20240704100525325/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20240704100525325/tutorials/?&gt;&lt;?path2project ../?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;集群间异步复制&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;集群间异步复制&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;异步复制是进行集群间数据同步的一种方式。在金融交易、物联网、互联网/移动互联网等应用场景中，复杂的业务对数据一致性和可靠性提出了极高的要求。与同步复制相比，异步复制网络延迟更低、吞吐量更高、故障风险更小。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;DolphinDB 提供的异步复制功能通过异步方式，将主集群复制到从集群，使主从集群数据一致，是集群异地容灾的一个解决方案。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;传统集群间的异步复制可能导致数据不一致、丢失或冲突。与传统集群间的异步复制解决方案相比，DolphinDB 具有以下优势：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;容错性强。节点宕机不会造成数据丢失，主从集群数据最终会保持一致。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;10:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;运维便捷。提供在线监控函数以及错误修复函数。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;12:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;本教程将从以下几方面对 DolphinDB 的异步复制方案进行介绍：&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:50;71:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-概述&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;1. 概述&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;11-原理&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;1.1. 原理&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;20:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;使用异步复制功能时，原集群称为主集群，目的集群称为从集群。当前主集群的控制节点会在处理事务时收集相关信息，生成异步复制任务并放到主集群的队列中。同时从集群的控制节点定时从主集群的队列中拉取任务，放到从集群的队列中等待执行。从集群队列中的任务会被划分为不同的组，执行时在组间依次进行，同一组中的任务根据哈希算法被分配到不同的数据节点中并发执行。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;22:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;异步复制通过各种机制保证数据的一致性，但主集群数据节点的宕机仍可能导致数据丢失。在这种情况下，可以通过开启同步持久化来保证数据一致（见 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#主集群配置&#34; xtrc=&#34;xref:1;22:69&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;?ditaot usertext?&gt;主集群配置&lt;/xref&gt; 小节）。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;12-支持性&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;1.2. 支持性&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;26:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;28:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;异步复制功能目前支持分布式表；支持 DDL（Data Definition Language）/ DML（Data Manipulation Languange）操作；支持在数据库层面上开启或关闭异步复制功能。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-环境配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;2. 环境配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;32:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;本教程使用两个高可用集群作为示例，架构如下图：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Asynchronous_Replication/2_1.png&#34; width=&#34;70%&#34; xtrc=&#34;image:1;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; dita-ot:image-width=&#34;904&#34; dita-ot:image-height=&#34;384&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;集群间的异步复制支持一个主集群，多个从集群。用户在使用异步复制功能时需要至少部署两个集群，集群类型可为单服务器集群、多服务器集群以及高可用集群。关于如何部署集群请参考&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;single_machine_cluster_deploy.md&#34; xtrc=&#34;xref:2;38:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;单服务器集群部署&lt;/xref&gt;、&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;multi_machine_cluster_deployment.md&#34; xtrc=&#34;xref:3;38:129&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;多服务器集群部署&lt;/xref&gt;、&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;ha_cluster_deployment.md&#34; xtrc=&#34;xref:4;38:177&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;高可用集群部署&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;40:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;本教程假定主集群配置文件位于 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;40:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;/dolphindb/server/cluster1/config&lt;/i&gt; 目录下，从集群配置文件位于 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:2;40:66&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;/dolphindb/server/cluster2/config&lt;/i&gt; 目录下。与异步复制相关的配置项请参考&lt;xref class=&#34;- topic/xref &#34; href=&#34;../db_distr_comp/cfg/cfg_para_ref.dita&#34; xtrc=&#34;xref:5;40:120&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;集群间的异步复制配置项&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-主集群配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;2.1. 主集群配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;42:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;44:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;以 P1 服务器为例，首先登录 P1 服务器，进入 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:3;44:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;/dolphindb/server/cluster1/config&lt;/i&gt; 目录。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;46:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;46:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;46:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;控制节点配置&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;48:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;执行以下 Shell 命令修改 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:4;48:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;controller.cfg&lt;/i&gt; 配置文件：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;50:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;vim ./controller.cfg&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;54:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;添加如下配置项参数：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;56:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;clusterReplicationSlaveNum=1&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;60:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:5;60:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;clusterReplicationSlaveNum&lt;/i&gt; 指定允许配置的从集群数量上限，本教程中从集群数量为1。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;62:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;62:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;62:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;数据节点配置&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;64:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;执行以下 Shell 命令修改 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:6;64:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;cluster.cfg&lt;/i&gt; 配置文件：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;66:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;vim ./cluster.cfg&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;70:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;添加如下配置项参数：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;72:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;clusterReplicationMode=master clusterReplicationWorkDir=/dolphindb/server/cluster1/replication clusterReplicationSyncPersistence=false&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;78:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:7;78:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;clusterReplicationSyncPersistence&lt;/i&gt; 指定是否开启任务数据的同步持久化，默认为 false，表示持久化异步进行。在这种状态下，主集群数据节点的宕机可能导致数据丢失。可以指定 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:8;78:109&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;clusterReplicationSyncPersistence&lt;/i&gt; 的值为 true 开启同步持久化，以确保数据的一致性。但请注意，开启同步持久化之后，主集群的事务效率会降低。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;80:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;在完成 P1 服务器的配置之后，请同步修改主集群中其它服务器的配置。在本例中，这表示 P2 和 P3 服务器的配置同样需要按照以上操作进行修改。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-从集群配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;2.2. 从集群配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;82:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;84:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;以 P1 服务器为例，首先登录 P1 服务器，进入 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:9;84:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;/dolphindb/server/cluster2/confi&lt;/i&gt;g 目录。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;86:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;86:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;86:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;控制节点配置&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;88:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;执行以下 Shell 命令修改 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:10;88:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;controller.cfg&lt;/i&gt; 配置文件：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;90:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;vim ./controller.cfg&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;94:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;添加如下配置项参数：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;96:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;clusterReplicationMasterCtl=10.0.0.1:8848&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;100:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:11;100:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;clusterReplicationMasterCtl&lt;/i&gt; 指定主集群控制节点。若主集群为高可用集群，则指定为控制节点 raft 组中的任意节点即可。在本例中指定 P1 服务器中的控制节点。&lt;/p&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;102:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;102:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;数据节点配置&lt;/b&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;104:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;执行以下 Shell 命令修改 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:12;104:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;cluster.cfg 配置文件：&lt;/i&gt;&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;106:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;vim ./cluster.cfg&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;110:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;添加如下配置项参数：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;112:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;clusterReplicationMode=slave clusterReplicationExecutionUsername=admin clusterReplicationExecutionPassword=123456&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;118:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;在配置中指定了用于执行集群间异步复制的用户名和密码。&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;118:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;必须确保该用户有事务操作的相关权限&lt;/b&gt;，即对于主集群上执行的操作，该用户在从集群上同样有执行的权限，否则异步复制任务会失败。关于 DolphinDB 权限的具体介绍请参考：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;ACL_and_Security.md&#34; xtrc=&#34;xref:6;118:119&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;用户权限管理&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;120:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;在完成以上配置之后，请同步修改从集群中其它服务器的配置。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-使用异步复制&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;3. 使用异步复制&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;124:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;接下来通过一个例子介绍如何使用 DolphinDB 集群间的异步复制功能。首先，在主集群和从集群中各选择一个数据节点（以下分别使用 dataNodeMaster 和 dataNodeSlave 表示），打开对应的交互编程界面。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-开启集群间异步复制&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;126:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;126:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;3.1. 开启集群间异步复制&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;126:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;128:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;在 dataNodeMaster 的交互编程界面执行以下语句创建数据库：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;130:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;// 创建存储的数据库 login(&#34;admin&#34;, &#34;123456&#34;) dbName = &#34;dfs://testDB&#34; if(existsDatabase(dbName)){ dropDatabase(dbName) } db = database(dbName, VALUE, 2023.01.01..2023.12.31)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;140:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;集群异步复制状态共三种：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;142:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;142:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;ENABLED，开启状态，集群的默认状态；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;DISABLED，关闭状态，用户手动停止了异步复制任务或配置中未包括异步复制相关配置项；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;144:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;STOPPED，停止状态，从集群任务执行失败 30 次后将转为该状态。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;146:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;在集群启动时异步复制状态默认为 &#34;ENABLED&#34;，但集群中新创建的数据库默认关闭异步复制功能，因此需要在 dataNodeMaster 的交互编程界面执行以下语句开启新建数据库的异步复制功能：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;148:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;setDatabaseForClusterReplication(db, true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;152:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;执行以下语句以确认数据库的异步复制是否开启：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;154:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;schema(db).clusterReplicationEnabled&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;158:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;若执行结果返回 true，则说明异步复制功能已启用。也可以通过 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getDatabaseClusterReplicationStatus.dita&#34; xtrc=&#34;xref:7;158:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getDatabaseClusterReplicationStatus&lt;/xref&gt; 查看所有数据库的异步复制开启状态，但请注意，使用该函数的前提是数据库中存在数据。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;160:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;getDatabaseClusterReplicationStatus()&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;164:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;查询结果如下，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;164:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;dbName&lt;/b&gt; 表示库名，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;164:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;enabled&lt;/b&gt; 表示开启状态。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Asynchronous_Replication/3_1.png&#34; width=&#34;20%&#34; xtrc=&#34;image:2;166:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; dita-ot:image-width=&#34;200&#34; dita-ot:image-height=&#34;60&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-查询异步复制状态&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;168:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;168:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;3.2. 查询异步复制状态&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;168:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;170:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;在 dataNodeMaster 的交互编程界面执行以下语句创建分区表：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;172:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;// 创建分区表 tbName = &#34;testTB&#34; colNames = `SecurityID`DateTime`PreClosePx`OpenPx`HighPx`LowPx`LastPx`Volume`Amount colTypes = [SYMBOL, DATETIME, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, INT, DOUBLE] schemaTable = table(1:0, colNames, colTypes) db.createPartitionedTable(table=schemaTable, tableName=tbName, partitionColumns=`DateTime)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;181:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;为了确认在主集群中创建库表后，从集群复制了主集群的库表信息，在 dataNodeSlave 的交互编程界面执行以下语句：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;183:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;loadTable(&#34;dfs://testDB&#34;, &#34;testTB&#34;)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;187:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;函数执行成功说明从集群中成功创建了数据库 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;187:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;dfs://testDB&lt;/codeph&gt; 和表 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;187:40&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;testTB&lt;/codeph&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;189:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;接着在 dataNodeMaster 执行以下语句，模拟生成 5000 个股票 1 天的 1 分钟 K 线数据：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;191:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;// 模拟数据并写入分区表 n = 1210000 randPrice = round(10+rand(1.0, 100), 2) randVolume = 100+rand(100, 100) SecurityID = lpad(string(take(0..4999, 5000)), 6, `0) DateTime = (2023.01.08T09:30:00 + take(0..120, 121)*60).join(2023.01.08T13:00:00 + take(0..120, 121)*60) PreClosePx = rand(randPrice, n) OpenPx = rand(randPrice, n) HighPx = rand(randPrice, n) LowPx = rand(randPrice, n) LastPx = rand(randPrice, n) Volume = int(rand(randVolume, n)) Amount = round(LastPx*Volume, 2) tmp = cj(table(SecurityID), table(DateTime)) t = tmp.join!(table(PreClosePx, OpenPx, HighPx, LowPx, LastPx, Volume, Amount)) dbName = &#34;dfs://testDB&#34; tbName = &#34;testTB&#34; loadTable(dbName, tbName).append!(t)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;212:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;执行以下语句确认数据已同步到从集群中：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;214:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;select count(*) from loadTable(&#34;dfs://testDB&#34;, &#34;testTB&#34;)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;218:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;返回结果如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Asynchronous_Replication/3_2.png&#34; width=&#34;15%&#34; xtrc=&#34;image:3;220:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; dita-ot:image-width=&#34;109&#34; dita-ot:image-height=&#34;61&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;从集群对应的分区表中插入了 1210000 条数据。可以确认主集群中的数据已同步到从集群中。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;若希望查看关于集群间异步复制更详细的状态信息，可通过 DolphinDB 提供的一系列函数进行查询：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;226:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;getMasterReplicationStatus&lt;/codeph&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;227:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;227:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;getSlaveReplicationStatus&lt;/codeph&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;228:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;getRecentSlaveReplicationInfo&lt;/codeph&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;231:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;在 dataNodeMaster 的交互编程界面执行以下语句可以查询主集群任务发送队列的状态：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;233:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;rpc(getControllerAlias(), getMasterReplicationStatus)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;237:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;237:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;getMasterReplicationStatus&lt;/codeph&gt; 只能在控制节点上执行，用户可以通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;237:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;rpc&lt;/codeph&gt; 函数在控制节点上进行调用。返回结果如下。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Asynchronous_Replication/3_3.png&#34; width=&#34;80%&#34; xtrc=&#34;image:4;239:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; dita-ot:image-width=&#34;1013&#34; dita-ot:image-height=&#34;114&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;241:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;主集群生成了三个异步复制任务，分别对应创建数据库、创建表和插入数据。关于上图中各参数的介绍请参考&lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getMasterReplicationStatus.dita&#34; xtrc=&#34;xref:8;241:49&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;函数介绍&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;243:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;与之相对应，在 dataNodeSlave 上使用 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getSlaveReplicationStatus.dita&#34; xtrc=&#34;xref:9;243:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getSlaveReplicationStatus&lt;/xref&gt;可以查询从集群任务执行队列的状态：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;245:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;rpc(getControllerAlias(), getSlaveReplicationStatus)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;249:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;函数返回结果如下。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Asynchronous_Replication/3_4.png&#34; width=&#34;80%&#34; xtrc=&#34;image:5;251:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; dita-ot:image-width=&#34;1451&#34; dita-ot:image-height=&#34;111&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;253:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;从集群拉取了主集群上生成的三个任务并完成执行。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;255:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;在 dataNodeMaster 上使用 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/g/getRecentSlaveReplicationInfo.dita&#34; xtrc=&#34;xref:10;255:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;getRecentSlaveReplicationInfo&lt;/xref&gt; 可以查看跨集群异步复制进程中，连接到主集群的各从集群最近一次的任务状态。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;257:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;rpc(getControllerAlias(), getRecentSlaveReplicationInfo)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;261:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;函数返回结果如下。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Asynchronous_Replication/3_5.png&#34; width=&#34;70%&#34; xtrc=&#34;image:6;263:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; dita-ot:image-width=&#34;805&#34; dita-ot:image-height=&#34;62&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;265:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;从集群最近一次拉取任务时通过控制节点 10.0.0.3:8711 进行连接，最近完成任务的 taskID 为 3。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;268:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;最后一个参数指定了时间区间为过去 30s 内的状态信息，函数返回结果如下。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Asynchronous_Replication/3_6.png&#34; width=&#34;70%&#34; xtrc=&#34;image:7;270:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; dita-ot:image-width=&#34;913&#34; dita-ot:image-height=&#34;60&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;272:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;过去 30s 内完成了三个任务，任务平均耗时为 00:00:00.537。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;33-停止或关闭异步复制&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;275:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;275:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;3.3. 停止或关闭异步复制&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;275:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;277:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;在某些情况下需要暂时停止集群间的异步复制，在 dataNodeMaster 或 dataNodeSlave 上执行如下语句来停止主集群或从集群的异步复制。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;279:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;rpc(getControllerAlias(), stopClusterReplication)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;283:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;若在主集群上执行 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/s/stopClusterReplication.dita&#34; xtrc=&#34;xref:11;283:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;stopClusterReplication&lt;/xref&gt;，集群异步复制状态转为 &#34;DISABLED&#34;，在此之后创建的任务将不会放到发送队列中；若在从集群上执行，从集群停止从主集群读取新任务，但正在执行中的任务不会停止。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;285:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;若希望重新开启异步复制，可通过 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/s/startClusterReplication.dita&#34; xtrc=&#34;xref:12;285:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;startClusterReplication&lt;/xref&gt; 重新启动，集群状态将转为 &#34;ENABLED&#34;。该函数同样只能在控制节点上调用。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;287:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;当完成异步复制任务之后希望关闭数据库的异步复制功能时，可使用 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/s/setDatabaseForClusterReplication.dita&#34; xtrc=&#34;xref:13;287:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;setDatabaseForClusterReplication&lt;/xref&gt; 来关闭。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:21;289:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;setDatabaseForClusterReplication(db, false)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;293:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;以上通过一些简单的例子对如何使用异步复制功能进行了介绍。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-常见问题&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;295:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;295:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;4. 常见问题&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;295:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;41-replication-is-not-enabled&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;4.1. Replication is not enabled&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;297:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;299:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;执行异步复制相关函数报错如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Asynchronous_Replication/4_1.png&#34; width=&#34;60%&#34; xtrc=&#34;image:8;301:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; dita-ot:image-width=&#34;581&#34; dita-ot:image-height=&#34;35&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;303:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;该情况一般为集群未正确配置异步复制，请参考&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#环境配置&#34; xtrc=&#34;xref:14;303:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;?ditaot usertext?&gt;环境配置&lt;/xref&gt;检查环境配置。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;42-异步复制任务异常中止&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;305:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;305:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;4.2. 异步复制任务异常中止&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;305:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;307:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;异步复制任务在执行过程中可能由于异常而中止，比如下面这种情况。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/Asynchronous_Replication/4_2.png&#34; width=&#34;80%&#34; xtrc=&#34;image:9;309:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; dita-ot:image-width=&#34;1385&#34; dita-ot:image-height=&#34;63&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;311:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;使用 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:13;311:4&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;getSlaveReplicationStatus&lt;/i&gt; 查看任务执行队列状态发现异步复制任务由于失败而中止，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;311:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;state&lt;/b&gt; 显示为 “FAILED”，失败的任务 ID 为 938。此时的集群状态为 “STOPPED”。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;313:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;导致异步复制任务失败的原因可能为磁盘容量不足、无写文件权限等等，&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;313:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;details&lt;/b&gt; 中会给出失败原因。用户可以根据失败原因尝试解决，然后执行 &lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:14;313:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;startClusterReplication&lt;/i&gt; 重启异步复制任务。从集群将再次执行所有失败的任务。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;若无法分析失败原因，请联系技术支持人员进行处理。可以暂时跳过失败的任务，继续执行之后的任务，在从集群的数据节点上执行以下语句跳过该任务。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:22;317:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;rpc(getControllerAlias(), skipClusterReplicationTask, 938) rpc(getControllerAlias(), startClusterReplication)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;322:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;首先通过 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../funcs/s/skipClusterReplicationTask.dita&#34; xtrc=&#34;xref:15;322:6&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;skipClusterReplicationTask&lt;/xref&gt; 跳过了失败的任务，接着调用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;322:93&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;startClusterReplication&lt;/codeph&gt; 重启了异步复制。跳过的任务将被标记为完成状态。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;5-附录&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;324:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;324:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;5. 附录&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;324:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;326:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;异步复制主集群Demo：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;328:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;328:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;demo_asynMaster.dos: &lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;script/Asynchronous_Replication/async_replica.zip&#34; xtrc=&#34;xref:16;328:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;?ditaot usertext?&gt;Asynchronous_Replication&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;331:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;异步复制从集群Demo：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;333:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;333:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;demo_asynSlave.dos: &lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;script/Asynchronous_Replication/async_replica.zip&#34; xtrc=&#34;xref:17;333:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/async_replication.md&#34;&gt;&lt;?ditaot usertext?&gt;Asynchronous_Replication&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/async_replication.md"/><meta name="wh-out-relpath" content="tutorials/async_replication.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20240704100525"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20240704100525"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="集群间异步复制" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://www.dolphindb.cn" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>

            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/data_sync_among_clusters.html">安全与容灾</a></div></div></li><li class="active"><div class="topicref" data-id="集群间异步复制"><div class="title"><a href="../tutorials/async_replication.html">集群间异步复制</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="new_chap_about_sect_ddb_docs_intro-d9529e87" class="topicref" data-id="new_chap_about_sect_ddb_docs_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_docs_intro.html" id="new_chap_about_sect_ddb_docs_intro-d9529e87-link">文档使用说明</a><div class="wh-tooltip"><p class="shortdesc">如何获取 DolphinDB 帮助信息</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap1_getstarted-d9529e140" class="topicref" data-id="chap1_getstarted" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap1_getstarted-d9529e140-link" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9529e140-link"><span class="keyword label">快速上手</span></a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9529e335" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9529e335-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9529e335-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9529e2313" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9529e2313-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9529e2313-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9529e3490" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9529e3490-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9529e3490-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e7385" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e7385-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9529e7385-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9529e7812" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9529e7812-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9529e7812-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9529e16490" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9529e16490-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9529e16490-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9529e26503" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9529e26503-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9529e26503-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9529e86456" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9529e86456-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9529e86456-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9529e91976" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9529e91976-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9529e91976-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9529e94749" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9529e94749-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9529e94749-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9529e94980" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9529e94980-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9529e94980-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e95033" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e95033-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/import_data.html" id="tocId-d9529e95033-link">数据导入</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e95264" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e95264-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DolphinDB_TopN.html" id="tocId-d9529e95264-link">数据库</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e95910" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e95910-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/memory_management.html" id="tocId-d9529e95910-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e96325" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e96325-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hybrid_programming_paradigms.html" id="tocId-d9529e96325-link">编程语言</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9529e97155" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9529e97155-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/data_sync_among_clusters.html" id="tocId-d9529e97155-link">安全与容灾</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="集群间数据库同步-d9529e97156" class="topicref" data-id="集群间数据库同步" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/data_sync_among_clusters.html" id="集群间数据库同步-d9529e97156-link">集群间数据库同步</a></div></div></li><li role="treeitem"><div data-tocid="数据再平衡-d9529e97202" class="topicref" data-id="数据再平衡" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Data_Move_Rebalance.html" id="数据再平衡-d9529e97202-link">数据再平衡</a></div></div></li><li role="treeitem" class="active"><div data-tocid="集群间异步复制-d9529e97248" class="topicref" data-id="集群间异步复制" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/async_replication.html" id="集群间异步复制-d9529e97248-link">集群间异步复制</a></div></div></li><li role="treeitem"><div data-tocid="数据备份以及恢复-130202008及之后版本-d9529e97294" class="topicref" data-id="数据备份以及恢复-130202008及之后版本" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/backup-restore-new.html" id="数据备份以及恢复-130202008及之后版本-d9529e97294-link">数据备份以及恢复 （1.30.20/2.00.8及之后版本）</a></div></div></li><li role="treeitem"><div data-tocid="数据备份以及恢复-130202008以前版本-d9529e97340" class="topicref" data-id="数据备份以及恢复-130202008以前版本" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/backup_restore_before_208.html" id="数据备份以及恢复-130202008以前版本-d9529e97340-link">数据备份以及恢复 （1.30.20/2.00.8以前版本）</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e97386" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e97386-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_tutorial.html" id="tocId-d9529e97386-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e97893" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e97893-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DECIMAL.html" id="tocId-d9529e97893-link">数值处理</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_modules-d9529e97986" class="topicref" data-id="chap7_tutorials_modules" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_modules-d9529e97986-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="chap7_tutorials_modules-d9529e97986-link"><span class="keyword label">模块</span></a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="plugins_apply-d9529e98493" class="topicref" data-id="plugins_apply" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action plugins_apply-d9529e98493-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/plugins_apply.html" id="plugins_apply-d9529e98493-link">插件应用</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e98631" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e98631-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphinscheduler_integration.html" id="tocId-d9529e98631-link">金融场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e100707" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e100707-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/iot_examples.html" id="tocId-d9529e100707-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e101629" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e101629-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/cluster_scaleout_perf_test.html" id="tocId-d9529e101629-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e101769" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e101769-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_1.html" id="tocId-d9529e101769-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">集群间异步复制</h1><div class="- topic/body body"><p class="- topic/p p">异步复制是进行集群间数据同步的一种方式。在金融交易、物联网、互联网/移动互联网等应用场景中，复杂的业务对数据一致性和可靠性提出了极高的要求。与同步复制相比，异步复制网络延迟更低、吞吐量更高、故障风险更小。</p><p class="- topic/p p">DolphinDB 提供的异步复制功能通过异步方式，将主集群复制到从集群，使主从集群数据一致，是集群异地容灾的一个解决方案。</p><p class="- topic/p p">传统集群间的异步复制可能导致数据不一致、丢失或冲突。与传统集群间的异步复制解决方案相比，DolphinDB 具有以下优势：</p><ul class="- topic/ul ul"><li class="- topic/li li">容错性强。节点宕机不会造成数据丢失，主从集群数据最终会保持一致。</li><li class="- topic/li li">运维便捷。提供在线监控函数以及错误修复函数。</li></ul><p class="- topic/p p">本教程将从以下几方面对 DolphinDB 的异步复制方案进行介绍：</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-概述"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 概述</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title3" id="11-原理"><h3 class="- topic/title title topictitle3" id="ariaid-title3">1.1. 原理</h3><div class="- topic/body body"><p class="- topic/p p">使用异步复制功能时，原集群称为主集群，目的集群称为从集群。当前主集群的控制节点会在处理事务时收集相关信息，生成异步复制任务并放到主集群的队列中。同时从集群的控制节点定时从主集群的队列中拉取任务，放到从集群的队列中等待执行。从集群队列中的任务会被划分为不同的组，执行时在组间依次进行，同一组中的任务根据哈希算法被分配到不同的数据节点中并发执行。</p><p class="- topic/p p">异步复制通过各种机制保证数据的一致性，但主集群数据节点的宕机仍可能导致数据丢失。在这种情况下，可以通过开启同步持久化来保证数据一致（见 <a class="- topic/xref xref" href="#%E4%B8%BB%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE">主集群配置</a> 小节）。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="12-支持性"><h3 class="- topic/title title topictitle3" id="ariaid-title4">1.2. 支持性</h3><div class="- topic/body body"><p class="- topic/p p">异步复制功能目前支持分布式表；支持 DDL（Data  Definition Language）/ DML（Data Manipulation Languange）操作；支持在数据库层面上开启或关闭异步复制功能。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title5" id="2-环境配置"><h2 class="- topic/title title topictitle2" id="ariaid-title5">2. 环境配置</h2><div class="- topic/body body"><p class="- topic/p p">本教程使用两个高可用集群作为示例，架构如下图：</p><img class="- topic/image image" src="images/Asynchronous_Replication/2_1.png"/><br/><p class="- topic/p p">集群间的异步复制支持一个主集群，多个从集群。用户在使用异步复制功能时需要至少部署两个集群，集群类型可为单服务器集群、多服务器集群以及高可用集群。关于如何部署集群请参考<a class="- topic/xref xref" href="single_machine_cluster_deploy.html">单服务器集群部署</a>、<a class="- topic/xref xref" href="multi_machine_cluster_deployment.html">多服务器集群部署</a>、<a class="- topic/xref xref" href="ha_cluster_deployment.html">高可用集群部署</a>。</p><p class="- topic/p p">本教程假定主集群配置文件位于 <em class="+ topic/ph hi-d/i ph i">/dolphindb/server/cluster1/config</em> 目录下，从集群配置文件位于 <em class="+ topic/ph hi-d/i ph i">/dolphindb/server/cluster2/config</em> 目录下。与异步复制相关的配置项请参考<a class="- topic/xref xref" href="../db_distr_comp/cfg/cfg_para_ref.html">集群间的异步复制配置项</a>。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title6" id="21-主集群配置"><h3 class="- topic/title title topictitle3" id="ariaid-title6">2.1. 主集群配置</h3><div class="- topic/body body"><p class="- topic/p p">以 P1 服务器为例，首先登录 P1 服务器，进入 <em class="+ topic/ph hi-d/i ph i">/dolphindb/server/cluster1/config</em> 目录。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">控制节点配置</strong></p><p class="- topic/p p">执行以下 Shell 命令修改 <em class="+ topic/ph hi-d/i ph i">controller.cfg</em> 配置文件：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>vim ./controller.cfg</code></pre><p class="- topic/p p">添加如下配置项参数：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>clusterReplicationSlaveNum=1</code></pre><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">clusterReplicationSlaveNum</em> 指定允许配置的从集群数量上限，本教程中从集群数量为1。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">数据节点配置</strong></p><p class="- topic/p p">执行以下 Shell 命令修改 <em class="+ topic/ph hi-d/i ph i">cluster.cfg</em> 配置文件：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>vim ./cluster.cfg</code></pre><p class="- topic/p p">添加如下配置项参数：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>clusterReplicationMode=master
clusterReplicationWorkDir=/dolphindb/server/cluster1/replication
clusterReplicationSyncPersistence=false</code></pre><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">clusterReplicationSyncPersistence</em> 指定是否开启任务数据的同步持久化，默认为 false，表示持久化异步进行。在这种状态下，主集群数据节点的宕机可能导致数据丢失。可以指定 <em class="+ topic/ph hi-d/i ph i">clusterReplicationSyncPersistence</em> 的值为 true 开启同步持久化，以确保数据的一致性。但请注意，开启同步持久化之后，主集群的事务效率会降低。</p></li></ul><p class="- topic/p p">在完成 P1 服务器的配置之后，请同步修改主集群中其它服务器的配置。在本例中，这表示 P2 和 P3 服务器的配置同样需要按照以上操作进行修改。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title7" id="22-从集群配置"><h3 class="- topic/title title topictitle3" id="ariaid-title7">2.2. 从集群配置</h3><div class="- topic/body body"><p class="- topic/p p">以 P1 服务器为例，首先登录 P1 服务器，进入 <em class="+ topic/ph hi-d/i ph i">/dolphindb/server/cluster2/confi</em>g 目录。</p><ul class="- topic/ul ul"><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">控制节点配置</strong></p><p class="- topic/p p">执行以下 Shell 命令修改 <em class="+ topic/ph hi-d/i ph i">controller.cfg</em> 配置文件：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>vim ./controller.cfg</code></pre><p class="- topic/p p">添加如下配置项参数：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>clusterReplicationMasterCtl=10.0.0.1:8848</code></pre><p class="- topic/p p"><em class="+ topic/ph hi-d/i ph i">clusterReplicationMasterCtl</em> 指定主集群控制节点。若主集群为高可用集群，则指定为控制节点 raft 组中的任意节点即可。在本例中指定 P1 服务器中的控制节点。</p></li><li class="- topic/li li"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">数据节点配置</strong></p><p class="- topic/p p">执行以下 Shell 命令修改 <em class="+ topic/ph hi-d/i ph i">cluster.cfg 配置文件：</em></p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>vim ./cluster.cfg</code></pre><p class="- topic/p p">添加如下配置项参数：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>clusterReplicationMode=slave
clusterReplicationExecutionUsername=admin
clusterReplicationExecutionPassword=123456</code></pre><p class="- topic/p p">在配置中指定了用于执行集群间异步复制的用户名和密码。<strong class="+ topic/ph hi-d/b ph b">必须确保该用户有事务操作的相关权限</strong>，即对于主集群上执行的操作，该用户在从集群上同样有执行的权限，否则异步复制任务会失败。关于 DolphinDB 权限的具体介绍请参考：<a class="- topic/xref xref" href="ACL_and_Security.html">用户权限管理</a>。</p><p class="- topic/p p">在完成以上配置之后，请同步修改从集群中其它服务器的配置。</p></li></ul></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title8" id="3-使用异步复制"><h2 class="- topic/title title topictitle2" id="ariaid-title8">3. 使用异步复制</h2><div class="- topic/body body"><p class="- topic/p p">接下来通过一个例子介绍如何使用 DolphinDB 集群间的异步复制功能。首先，在主集群和从集群中各选择一个数据节点（以下分别使用 dataNodeMaster 和 dataNodeSlave 表示），打开对应的交互编程界面。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="31-开启集群间异步复制"><h3 class="- topic/title title topictitle3" id="ariaid-title9">3.1. 开启集群间异步复制</h3><div class="- topic/body body"><p class="- topic/p p">在 dataNodeMaster 的交互编程界面执行以下语句创建数据库：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 创建存储的数据库
login("admin", "123456")
dbName = "dfs://testDB"
if(existsDatabase(dbName)){
  dropDatabase(dbName)
}
db = database(dbName, VALUE, 2023.01.01..2023.12.31)</code></pre><p class="- topic/p p">集群异步复制状态共三种：</p><ul class="- topic/ul ul"><li class="- topic/li li">ENABLED，开启状态，集群的默认状态；</li><li class="- topic/li li">DISABLED，关闭状态，用户手动停止了异步复制任务或配置中未包括异步复制相关配置项；</li><li class="- topic/li li">STOPPED，停止状态，从集群任务执行失败 30 次后将转为该状态。</li></ul><p class="- topic/p p">在集群启动时异步复制状态默认为 "ENABLED"，但集群中新创建的数据库默认关闭异步复制功能，因此需要在 dataNodeMaster 的交互编程界面执行以下语句开启新建数据库的异步复制功能：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>setDatabaseForClusterReplication(db, true)</code></pre><p class="- topic/p p">执行以下语句以确认数据库的异步复制是否开启：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>schema(db).clusterReplicationEnabled</code></pre><p class="- topic/p p">若执行结果返回 true，则说明异步复制功能已启用。也可以通过 <a class="- topic/xref xref" href="../funcs/g/getDatabaseClusterReplicationStatus.html">getDatabaseClusterReplicationStatus</a> 查看所有数据库的异步复制开启状态，但请注意，使用该函数的前提是数据库中存在数据。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>getDatabaseClusterReplicationStatus()</code></pre><p class="- topic/p p">查询结果如下，<strong class="+ topic/ph hi-d/b ph b">dbName</strong> 表示库名，<strong class="+ topic/ph hi-d/b ph b">enabled</strong> 表示开启状态。</p><img class="- topic/image image" src="images/Asynchronous_Replication/3_1.png"/><br/></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title10" id="32-查询异步复制状态"><h3 class="- topic/title title topictitle3" id="ariaid-title10">3.2. 查询异步复制状态</h3><div class="- topic/body body"><p class="- topic/p p">在 dataNodeMaster 的交互编程界面执行以下语句创建分区表：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 创建分区表
tbName = "testTB"
colNames = `SecurityID`DateTime`PreClosePx`OpenPx`HighPx`LowPx`LastPx`Volume`Amount
colTypes = [SYMBOL, DATETIME, DOUBLE, DOUBLE, DOUBLE, DOUBLE, DOUBLE, INT, DOUBLE]
schemaTable = table(1:0, colNames, colTypes)
db.createPartitionedTable(table=schemaTable, tableName=tbName, partitionColumns=`DateTime)</code></pre><p class="- topic/p p">为了确认在主集群中创建库表后，从集群复制了主集群的库表信息，在 dataNodeSlave 的交互编程界面执行以下语句：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>loadTable("dfs://testDB", "testTB")</code></pre><p class="- topic/p p">函数执行成功说明从集群中成功创建了数据库 <code class="+ topic/ph pr-d/codeph ph codeph">dfs://testDB</code> 和表 <code class="+ topic/ph pr-d/codeph ph codeph">testTB</code>。</p><p class="- topic/p p">接着在 dataNodeMaster 执行以下语句，模拟生成 5000 个股票 1 天的 1 分钟 K 线数据：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>// 模拟数据并写入分区表
n = 1210000
randPrice = round(10+rand(1.0, 100), 2)
randVolume = 100+rand(100, 100)
SecurityID = lpad(string(take(0..4999, 5000)), 6, `0)
DateTime = (2023.01.08T09:30:00 + take(0..120, 121)*60).join(2023.01.08T13:00:00 + take(0..120, 121)*60)
PreClosePx = rand(randPrice, n)
OpenPx = rand(randPrice, n)
HighPx = rand(randPrice, n)
LowPx = rand(randPrice, n)
LastPx = rand(randPrice, n)
Volume = int(rand(randVolume, n))
Amount = round(LastPx*Volume, 2)
tmp = cj(table(SecurityID), table(DateTime))
t = tmp.join!(table(PreClosePx, OpenPx, HighPx, LowPx, LastPx, Volume, Amount))
dbName = "dfs://testDB"
tbName = "testTB"
loadTable(dbName, tbName).append!(t)</code></pre><p class="- topic/p p">执行以下语句确认数据已同步到从集群中：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>select count(*) from loadTable("dfs://testDB", "testTB")</code></pre><p class="- topic/p p">返回结果如下：</p><img class="- topic/image image" src="images/Asynchronous_Replication/3_2.png"/><br/><p class="- topic/p p">从集群对应的分区表中插入了 1210000 条数据。可以确认主集群中的数据已同步到从集群中。</p><p class="- topic/p p">若希望查看关于集群间异步复制更详细的状态信息，可通过 DolphinDB 提供的一系列函数进行查询：</p><ul class="- topic/ul ul"><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">getMasterReplicationStatus</code></li><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">getSlaveReplicationStatus</code></li><li class="- topic/li li"><code class="+ topic/ph pr-d/codeph ph codeph">getRecentSlaveReplicationInfo</code></li></ul><p class="- topic/p p">在 dataNodeMaster 的交互编程界面执行以下语句可以查询主集群任务发送队列的状态：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), getMasterReplicationStatus)</code></pre><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">getMasterReplicationStatus</code> 只能在控制节点上执行，用户可以通过 <code class="+ topic/ph pr-d/codeph ph codeph">rpc</code> 函数在控制节点上进行调用。返回结果如下。</p><img class="- topic/image image" src="images/Asynchronous_Replication/3_3.png"/><br/><p class="- topic/p p">主集群生成了三个异步复制任务，分别对应创建数据库、创建表和插入数据。关于上图中各参数的介绍请参考<a class="- topic/xref xref" href="../funcs/g/getMasterReplicationStatus.html">函数介绍</a>。</p><p class="- topic/p p">与之相对应，在 dataNodeSlave 上使用 <a class="- topic/xref xref" href="../funcs/g/getSlaveReplicationStatus.html">getSlaveReplicationStatus</a>可以查询从集群任务执行队列的状态：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), getSlaveReplicationStatus)</code></pre><p class="- topic/p p">函数返回结果如下。</p><img class="- topic/image image" src="images/Asynchronous_Replication/3_4.png"/><br/><p class="- topic/p p">从集群拉取了主集群上生成的三个任务并完成执行。</p><p class="- topic/p p">在 dataNodeMaster 上使用 <a class="- topic/xref xref" href="../funcs/g/getRecentSlaveReplicationInfo.html">getRecentSlaveReplicationInfo</a> 可以查看跨集群异步复制进程中，连接到主集群的各从集群最近一次的任务状态。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), getRecentSlaveReplicationInfo)</code></pre><p class="- topic/p p">函数返回结果如下。</p><img class="- topic/image image" src="images/Asynchronous_Replication/3_5.png"/><br/><p class="- topic/p p">从集群最近一次拉取任务时通过控制节点 10.0.0.3:8711 进行连接，最近完成任务的 taskID 为 3。</p><p class="- topic/p p">最后一个参数指定了时间区间为过去 30s 内的状态信息，函数返回结果如下。</p><img class="- topic/image image" src="images/Asynchronous_Replication/3_6.png"/><br/><p class="- topic/p p">过去 30s 内完成了三个任务，任务平均耗时为 00:00:00.537。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title11" id="33-停止或关闭异步复制"><h3 class="- topic/title title topictitle3" id="ariaid-title11">3.3. 停止或关闭异步复制</h3><div class="- topic/body body"><p class="- topic/p p">在某些情况下需要暂时停止集群间的异步复制，在 dataNodeMaster 或 dataNodeSlave 上执行如下语句来停止主集群或从集群的异步复制。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), stopClusterReplication)</code></pre><p class="- topic/p p">若在主集群上执行 <a class="- topic/xref xref" href="../funcs/s/stopClusterReplication.html">stopClusterReplication</a>，集群异步复制状态转为 "DISABLED"，在此之后创建的任务将不会放到发送队列中；若在从集群上执行，从集群停止从主集群读取新任务，但正在执行中的任务不会停止。</p><p class="- topic/p p">若希望重新开启异步复制，可通过 <a class="- topic/xref xref" href="../funcs/s/startClusterReplication.html">startClusterReplication</a> 重新启动，集群状态将转为 "ENABLED"。该函数同样只能在控制节点上调用。</p><p class="- topic/p p">当完成异步复制任务之后希望关闭数据库的异步复制功能时，可使用 <a class="- topic/xref xref" href="../funcs/s/setDatabaseForClusterReplication.html">setDatabaseForClusterReplication</a> 来关闭。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>setDatabaseForClusterReplication(db, false)</code></pre><p class="- topic/p p">以上通过一些简单的例子对如何使用异步复制功能进行了介绍。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title12" id="4-常见问题"><h2 class="- topic/title title topictitle2" id="ariaid-title12">4. 常见问题</h2><div class="- topic/body body"></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title13" id="41-replication-is-not-enabled"><h3 class="- topic/title title topictitle3" id="ariaid-title13">4.1. Replication is not enabled</h3><div class="- topic/body body"><p class="- topic/p p">执行异步复制相关函数报错如下：</p><img class="- topic/image image" src="images/Asynchronous_Replication/4_1.png"/><br/><p class="- topic/p p">该情况一般为集群未正确配置异步复制，请参考<a class="- topic/xref xref" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">环境配置</a>检查环境配置。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title14" id="42-异步复制任务异常中止"><h3 class="- topic/title title topictitle3" id="ariaid-title14">4.2. 异步复制任务异常中止</h3><div class="- topic/body body"><p class="- topic/p p">异步复制任务在执行过程中可能由于异常而中止，比如下面这种情况。</p><img class="- topic/image image" src="images/Asynchronous_Replication/4_2.png"/><br/><p class="- topic/p p">使用 <em class="+ topic/ph hi-d/i ph i">getSlaveReplicationStatus</em> 查看任务执行队列状态发现异步复制任务由于失败而中止，<strong class="+ topic/ph hi-d/b ph b">state</strong> 显示为 “FAILED”，失败的任务 ID 为 938。此时的集群状态为 “STOPPED”。</p><p class="- topic/p p">导致异步复制任务失败的原因可能为磁盘容量不足、无写文件权限等等，<strong class="+ topic/ph hi-d/b ph b">details</strong> 中会给出失败原因。用户可以根据失败原因尝试解决，然后执行 <em class="+ topic/ph hi-d/i ph i">startClusterReplication</em> 重启异步复制任务。从集群将再次执行所有失败的任务。</p><p class="- topic/p p">若无法分析失败原因，请联系技术支持人员进行处理。可以暂时跳过失败的任务，继续执行之后的任务，在从集群的数据节点上执行以下语句跳过该任务。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>rpc(getControllerAlias(), skipClusterReplicationTask, 938)
rpc(getControllerAlias(), startClusterReplication)</code></pre><p class="- topic/p p">首先通过 <a class="- topic/xref xref" href="../funcs/s/skipClusterReplicationTask.html">skipClusterReplicationTask</a> 跳过了失败的任务，接着调用 <code class="+ topic/ph pr-d/codeph ph codeph">startClusterReplication</code> 重启了异步复制。跳过的任务将被标记为完成状态。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title15" id="5-附录"><h2 class="- topic/title title topictitle2" id="ariaid-title15">5. 附录</h2><div class="- topic/body body"><p class="- topic/p p">异步复制主集群Demo：</p><ul class="- topic/ul ul"><li class="- topic/li li">demo_asynMaster.dos:  <a class="- topic/xref xref" href="script/Asynchronous_Replication/async_replica.zip">Asynchronous_Replication</a></li></ul><p class="- topic/p p">异步复制从集群Demo：</p><ul class="- topic/ul ul"><li class="- topic/li li">demo_asynSlave.dos:  <a class="- topic/xref xref" href="script/Asynchronous_Replication/async_replica.zip">Asynchronous_Replication</a></li></ul></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E6%A6%82%E8%BF%B0" data-tocid="1-概述">1. 概述</a><ul><li class="topic-item"><a href="#11-%E5%8E%9F%E7%90%86" data-tocid="11-原理">1.1. 原理</a></li><li class="topic-item"><a href="#12-%E6%94%AF%E6%8C%81%E6%80%A7" data-tocid="12-支持性">1.2. 支持性</a></li></ul></li><li class="topic-item"><a href="#2-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE" data-tocid="2-环境配置">2. 环境配置</a><ul><li class="topic-item"><a href="#21-%E4%B8%BB%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE" data-tocid="21-主集群配置">2.1. 主集群配置</a></li><li class="topic-item"><a href="#22-%E4%BB%8E%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE" data-tocid="22-从集群配置">2.2. 从集群配置</a></li></ul></li><li class="topic-item"><a href="#3-%E4%BD%BF%E7%94%A8%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6" data-tocid="3-使用异步复制">3. 使用异步复制</a><ul><li class="topic-item"><a href="#31-%E5%BC%80%E5%90%AF%E9%9B%86%E7%BE%A4%E9%97%B4%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6" data-tocid="31-开启集群间异步复制">3.1. 开启集群间异步复制</a></li><li class="topic-item"><a href="#32-%E6%9F%A5%E8%AF%A2%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6%E7%8A%B6%E6%80%81" data-tocid="32-查询异步复制状态">3.2. 查询异步复制状态</a></li><li class="topic-item"><a href="#33-%E5%81%9C%E6%AD%A2%E6%88%96%E5%85%B3%E9%97%AD%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6" data-tocid="33-停止或关闭异步复制">3.3. 停止或关闭异步复制</a></li></ul></li><li class="topic-item"><a href="#4-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" data-tocid="4-常见问题">4. 常见问题</a><ul><li class="topic-item"><a href="#41-replication-is-not-enabled" data-tocid="41-replication-is-not-enabled">4.1. Replication is not enabled</a></li><li class="topic-item"><a href="#42-%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6%E4%BB%BB%E5%8A%A1%E5%BC%82%E5%B8%B8%E4%B8%AD%E6%AD%A2" data-tocid="42-异步复制任务异常中止">4.2. 异步复制任务异常中止</a></li></ul></li><li class="topic-item"><a href="#5-%E9%99%84%E5%BD%95" data-tocid="5-附录">5. 附录</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2024 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>