<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh" lang="zh" data-whc_version="26.0">
    <head><link rel="shortcut icon" href="../favicon.ico"/><link rel="icon" href="../favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="一个量化策略在生产（交易）环境中运行时，实时数据的处理通常是由事件驱动的。为确保研发和生产使用同一套代码，通常在研发阶段需将历史数据，严格按照事件发生的时间顺序进行回放，以此模拟交易环境。一个交易所的行情数据通常包括逐笔委托、逐笔成交、快照等多种类型的数据。DolphinDB 提供了严格按照时间顺序将多个不同数据源同时进行回放的功能。 首先简要介绍 DolphinDB ..."/><meta name="DC.rights.owner" content="(C) 版权 2024"/><meta name="copyright" content="(C) 版权 2024"/><meta name="generator" content="DITA-OT"/><meta name="DC.type" content="topic"/><meta name="DC.coverage" content=""/><meta name="DC.relation" content="../tutorials/about_tutorials.html"/><meta name="prodname" content="DolphinDB"/><meta name="brand" content="DolphinDB"/><meta name="DC.creator" content="DolphinDB"/><meta name="DC.publisher" content="DDB N/A DDB 200"/><meta name="DC.format" content="HTML5"/><meta name="DC.identifier" content="股票行情回放"/><title>股票行情回放</title><!--  Generated with Oxygen version 26.0, build number 2024012323.  --><meta name="wh-path2root" content="../"/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /tmp/temp20240704100525325/tutorials?&gt;&lt;?workdir-uri file:/tmp/temp20240704100525325/tutorials/?&gt;&lt;?path2project ..?&gt;&lt;?path2project-uri ../?&gt;&lt;?path2rootmap-uri ../?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;股票行情回放&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;股票行情回放&lt;/title&gt;&lt;prolog class=&#34;- topic/prolog &#34;&gt;&lt;author class=&#34;- topic/author &#34; xtrc=&#34;author:1;12:17&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/author&gt;&lt;publisherinformation class=&#34;- topic/publisher bookmap/publisherinformation &#34; xtrc=&#34;publisherinformation:1;14:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:1;15:21&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;printlocation class=&#34;- topic/data bookmap/printlocation &#34; xtrc=&#34;printlocation:1;16:28&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;N/A&lt;/printlocation&gt; &lt;published class=&#34;- topic/data bookmap/published &#34; xtrc=&#34;published:1;17:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;person class=&#34;- topic/data bookmap/person &#34; xtrc=&#34;person:2;18:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DDB&lt;/person&gt; &lt;publishtype class=&#34;- topic/data bookmap/publishtype &#34; value=&#34;HTML&#34; xtrc=&#34;publishtype:1;19:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;revisionid class=&#34;- topic/ph bookmap/revisionid &#34; xtrc=&#34;revisionid:1;20:29&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;200&lt;/revisionid&gt; &lt;summary class=&#34;- topic/ph bookmap/summary &#34; xtrc=&#34;summary:1;22:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:1;23:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/published&gt; &lt;data class=&#34;- topic/data &#34; xtrc=&#34;data:2;25:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt; &lt;/publisherinformation&gt;&lt;metadata class=&#34;- topic/metadata &#34;&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:2;39:20&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;audience class=&#34;- topic/audience &#34; xtrc=&#34;audience:1;28:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;category class=&#34;- topic/category &#34; xtrc=&#34;category:1;29:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;/&gt;&lt;prodinfo class=&#34;- topic/prodinfo &#34; xtrc=&#34;prodinfo:1;34:23&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt; &lt;prodname class=&#34;- topic/prodname &#34; xtrc=&#34;prodname:1;35:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/prodname&gt; &lt;brand class=&#34;- topic/brand &#34; xtrc=&#34;brand:1;36:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/ddb_doc_centre.ditamap&#34;&gt;DolphinDB&lt;/brand&gt; &lt;/prodinfo&gt;&lt;/metadata&gt;&lt;/prolog&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:1;1:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:1;3:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;一个量化策略在生产（交易）环境中运行时，实时数据的处理通常是由事件驱动的。为确保研发和生产使用同一套代码，通常在研发阶段需将历史数据，严格按照事件发生的时间顺序进行回放，以此模拟交易环境。一个交易所的行情数据通常包括逐笔委托、逐笔成交、快照等多种类型的数据。DolphinDB 提供了严格按照时间顺序将多个不同数据源同时进行回放的功能。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:2;5:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;首先简要介绍 DolphinDB 数据回放功能和原理，之后介绍股票行情回放的应用方案和代码实现，最后给出搭建行情回放服务的最佳实践。&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; xtrc=&#34;topicref:104;135:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;../tutorials/about_tutorials.dita&#34; mapclass=&#34;- map/topicref bookmap/chapter &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;5:53&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/chap_tutorials.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot usertext?&gt;教程&lt;/linktext&gt;&lt;?ditaot usershortdesc?&gt;&lt;desc class=&#34;- topic/desc &#34;&gt;DolphinDB 产品使用教程&lt;/desc&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;1-单表回放&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;1. 单表回放&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:2;7:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:3;9:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DolphinDB 历史数据回放功能通过 replay 函数实现。replay 函数的作用是将内存表或数据库表中的记录以一定的速率写入到目标表中，以模拟实时注入的数据流。根据输入表的数量，回放分为单表回放和多表回放，其中单表回放是最基础的回放模式，即将一个输入表回放至一个相同表结构的目标表中，以下是不包括建表语句的单表回放示例：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:1;11:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;tradeDS = replayDS(sqlObj=&amp;lt;select * from loadTable(&#34;dfs://trade&#34;, &#34;trade&#34;) where Date = 2020.12.31&amp;gt;, dateColumn=`Date, timeColumn=`Time) replay(inputTables=tradeDS, outputTables=tradeStream, dateColumn=`Date, timeColumn=`Time, replayRate=10000, absoluteRate=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:4;16:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;以上脚本将数据库 &#34;dfs://trade&#34; 中的 &#34;trade&#34; 表中 2020 年 12 月 31 日的数据以每秒 1 万条的速度注入目标表 tradeStream 中。更多关于 replay、replayDS 函数的介绍可以参考 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;data_replay.md&#34; xtrc=&#34;xref:1;16:119&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;DolphinDB 历史数据回放教程&lt;/xref&gt;。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:5;18:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;但是，单表回放并不能满足所有的回放要求。因为在实践中，一个领域问题往往需要多个不同类型的消息协作，例如金融领域的行情数据包括逐笔委托、逐笔成交、快照等，为了更好地模拟实际交易中的实时数据流，通常需要将以上三类数据同时进行回放，这时便提出了多表回放的需求。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;2-多表回放&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:3;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:3;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;2. 多表回放&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:3;19:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:6;21:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DolphinDB不断优化拓展多表回放的功能，既支持N个输入表一对一回放至N个输出表的N对N回放，又在1.30.17/2.00.5及之后的版本中支持了N个不同结构的输入表同时回放至同一个输出表的N对一异构回放，异构回放能够保证多个数据源的严格时序回放和消费。本小节将对多表回放面临的难点、相应的 DolphinDB 技术解决方案和原理展开介绍。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;21-n-对-n回放&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:4;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:4;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;2.1. N 对 N回放&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:4;23:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:7;25:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;类似单表回放的原理，replay 函数提供了N 对 N模式的多表回放，即将多个输入表回放至多个目标表，输入表与目标表一一对应。以下是N 对 N模式的多表回放的示例：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:2;27:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;orderDS = replayDS(sqlObj=&amp;lt;select * from loadTable(&#34;dfs://order&#34;, &#34;order&#34;) where Date = 2020.12.31&amp;gt;, dateColumn=`Date, timeColumn=`Time) tradeDS = replayDS(sqlObj=&amp;lt;select * from loadTable(&#34;dfs://trade&#34;, &#34;trade&#34;) where Date = 2020.12.31&amp;gt;, dateColumn=`Date, timeColumn=`Time) snapshotDS = replayDS(sqlObj=&amp;lt;select * from loadTable(&#34;dfs://snapshot&#34;, &#34;snapshot&#34;) where Date =2020.12.31&amp;gt;, dateColumn=`Date, timeColumn=`Time) replay(inputTables=[orderDS, tradeDS, snapshotDS], outputTables=[orderStream, tradeStream, snapshotStream], dateColumn=`Date, timeColumn=`Time, replayRate=10000, absoluteRate=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:8;34:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;以上脚本将三个数据库表中的历史数据分别注入三个目标表中。在N 对 N的模式中，不同表的在同一秒内的两条数据写入目标表的顺序可能和数据中的时间字段的先后关系不一致。此外，下游如果由三个处理线程分别对三个目标表进行订阅与消费，也很难保证表与表之间的数据被处理的顺序关系。因此，N 对 N回放不能保证整体上最严格的时序。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:9;36:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在实践中，一个领域中不同类型的消息是有先后顺序的，比如股票的逐笔成交和逐笔委托，所以在对多个数据源回放时要求每条数据都严格按照时间顺序注入目标表，为此我们需要解决以下问题：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:1;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:1;38:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;不同结构的数据如何统一进行排序和注入以保证整体的顺序？&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:2;39:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;如何保证对多表回放结果的实时消费也是严格按照时序进行的？&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;22-n-对-1-异构回放&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:5;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:5;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;2.2. N 对 1 异构回放&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:5;41:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:10;43:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;面对上述多表回放的难点，DolphinDB 进一步增加了异构模式的多表回放，支持将多个不同表结构的数据表写入到同一张异构流数据表中，从而实现了严格按时间顺序的多表回放。以下是异构模式的多表回放示例：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:3;45:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;orderDS = replayDS(sqlObj=&amp;lt;select * from loadTable(&#34;dfs://order&#34;, &#34;order&#34;) where Date = 2020.12.31&amp;gt;, dateColumn=`Date, timeColumn=`Time) tradeDS = replayDS(sqlObj=&amp;lt;select * from loadTable(&#34;dfs://trade&#34;, &#34;trade&#34;) where Date = 2020.12.31&amp;gt;, dateColumn=`Date, timeColumn=`Time) snapshotDS = replayDS(sqlObj=&amp;lt;select * from loadTable(&#34;dfs://snapshot&#34;, &#34;snapshot&#34;) where Date =2020.12.31&amp;gt;, dateColumn=`Date, timeColumn=`Time) inputDict = dict([&#34;order&#34;, &#34;trade&#34;, &#34;snapshot&#34;], [orderDS, tradeDS, snapshotDS]) replay(inputTables=inputDict, outputTables=messageStream, dateColumn=`Date, timeColumn=`Time, replayRate=10000, absoluteRate=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:11;53:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;异构回放时将 replay 函数的 inputTables 参数指定为字典，outputTables 参数指定为异构流数据表。inputTables 参数指定多个结构不同的数据源，字典的 key 是用户自定义的字符串，是数据源的唯一标识，将会对应 outputTables 参数指定的表的第二列，字典的 value 是通过 replayDS 定义的数据源或者表。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:12;55:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;以上脚本中的输出表 messageStream 为异构流数据表，其表结构如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:1;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:1;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:1;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:2;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:3;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:1;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:1;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:1;57:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;name&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:2;57:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;typeString&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:3;57:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;comment&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:1;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:2;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:4;59:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;msgTime&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:5;59:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;TIMESTAMP&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:6;59:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;消息时间&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:3;60:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:7;60:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;msgType&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:8;60:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;SYMBOL&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:9;60:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;数据源标识：&#34;order&#34;、&#34;trade&#34;、&#34;snapshot&#34;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:4;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:10;61:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;msgBody&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:11;61:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;BLOB&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:12;61:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;消息内容，以二进制格式存储&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:13;63:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;异构回放时 outputTables 参数指定的表至少需要包含以上三列，此外，还可以指定各输入表的公共列（列名和类型一致的列）。回放完成后，表 messageStream 的数据预览如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/stock_market_replay/messageStream.png&#34; placement=&#34;break&#34; xtrc=&#34;image:1;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; dita-ot:image-width=&#34;768&#34; dita-ot:image-height=&#34;295&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;&gt;&lt;alt class=&#34;- topic/alt &#34; xtrc=&#34;alt:1;65:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;messageStream&lt;/alt&gt;&lt;/image&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:14;67:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;表中每行记录对应输入表中的一行记录，msgTime 字段是输入表中的时间列，msgType 字段用来区分来自哪张输入表，msgBody 字段以二进制格式存储了输入表中的记录内容。在回放的过程中，通过异构流数据表这样的数据结构可以对多个数据源进行全局排序，因而保证了多个数据源之间的严格时间顺序。同时，异构流数据表和普通流数据表一样可以被订阅，即多种类型的数据存储在同一张表中被发布并被同一个线程实时处理，因而也保证了消费的严格时序性。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:15;69:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;若要对异构流数据表进行数据处理操作，如指标计算等，则需要将二进制格式的消息内容反序列化为原始结构的一行记录。DolphinDB 在脚本语言以及在 API 中均支持了对异构流数据表的解析功能。脚本支持流数据分发引擎 streamFilter 对异构流数据表进行反序列化以及反序列后结果的数据处理；同时，各类 API 在支持流数据订阅功能的基础上，扩展支持了在订阅时对异构流数据表进行反序列化。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;3-多表回放应用股票行情回放&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:6;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:6;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;3. 多表回放应用：股票行情回放&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:6;71:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:16;73:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;基于上文提到的异构回放、异构流数据表解析以及 DolphinDB 流处理框架中的其他特性等，本章将结合股票行情回放展示 DolphinDB 异构模式的多表回放功能在实际场景中的应用，包括数据回放以及三种具体的回放结果消费方案：使用内置流计算引擎实时处理数据、实时推送外部消息中间件、外部程序订阅与实时消费。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;31-行情回放与消费方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:7;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:7;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;3.1. 行情回放与消费方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:7;75:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:17;77:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;行情多表回放方案的数据处理流程图如下：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;../stream/images/stock_market_replay_1.png&#34; placement=&#34;break&#34; xtrc=&#34;image:2;79:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; dita-ot:image-width=&#34;1487&#34; dita-ot:image-height=&#34;1630&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:18;81:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;处理流程图说明：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:19;83:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;回放与消费流程围绕异构流数据表 messageStream 展开。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:20;85:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;图中异构流数据表模块以上，为异构模式的多表回放的示意图，由数据回放工具即 replay 和 replayDS 函数，将存储在多个数据库中的原始数据回放至异构流数据表中。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:21;87:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;图中异构流数据表模块以下，分为三条支路，分别对应对回放结果的三种不同的处理方式，从左至右依次是：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:2;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:3;89:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在 DolphinDB 的订阅中，通过内置的流计算引擎实时计算指标，本文将使用 asof join 引擎实时关联逐笔成交与快照数据，计算个股交易成本并写入结果流数据表；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:4;90:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在 DolphinDB 的订阅中，通过 Kafka 插件将回放结果实时写入外部的消息中间件 Kafka；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:5;91:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在外部程序中，通过 DolphinDB 的流数据 API 来实时订阅和消费回放结果，本文将使用 C++API。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;32-测试数据集&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:8;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:8;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;3.2. 测试数据集&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:8;93:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:22;95:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本教程基于上交所某日的股票行情数据进行回放，包括逐笔委托、逐笔成交、Level2 快照三种行情数据，分别存放在分布式数据库 &#34;dfs://order&#34;、&#34;dfs://trade&#34;、&#34;dfs://snapshot&#34; 中，均使用 TSDB 存储引擎，数据概览如下：&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:2;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;7&#34; xtrc=&#34;tgroup:2;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:4;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:5;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:6;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:7;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:8;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:9;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col7&#34; colnum=&#34;7&#34; xtrc=&#34;colspec:10;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:2;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:5;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:13;97:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;数据集&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:14;97:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;字段数&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:15;97:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;总行数&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:16;97:30&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;数据大小&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:17;97:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;简称&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:18;97:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;分区机制&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:19;97:77&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;排序列&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:2;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:6;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:20;99:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;逐笔委托&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:21;99:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;20&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:22;99:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;49018552&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:23;99:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.8G&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:24;99:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;order&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:25;99:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;VALUE: 交易日, HASH: [SYMBOL, 20]&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:26;99:91&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;股票, 交易时间&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:7;100:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:27;100:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;逐笔成交&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:28;100:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;15&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:29;100:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;43652718&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:30;100:35&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;3.3G&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:31;100:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;trade&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:32;100:57&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;VALUE: 交易日, HASH: [SYMBOL, 20]&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:33;100:91&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;股票, 交易时间&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:8;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:34;101:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Level2 行情快照&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:35;101:16&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;55&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:36;101:25&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;8410359&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:37;101:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;4.1G&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:38;101:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshot&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:39;101:58&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;VALUE: 交易日, HASH: [SYMBOL, 20]&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:40;101:92&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;股票, 交易时间&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:23;103:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;后文也将提供部分原始数据的 csv 文件以及对应的数据导入脚本，以便快速体验回放功能。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;33-代码实现&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:9;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:9;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;3.3. 代码实现&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:9;105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:24;107:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本教程脚本开发工具采用 DolphinDB GUI，相关环境配置见后文&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#开发环境配置&#34; xtrc=&#34;xref:2;107:36&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;开发环境配置&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;331-股票行情回放&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:10;109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:10;109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;3.3.1. 股票行情回放&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:10;109:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:25;111:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本小节脚本将三个数据库中的不同结构的数据回放至同一个异构流数据表中。完整脚本见附录 &lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/stock_market_replay/01.stockMarketReplay.txt&#34; xtrc=&#34;xref:3;111:43&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;股票行情回放. txt&lt;/xref&gt;。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:3;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:6;113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;创建异构流数据表 messageStream&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:4;115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;colName = `msgTime`msgType`msgBody colType = [TIMESTAMP,SYMBOL, BLOB] messageTemp = streamTable(1000000:0, colName, colType) enableTableShareAndPersistence(table=messageTemp, tableName=&#34;messageStream&#34;, asynWrite=true, compress=true, cacheSize=1000000, retentionMinutes=1440, flushMode=0, preCache=10000) messageTemp = NULL&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:26;123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;messageStream 是共享的异步持久化异构流数据表。为了之后能够对该表进行订阅，必须将其定义为共享的流数据表，共享意味着在当前节点的所有会话中可见。同时此处对流数据表进行持久化，其主要目的是控制该表的最大内存占用，enableTableShareAndPersistence 函数中的 cacheSize 参数规定了该表在内存中最多保留 100 万行。流数据持久化也保障了流数据的备份和恢复，当节点异常关闭后，持久化的数据会在重启时自动载入流数据表以继续流数据消费。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:4;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:7;125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;三个数据源异构回放至流数据表 messageStream&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:5;127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;timeRS = cutPoints(09:15:00.000..15:00:00.000, 100) orderDS = replayDS(sqlObj=&amp;lt;select * from loadTable(&#34;dfs://order&#34;, &#34;order&#34;) where Date = 2020.12.31&amp;gt;, dateColumn=`Date, timeColumn=`Time, timeRepartitionSchema=timeRS) tradeDS = replayDS(sqlObj=&amp;lt;select * from loadTable(&#34;dfs://trade&#34;, &#34;trade&#34;) where Date = 2020.12.31&amp;gt;, dateColumn=`Date, timeColumn=`Time, timeRepartitionSchema=timeRS) snapshotDS = replayDS(sqlObj=&amp;lt;select * from loadTable(&#34;dfs://snapshot&#34;, &#34;snapshot&#34;) where Date =2020.12.31&amp;gt;, dateColumn=`Date, timeColumn=`Time, timeRepartitionSchema=timeRS) inputDict = dict([&#34;order&#34;, &#34;trade&#34;, &#34;snapshot&#34;], [orderDS, tradeDS, snapshotDS]) submitJob(&#34;replay&#34;, &#34;replay stock market&#34;, replay, inputDict, messageStream, `Date, `Time, , , 3)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:27;137:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;上述脚本读取三个数据库中的结构不同的数据表进行全速的异构回放，回放通过 submitJob 函数提交后台作业来执行。下面讲解对于回放进行调优的相关参数和原理：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:28;139:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replayDS 函数中的 timeRepartitionSchema 参数：replayDS 函数将输入的 SQL 查询转化为数据源，其会根据输入表的分区以及 timeRepartitionSchema 参数，将原始的 SQL 查询按照时间顺序拆分成若干小的 SQL 查询。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:29;141:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replay 函数中的 parallelLevel 参数：parallelLevel 表示从数据库加载数据到内存的工作线程数量，即同时查询经过划分之后的小数据源的并行度，默认为 1，上述脚本中通过 submitjob 的参数设置为 3。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:30;143:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;对数据库表的回放过程分为两步，其一是通过 SQL 查询历史数据至内存，查询包括对数据的排序，其二是将内存中的数据写入输出表，两步以流水线的方式执行。若将某日数据全部导入内存并排序，会占用大量内存甚至导致内存不足，同时由于全部数据的查询耗时比较长，会导致第二步写入输出表的时刻也相应推迟。以 orderDS 为例，若不设置 timeRepartitionSchema 参数，则相应的 SQL 查询为：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:6;145:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;select * from loadTable(&#34;dfs://order&#34;, &#34;order&#34;) where Date = 2020.12.31 order by Time&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:31;149:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;因此针对大数据量的场景，本教程先对 replayDS 函数指定 timeRepartitionSchema 参数，将数据按照时间戳分为 100 个小数据源，则每次查询的最小单位为其中一个小数据源，同时提高 parallelLevel 参数来帮助提升查询速度。以 orderDS 为例，若设置上述 timeRepartitionSchema 参数，则相应的其中一个 SQL 查询为：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:7;151:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;select * from loadTable(&#34;dfs://order&#34;, &#34;order&#34;) where Date = 2020.12.31, 09:15:00.000 &amp;lt;= Time &amp;lt; 09:18:27.001 order by Time&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:32;155:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;后文的 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#性能测试&#34; xtrc=&#34;xref:4;155:5&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;性能测试&lt;/xref&gt; 章节利用本节的脚本进行了性能测试，最终总耗时 4m18s，内存占用峰值 4.7GB。内存主要由回放过程中的 SQL 查询和输出表等占用，通过对数据源进行切割以及对输出表进行持久化能有效控制内存使用。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:33;157:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;作业运维：在 submitJob 函数提交后，通过 getRecentJobs 函数可以查看后台作业的状态，如果 endTime 和 errorMsg 为空，说明任务正在正常运行中。也可以用 cancelJob 函数取消回放，其输入参数 jobId 通过 getRecentJobs 获取。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:34;159:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;若没有可作为数据源的数据库，也可以通过加载 csv 文件至内存中进行回放来快速体验本教程，附录中的数据文件提供了 100 支股票的某日完整行情数据，全部数据在内存中约占 700M。以下脚本需要修改 loadText 的路径为实际的 csv 文本数据存储路径。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:8;161:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;orderDS = select * from loadText(&#34;/yourDataPath/replayData/order.csv&#34;) order by Time tradeDS = select * from loadText(&#34;/yourDataPath/replayData/trade.csv&#34;) order by Time snapshotDS = select * from loadText(&#34;/yourDataPath/replayData/snapshot.csv&#34;) order by Time inputDict = dict([&#34;order&#34;, &#34;trade&#34;, &#34;snapshot&#34;], [orderDS, tradeDS, snapshotDS]) submitJob(&#34;replay&#34;, &#34;replay text&#34;, replay, inputDict, messageStream, `Date, `Time, , , 1)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;332-消费场景-1在-dolphindb-订阅中实时计算个股交易成本&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:11;170:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:11;170:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;3.3.2. 消费场景 1：在 DolphinDB 订阅中实时计算个股交易成本&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:11;170:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:35;172:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本小节脚本将实时消费小节创建的流数据表 messageStream，使用 asof join 引擎实时关联逐笔成交与快照数据，并计算个股交易成本，完整脚本见附录 &lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/stock_market_replay/02.calTradeCost_asofJoin.txt&#34; xtrc=&#34;xref:5;172:82&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;消费场景 1: 计算个股交易成本_asofJoin 实现. txt&lt;/xref&gt;。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:5;174:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:8;174:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;创建计算结果输出表 prevailingQuotes&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:9;176:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;colName = `TradeTime`SecurityID`Price`TradeQty`BidPX1`OfferPX1`Spread`SnapshotTime colType = [TIME, SYMBOL, DOUBLE, INT, DOUBLE, DOUBLE, DOUBLE, TIME] prevailingQuotesTemp = streamTable(1000000:0, colName, colType) enableTableShareAndPersistence(table=prevailingQuotesTemp, tableName=&#34;prevailingQuotes&#34;, asynWrite=true, compress=true, cacheSize=1000000, retentionMinutes=1440, flushMode=0, preCache=10000) prevailingQuotesTemp = NULL&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:36;184:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;prevailingQuotes 被定义为共享流数据表，之后可以对其进行订阅和进一步的处理。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:6;186:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:9;186:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;创建流计算 asof join 引擎&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:10;188:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;def createSchemaTable(dbName, tableName){ schema = loadTable(dbName, tableName).schema().colDefs return table(1:0, schema.name, schema.typeString) } tradeSchema = createSchemaTable(&#34;dfs://trade&#34;, &#34;trade&#34;) snapshotSchema = createSchemaTable(&#34;dfs://snapshot&#34;, &#34;snapshot&#34;) joinEngine=createAsofJoinEngine(name=&#34;tradeJoinSnapshot&#34;, leftTable=tradeSchema, rightTable=snapshotSchema, outputTable=prevailingQuotes, metrics=&amp;lt;[Price, TradeQty, BidPX1, OfferPX1, abs(Price-(BidPX1+OfferPX1)/2), snapshotSchema.Time]&amp;gt;, matchingColumn=`SecurityID, timeColumn=`Time, useSystemTime=false, delayedTime=1)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:37;199:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;使用 asof join 引擎实现在对股票分组的基础上，对于每条输入的 trade 记录，实时关联与之在时间列上最接近的一条 snapshot 记录，并使用 trade 中的价格字段和 snapshot 中的报价字段进行指标计算。最终，以上配置的 asof join 引擎会输出和左表行数相同的结果。asof join 引擎更多介绍请参考第八章 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:1;199:174&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;createAsofJoinEngine&lt;/codeph&gt;的相关介绍。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:38;201:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;考虑到实际的业务含义，此例中 asof join 引擎在用于两个数据流的实时关联时，配置参数 useSystemTime=false 以按照数据中的时间列进行关联计算。使用数据中的时间列，相较于使用数据注入引擎时的系统时间作为时间列，可以避免在实时场景中两个数据流到达引擎的时刻乱序而带来的问题。但是，在此处，因为异构回放能够严格保证两个数据流的处理顺序，因此也可以使用数据注入引擎的系统时间进行关联计算。除了在使用 asof join 引擎时配置参数 useSystemTime=true 外，使用 look up join 引擎也能够实现按系统时间进行实时关联，即当每一条 trade 表中的记录注入引擎时，总是立刻去关联已经注入引擎的最新的一条相应股票的 snapshot 记录，得到的计算结果会同上文中的 asof join 引擎实现完全一致，而由于 look up join 引擎在内部实现上更简单，所以在计算性能上会有稍好的表现，完成脚本见附录 &lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/stock_market_replay/03.calTradeCost_lookUpJoin.txt&#34; xtrc=&#34;xref:6;201:430&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;消费场景 1: 计算个股交易成本_lookUpJoin 实现. txt&lt;/xref&gt;。look up join 引擎更多介绍请参考第八章中&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:2;201:553&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;createLookUpJoinEngine&lt;/codeph&gt;的相关介绍。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:39;203:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;自定义函数 createSchemaTable，用于获取数据库表的表结构，以做为创建引擎时的参数传入。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:7;205:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:10;205:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;创建流计算过滤与分发引擎&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:11;207:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;def appendLeftStream(msg){ tempMsg = select * from msg where Price &amp;gt; 0 and Time&amp;gt;=09:30:00.000 getLeftStream(getStreamEngine(`tradeJoinSnapshot)).tableInsert(tempMsg) } filter1 = dict(STRING,ANY) filter1[&#34;condition&#34;] = &#34;trade&#34; filter1[&#34;handler&#34;] = appendLeftStream filter2 = dict(STRING,ANY) filter2[&#34;condition&#34;] = &#34;snapshot&#34; filter2[&#34;handler&#34;] = getRightStream(getStreamEngine(`tradeJoinSnapshot)) schema = dict([&#34;trade&#34;, &#34;snapshot&#34;], [tradeSchema, snapshotSchema]) engine = streamFilter(name=&#34;streamFilter&#34;, dummyTable=messageStream, filter=[filter1, filter2], msgSchema=schema)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:40;222:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;streamFilter 函数通过设置 msgSchema 参数，会对异构流数据表进行反序列，并根据 filter 参数中设置的 handler 来处理订阅的数据。当订阅数据到来时，handler 之间是串行执行的，这样就保证了对数据的处理严格按照时序进行。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:41;224:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;handler 参数是一元函数或数据表，用于处理订阅的数据。当它是函数时，其唯一的参数是经过解析和过滤后的数据表。这里对于 trade 数据其 handler 设置为函数 appendLeftStream，该函数对订阅到的数据首先做过滤，再将符合条件的数据作为左表写入到 asof join 引擎。对于 snapshot 数据其 handler 设置为 asof join 引擎的右表，表示对于订阅到的 snapshot 数据直接作为右表写入 asof join 引擎。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:8;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:11;226:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;订阅异构流数据表&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:12;228:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;subscribeTable(tableName=&#34;messageStream&#34;, actionName=&#34;tradeJoinSnapshot&#34;, offset=-1, handler=engine, msgAsTable=true, reconnect=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:42;232:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;设置参数 offset 为 -1，订阅将会从提交订阅时流数据表的当前行开始。为了消费到完整的数据，建议先执行此处脚本以提交订阅，再提交后台回放作业，参考 3.3.1 小节。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:9;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:12;234:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;查看计算结果&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/stock_market_replay/prevailingQuotes.png&#34; placement=&#34;break&#34; xtrc=&#34;image:3;236:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; dita-ot:image-width=&#34;503&#34; dita-ot:image-height=&#34;276&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:43;238:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;asof join 引擎在 matchingColumn 的分组内输出表数据与输入时的顺序一致。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;333-消费场景-2在-dolphindb-订阅中将回放结果实时推送-kafka&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:12;240:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:12;240:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;3.3.3. 消费场景 2：在 DolphinDB 订阅中将回放结果实时推送 Kafka&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:12;240:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:44;242:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本小节脚本将前文中创建的流数据表 messageStream 实时发送至消息中间件 Kafka。执行以下脚本，需要有可以写入的 Kafka server，并且安装 DolphinDB Kafka 插件，插件配置见后文&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#开发环境配置&#34; xtrc=&#34;xref:7;242:109&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;开发环境配置&lt;/xref&gt;。完整脚本见附录 &lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/stock_market_replay/04.publishToKafka.txt&#34; xtrc=&#34;xref:8;242:135&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;消费场景 2: 实时推送 Kafka.txt&lt;/xref&gt;。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:10;244:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:13;244:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;加载 Kafka 插件并创建 Kafka producer&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:13;246:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;loadPlugin(&#34;/DolphinDB/server/plugins/kafka/PluginKafka.txt&#34;) go producerCfg = dict(STRING, ANY) producerCfg[&#34;metadata.broker.list&#34;] = &#34;localhost&#34; producer = kafka::producer(producerCfg)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:45;254:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;loadPlugin 的路径和 producer 配置请按需修改。本教程涉及的 Kafka server 和 DolphinDB server 在同一台服务器上，故 metadata.broker.list 参数为 localhost。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:11;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:14;256:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;定义推送数据至 Kafka topic 的函数&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:14;258:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;def sendMsgToKafkaFunc(dataType, producer, msg){ startTime = now() try { kafka::produce(producer, &#34;topic-message&#34;, 1, msg, true) cost = now() - startTime writeLog(&#34;[Kafka Plugin] Successed to send&#34; + dataType + &#34;:&#34; + msg.size() + &#34;rows,&#34; + cost + &#34;ms.&#34;) } catch(ex) {writeLog(&#34;[Kafka Plugin] Failed to send msg to kafka with error:&#34; +ex)} }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:46;270:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;kafka::produce 函数会将任意表结构的 msg 以 json 格式发送至指定的 Kafka topic。此处的 writeLog 函数在日志中打印每批推送的情况来方便运维观察。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:12;272:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:15;272:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;注册流数据过滤与分发引擎&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:15;274:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;filter1 = dict(STRING,ANY) filter1[&#34;condition&#34;] = &#34;order&#34; filter1[&#34;handler&#34;] = sendMsgToKafkaFunc{&#34;order&#34;, producer} filter2 = dict(STRING,ANY) filter2[&#34;condition&#34;] = &#34;trade&#34; filter2[&#34;handler&#34;] = sendMsgToKafkaFunc{&#34;trade&#34;, producer} filter3 = dict(STRING,ANY) filter3[&#34;condition&#34;] = &#34;snapshot&#34; filter3[&#34;handler&#34;] = sendMsgToKafkaFunc{&#34;snapshot&#34;, producer} schema = dict([&#34;order&#34;,&#34;trade&#34;, &#34;snapshot&#34;], [loadTable(&#34;dfs://order&#34;, &#34;order&#34;), loadTable(&#34;dfs://trade&#34;, &#34;trade&#34;), loadTable(&#34;dfs://snapshot&#34;, &#34;snapshot&#34;)]) engine = streamFilter(name=&#34;streamFilter&#34;, dummyTable=messageStream, filter=[filter1, filter2, filter3], msgSchema=schema)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:47;290:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;streamFilter 函数通过设置 msgSchema 参数，会对异构流数据表进行反序列，并根据 filter 参数中设置的 handler 来处理订阅的数据。当订阅数据到来时，handler 之间是串行执行的，这样就保证了对数据的处理严格按照时序进行。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:48;292:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;handler 参数是一元函数或数据表，用于处理订阅的数据。当它是函数时，其唯一的参数是经过解析和过滤后的数据表。sendMsgToKafka{&#34;order&#34;, producer} 的写法是函数化编程中的部分应用，即指定函数 sendMsgToKafka 的部分参数，产生一个参数较少的新函数。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:13;294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:16;294:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;订阅异构流数据表&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;python&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:16;296:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;subscribeTable(tableName=&#34;messageStream&#34;, actionName=&#34;sendMsgToKafka&#34;, offset=-1, handler=engine, msgAsTable=true, reconnect=true)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:49;300:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;设置参数 offset 为 -1，订阅将会从提交订阅时流数据表的当前行开始。为了消费到完整的数据，建议先执行此处脚本以提交订阅，再提交后台回放作业，参考 3.3.1 小节。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:14;302:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:17;302:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在终端查看发送结果&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:50;304:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在命令行开启消费者进程，从第一条开始消费名为 topic-message 的 topic&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:17;307:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic topic-message&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:51;311:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;返回：&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/stock_market_replay/KafkaToipic.png&#34; placement=&#34;break&#34; xtrc=&#34;image:4;313:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; dita-ot:image-width=&#34;1582&#34; dita-ot:image-height=&#34;277&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;334-消费场景-3在外部程序中通过-capi-实时订阅与处理&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:13;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:13;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;3.3.4. 消费场景 3：在外部程序中通过 C++API 实时订阅与处理&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:13;315:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:52;317:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本小节代码为 C++ 程序，程序会订阅前文创建的异构流数据表 messageStream，并实时打印每条数据。以下代码依赖DolphinDB C++ API，API安装见后文&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#开发环境配置&#34; xtrc=&#34;xref:9;317:88&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;开发环境配置&lt;/xref&gt;。完整代码见附录 &lt;xref class=&#34;- topic/xref &#34; format=&#34;cpp&#34; href=&#34;script/stock_market_replay/05.subscribe.cpp&#34; xtrc=&#34;xref:10;317:114&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;消费场景 3:C++API 实时订阅. cpp&lt;/xref&gt;。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; outputclass=&#34;c++&#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:18;319:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;int main(int argc, char *argv[]){ DBConnection conn; string hostName = &#34;127.0.0.1&#34;; int port = 8848; bool ret = conn.connect(hostName, port); conn.run(&#34;login(\&#34;admin\&#34;, \&#34;123456\&#34;)&#34;); DictionarySP t1schema = conn.run(&#34;loadTable(\&#34;dfs://snapshotL2\&#34;, \&#34;snapshotL2\&#34;).schema()&#34;); DictionarySP t2schema = conn.run(&#34;loadTable(\&#34;dfs://trade\&#34;, \&#34;trade\&#34;).schema()&#34;); DictionarySP t3schema = conn.run(&#34;loadTable(\&#34;dfs://order\&#34;, \&#34;order\&#34;).schema()&#34;); unordered_map&amp;lt;string, DictionarySP&amp;gt; sym2schema; sym2schema[&#34;snapshot&#34;] = t1schema; sym2schema[&#34;trade&#34;] = t2schema; sym2schema[&#34;order&#34;] = t3schema; StreamDeserializerSP sdsp = new StreamDeserializer(sym2schema); auto myHandler = [&amp;amp;](Message msg) { const string &amp;amp;symbol = msg.getSymbol(); cout &amp;lt;&amp;lt; symbol &amp;lt;&amp;lt; &#34;:&#34;; size_t len = msg-&amp;gt;size(); for (int i = 0; i &amp;lt; len; i++) { cout &amp;lt;&amp;lt;msg-&amp;gt;get(i)-&amp;gt;getString() &amp;lt;&amp;lt; &#34;,&#34;; } cout &amp;lt;&amp;lt; endl; }; int listenport = 10260; ThreadedClient threadedClient(listenport); auto thread = threadedClient.subscribe(hostName, port, myHandler, &#34;messageStream&#34;, &#34;printMessageStream&#34;, -1, true, nullptr, false, false, sdsp); cout&amp;lt;&amp;lt;&#34;Successed to subscribe messageStream&#34;&amp;lt;&amp;lt;endl; thread-&amp;gt;join(); return 0; }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:53;356:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;调用订阅函数 ThreadedClient::subscribe 订阅异构流数据表时，在最后一个参数指定相应的流数据反序列化实例 StreamDeserializerSP，则在订阅时会对收到的数据进行反序列化再传递给用户自定义的回调函数 myHandler。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:54;358:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;listenport 参数为单线程客户端的订阅端口号，设置 C++ 程序所在服务器的任意空闲端口即可。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:15;360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:18;360:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在终端查看程序实时打印的内容：&lt;/li&gt;&lt;/ul&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/stock_market_replay/C++API.png&#34; placement=&#34;break&#34; xtrc=&#34;image:5;362:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; dita-ot:image-width=&#34;1574&#34; dita-ot:image-height=&#34;502&#34; dita-ot:horizontal-dpi=&#34;96&#34; dita-ot:vertical-dpi=&#34;96&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;335-清理环境&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:14;364:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:14;364:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;3.3.5. 清理环境&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:14;364:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:55;366:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;如果反复执行上述脚本，可能需要清理流数据表、取消订阅、注销流计算引擎等操作，建议在运行回放与消费脚本前先清理环境。本教程的清理环境脚本见附录 &lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/stock_market_replay/06.cleanEnvironment.txt&#34; xtrc=&#34;xref:11;366:72&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;清理环境. txt&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;4-性能测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:15;368:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:15;368:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;4. 性能测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:15;368:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:56;370:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本教程对异构模式下的多表回放功能进行了性能测试。以第三章提及的测试数据集作为回放的输入，以第三章第三小节的回放脚本作为测试脚本，该脚本不设定回放速率（即以最快的速率回放），并且输出表没有任何订阅，最终回放了 101,081,629 条数据至输出表中，总耗时 4m18s，每秒回放约 39 万条数据，内存占用峰值 4.7GB。测试使用的服务器的 CPU 为 Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz，更详细的服务器及DolphinDB server配置信息见后文&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#开发环境配置&#34; xtrc=&#34;xref:12;370:253&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;开发环境配置&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;5-开发环境配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:16;372:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:16;372:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;5. 开发环境配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:16;372:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:57;374:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:1;374:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;服务器环境&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:16;376:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:19;376:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;CPU 类型：Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:20;377:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;逻辑 CPU 总数：8&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:21;378:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;内存：64GB&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:22;379:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;OS：64 位 CentOS Linux 7 (Core)&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:58;381:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:2;381:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DolphinDB server 部署&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:17;383:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:23;383:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;server 版本：2.00.6&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:24;384:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;server 部署模式：单节点&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:25;385:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;配置文件：dolphindb.cfg&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:19;387:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;localSite=localhost:8848:local8848 mode=single maxMemSize=32 maxConnections=512 workerNum=8 maxConnectionPerSite=15 newValuePartitionPolicy=add webWorkerNum=2 dataSync=1 persistenceDir=/DolphinDB/server/persistenceDir maxPubConnections=64 subExecutors=16 subPort=8849 subThrottle=1 persistenceWorkerNum=1 lanCluster=0&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:59;406:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:3;406:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;注意&lt;/b&gt;： 配置参数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:3;406:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;persistenceDir&lt;/codeph&gt; 需要开发人员根据实际环境配置。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:60;408:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;单节点部署教程：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;standalone_server.md&#34; xtrc=&#34;xref:13;408:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;单节点部署&lt;/xref&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:61;410:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:4;410:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DolphinDB client 开发环境&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:18;412:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:26;412:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;CPU 类型：Intel(R) Core(TM) i7-7700 CPU @ 3.60GHz 3.60 GHz&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:27;413:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;逻辑 CPU 总数：8&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:28;414:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;内存：32GB&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:29;415:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;OS：Windows 10 专业版&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:30;416:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DolphinDB GUI 版本：1.30.15&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:62;418:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:5;418:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DolphinDB Kafka 插件安装&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:19;420:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:31;420:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Kafka 插件版本：release200&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:63;422:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:6;422:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;注意&lt;/b&gt;： Kafka 插件版本建议按 DolphinDB server 版本选择，如 2.00.6 版本的 server 安装 release200 分支的插件&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:64;424:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Kafka 插件教程：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;../plugins/kafka/kafka.md&#34; xtrc=&#34;xref:14;424:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;Kafka 插件教程&lt;/xref&gt;&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:65;426:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:7;426:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Kafka server 部署&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:20;428:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:32;428:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;zookeeper 版本：3.4.6&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:33;429:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Kafka 版本：2.12-2.6.2&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:34;430:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Kafka 部署模式：单节点&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:35;431:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;创建 Kafka topic&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:20;433:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;./bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 4 --topic topic-message&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:66;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:8;437:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DolphinDB C++ API 安装&lt;/b&gt;&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:21;439:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:36;439:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;C++ API 版本：release200&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:67;441:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:9;441:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;注意&lt;/b&gt;： C++API 版本建议按 DolphinDB server 版本选择，如 2.00.6 版本的 server 安装 release200 分支的 API&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:68;443:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;C++ API 教程：&lt;xref class=&#34;- topic/xref &#34; href=&#34;../api/cpp/cpp_api.dita&#34; xtrc=&#34;xref:15;443:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;C++ API 教程&lt;/xref&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6-搭建行情回放服务的最佳实践&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:17;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:17;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6. 搭建行情回放服务的最佳实践&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:17;445:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:69;447:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;一个量化策略在生产（交易）环境中运行时，实时数据的处理通常是由事件驱动的。为确保研发和生产使用同一套代码，通常在研发阶段需将历史数据，严格按照事件发生的时间顺序进行回放，以此模拟交易环境。在 DolphinDB 中，用户通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:4;447:114&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replay&lt;/codeph&gt; 函数可以实现对静态数据的回放，即将历史数据按照时间顺序以“实时数据”的方式注入流数据表中。对相同时间戳的数据还可以指定额外排序列，使数据回放顺序更接近实时交易场景。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:70;449:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;data_replay.md&#34; xtrc=&#34;xref:16;449:2&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;历史数据回放&lt;/xref&gt;、&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;stock_market_replay.md&#34; xtrc=&#34;xref:17;449:27&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;股票行情回放&lt;/xref&gt;两篇教程中已经介绍了 DolphinDB 的回放功能，本教程更加侧重于回放功能的工程化实践。本教程将介绍如何基于 DolphinDB 分布式数据库、回放功能以及 DolphinDB API 搭建一个行情数据回放服务，该服务支持多个用户同时通过 C++ 、 Python 等客户端提交数据回放请求。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;61-基于-dolphindb-的行情回放服务&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:18;452:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:18;452:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.1. 基于 DolphinDB 的行情回放服务&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:18;452:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:71;454:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本教程实现的行情回放服务基于 3 类国内 A 股行情数&#34;data_replay.md&#34;数据，支持以下功能与特性：&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:22;456:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:37;456:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;C++、Python 客户端提交回放请求（指定回放股票列表 、回放日期、回放速率、回放数据源）&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:38;457:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;多个用户同时回放&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:39;458:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;多个数据源同时有序回放&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:40;459:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在时间有序的基础上支持排序列有序（如：针对逐笔数据中的交易所原始消息记录号排序）&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:41;460:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;发布回放结束信号&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:42;461:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;对回放结果订阅消费&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;611-行情回放服务架构&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:19;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:19;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.1.1. 行情回放服务架构&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:19;463:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:72;465:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本教程示例 DolphinDB 搭建的行情回放服务架构如下图所示：&lt;/p&gt;&lt;fig align=&#34;left&#34; class=&#34;- topic/fig &#34; xtrc=&#34;fig:1;467:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:20;467:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;行情回放服务架构&lt;/title&gt; &lt;image class=&#34;- topic/image &#34; href=&#34;../stream/images/stock_market_replay_2.png&#34; xtrc=&#34;image:6;467:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; dita-ot:image-width=&#34;1487&#34; dita-ot:image-height=&#34;1410&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt; &lt;/fig&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:23;472:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:43;472:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;行情数据接入：实时行情数据和历史行情数据可以通过 DolphinDB API 或插件存储到 DolphinDB 分布式时序数据库中。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:44;473:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数模块封装：数据查询和回放过程可以通过 DolphinDB 函数视图封装内置，仅暴露股票列表 、回放日期、回放速率、回放数据源等关键参数给行情服务用户。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:45;474:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;行情用户请求：需要进行行情回放的用户可以通过 DolphinDB 客户端软件（如 DolphinDB GUI 工具、DolphinDB VS Code 插件、DolphinDB API 等）调用封装好的回放函数对存储在数据库中的行情数据进行回放，同时，用户还可以在客户端对回放结果进行实时订阅消费。此外，支持多用户并发回放。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;612-回放服务搭建步骤&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:20;476:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:21;476:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.1.2. 回放服务搭建步骤&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:20;476:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:73;478:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本教程示例 DolphinDB 搭建行情回放服务的具体操作步骤如下图所示：&lt;/p&gt;&lt;fig align=&#34;left&#34; class=&#34;- topic/fig &#34; xtrc=&#34;fig:2;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:22;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;搭建步骤&lt;/title&gt; &lt;image class=&#34;- topic/image &#34; href=&#34;../stream/images/stock_market_replay_3.png&#34; xtrc=&#34;image:7;480:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; dita-ot:image-width=&#34;1487&#34; dita-ot:image-height=&#34;542&#34; dita-ot:horizontal-dpi=&#34;72&#34; dita-ot:vertical-dpi=&#34;72&#34;/&gt; &lt;/fig&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:24;485:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:46;485:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Step 1：服务提供者设计合理分区的数据库表，在 DolphinDB 集成开发环境中执行对应的建库建表、数据导入等脚本，以将历史行情数据存储到 DolphinDB 分布式数据库中作为回放服务的数据源。在第二章将给出本教程涉及的 3 类行情数据的分区存储方案及建库建表脚本。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:47;486:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Step 2：服务提供者在 DolphinDB 集成开发环境中将回放过程中的操作封装成函数视图，通过封装使得行情服务用户不需要关心 DolphinDB 回放功能的细节，只需要指定简单的回放参数（股票、日期、回放速率、数据源）即可提交回放请求。在第三章将给全部函数视图的定义脚本。&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:48;487:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Step 3：服务提供者在外部程序中通过 DolphinDB API 调用上述函数视图实现提交回放的功能。在第四章将给出 API 端提交回放任务的 C++ 实现和 Python 实现。此外，在第四章提交回放的基础上，在第五章将介绍对回放结果的 API 端订阅与消费的代码实现。&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:74;489:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在第六章将给出多用户多表回放、多天回放的性能测试结果。最后两章为开发环境配置与总结。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;62-行情数据分区存储方案&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:21;491:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:23;491:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.2. 行情数据分区存储方案&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:21;491:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:75;493:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本教程的回放服务基于 3 类国内 A 股行情数据源：逐笔成交数据、逐笔委托数据、快照数据，均使用 TSDB 存储引擎存储在 DolphinDB 分布式数据库中。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:3;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;6&#34; xtrc=&#34;tgroup:3;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:11;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:12;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:13;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:14;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:15;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:16;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:3;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:9;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:41;495:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:10;495:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;数据源&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:42;495:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:11;495:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;代码样例中的分区数据库路径&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:43;495:32&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:12;495:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;代码样例中的表名&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:44;495:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:13;495:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;分区机制&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:45;495:79&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:14;495:80&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;排序列&lt;/b&gt;&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:46;495:95&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:15;495:96&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;建库建表脚本&lt;/b&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:3;497:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:10;497:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:47;497:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;逐笔委托&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:48;497:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;dfs://Test_order&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:49;497:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;order&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:50;497:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;VALUE: 交易日, HASH: [SYMBOL, 25]&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:51;497:101&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;股票ID，交易时间&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:52;497:113&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;附录 &lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/appendices_market_replay_bp/order_create.txt&#34; xtrc=&#34;xref:18;497:117&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;逐笔委托建库建表脚本&lt;/xref&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:11;498:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:53;498:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;逐笔成交&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:54;498:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;dfs://Test_transaction&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:55;498:44&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;transaction&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:56;498:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;VALUE: 交易日, HASH: [SYMBOL, 25]&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:57;498:101&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;股票ID，交易时间&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:58;498:113&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;附录 &lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/appendices_market_replay_bp/transac_create.txt&#34; xtrc=&#34;xref:19;498:117&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;逐笔成交建库建表脚本&lt;/xref&gt;&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:12;499:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:59;499:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;快照&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:60;499:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;dfs://Test_snapshot&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:61;499:46&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshot&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:62;499:69&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;VALUE: 交易日, HASH: [SYMBOL, 20]&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:63;499:103&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;股票ID，交易时间&lt;/entry&gt;&lt;entry align=&#34;left&#34; class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:64;499:115&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;附录 &lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/appendices_market_replay_bp/snap_create.txt&#34; xtrc=&#34;xref:20;499:119&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;快照建库建表脚本&lt;/xref&gt;&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:76;501:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;回放的原理是从数据库中读取需要的行情数据，并根据时间列排序后写入到相应的流数据表。因此，读数据库并排序的性能对回放速度有很大的影响，合理的分区机制将有助于提高数据加载速度。基于用户通常按照日期和股票提交回放请求的特点，设计了上表的分区方案。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:77;503:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;此外，本教程的历史数据存储在三节点双副本的 DolphinDB 集群中，集群和副本同样可以提升读取性能，同时可以增加系统的可用性，分区的副本通常是存放在不同的物理节点的，所以一旦某个分区不可用，系统依然可以调用其它副本分区来保证回放服务的正常运转。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:78;505:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;附录将提供部分原始数据的 csv 文件（原始行情数据文件）以及对应的示例导入脚本（逐笔委托示例导入脚本、逐笔成交示例导入脚本、快照示例导入脚本），以便读者快速体验搭建本教程所示的行情回放服务。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;63-行情回放自定义函数&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:22;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:24;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.3. 行情回放自定义函数&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:22;507:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:79;509:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本章介绍回放过程中的主要函数功能及其实现，最后将函数封装成视图以便通过 API 等方式调用。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:80;511:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本章的开发工具采用 DolphinDB GUI，完整脚本见附录：&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/appendices_market_replay_bp/replay.txt&#34; xtrc=&#34;xref:21;511:33&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;行情回放函数&lt;/xref&gt;。&lt;/p&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:4;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;3&#34; xtrc=&#34;tgroup:4;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:17;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:18;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:19;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:4;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:13;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:65;513:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数名&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:66;513:11&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数入参&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:67;513:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数功能&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:4;515:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:14;515:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:68;515:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;stkReplay&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:69;515:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;stkList：回放股票列表startDate：回放开始日期endDate：回放结束日期replayRate：回放速率replayUuid：回放用户标识replayName：回放数据源名称&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:70;515:131&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;行情回放服务主函数&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:15;516:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:71;516:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;dsTb&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:72;516:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;timeRS：数据源时间划分startDate：回放开始日期endDate：回放结束日期stkList：回放股票列表replayName：回放数据源名称&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:73;516:109&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;构造回放数据源&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:16;517:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:74;517:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;createEnd&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:75;517:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;tabName：回放输出表名称sortColumn：相同时间戳时额外排序列名&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:76;517:59&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;构造回放结束信号&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:17;518:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:77;518:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replayJob&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:78;518:14&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;inputDict：回放输入数据源tabName：回放输出表名称dateDict：回放排序时间列timeDict：回放排序时间列replayRate：回放速率sortColumn：相同时间戳时额外排序列名&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:79;518:139&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;定义回放任务内容&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;631-stkreplay-函数行情回放服务主函数&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:23;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:25;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.3.1. stkReplay 函数：行情回放服务主函数&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:23;520:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:81;522:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数定义代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:21;524:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;def stkReplay(stkList, mutable startDate, mutable endDate, replayRate, replayUuid, replayName) { maxCnt = 50 returnBody = dict(STRING, STRING) startDate = datetimeParse(startDate, &#34;yyyyMMdd&#34;) endDate = datetimeParse(endDate, &#34;yyyyMMdd&#34;) + 1 sortColumn = &#34;ApplSeqNum&#34; if(stkList.size() &amp;gt; maxCnt) { returnBody[&#34;errorCode&#34;] = &#34;0&#34; returnBody[&#34;errorMsg&#34;] = &#34;超过单次回放股票上限，最大回放上限：&#34; + string(maxCnt) return returnBody } if(size(replayName) != 0) { for(name in replayName) { if(not name in [&#34;snapshot&#34;, &#34;order&#34;, &#34;transaction&#34;]) { returnBody[&#34;errorCode&#34;] = &#34;0&#34; returnBody[&#34;errorMsg&#34;] = &#34;请输入正确的数据源名称，不能识别的数据源名称：&#34; + name return returnBody } } } else { returnBody[&#34;errorCode&#34;] = &#34;0&#34; returnBody[&#34;errorMsg&#34;] = &#34;缺少回放数据源，请输入正确的数据源名称&#34; return returnBody } try { if(size(replayName) == 1 &amp;amp;&amp;amp; replayName[0] == &#34;snapshot&#34;) { colName = [&#34;timestamp&#34;, &#34;biz_type&#34;, &#34;biz_data&#34;] colType = [TIMESTAMP, SYMBOL, BLOB] sortColumn = &#34;NULL&#34; } else { colName = [&#34;timestamp&#34;, &#34;biz_type&#34;, &#34;biz_data&#34;, sortColumn] colType = [TIMESTAMP, SYMBOL, BLOB, LONG] } msgTmp = streamTable(10000000:0, colName, colType) tabName = &#34;replay_&#34; + replayUuid enableTableShareAndPersistence(table=msgTmp, tableName=tabName, asynWrite=true, compress=true, cacheSize=10000000, retentionMinutes=60, flushMode=0, preCache=1000000) timeRS = cutPoints(09:30:00.000..15:00:00.000, 23) inputDict = dict(replayName, each(dsTb{timeRS, startDate, endDate, stkList}, replayName)) dateDict = dict(replayName, take(`MDDate, replayName.size())) timeDict = dict(replayName, take(`MDTime, replayName.size())) jobId = &#34;replay_&#34; + replayUuid jobDesc = &#34;replay stock data&#34; submitJob(jobId, jobDesc, replayJob{inputDict, tabName, dateDict, timeDict, replayRate, sortColumn}) returnBody[&#34;errorCode&#34;] = &#34;1&#34; returnBody[&#34;errorMsg&#34;] = &#34;后台回放成功&#34; return returnBody } catch(ex) { returnBody[&#34;errorCode&#34;] = &#34;0&#34; returnBody[&#34;errorMsg&#34;] = &#34;回放行情数据异常，异常信息：&#34; + ex return returnBody } }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:82;595:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数功能：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:83;597:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;自定义函数 stkReplay 是整个回放的主体函数，用户传入的参数在 stkReplay 里会进行有效性判断及格式处理，可以根据实际需求更改。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:84;599:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;首先，用 maxCnt 来控制用户一次回放股票数量的最大上限，本例中设置的是 50 。returnBody 构造了信息字典，返回给用户以提示执行错误或执行成功。回放开始日期 startDate 和回放结束日期 endDate 利用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:5;599:116&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;datetimeParse&lt;/codeph&gt;函数进行格式处理 。replayRate 是回放速率，replayUuid 是回放表名名称，replayName 是回放数据源列表，sortColumn 是数据源同回放时间戳排序列列名。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:85;601:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;当输入参数无误后，便初始化回放结果流数据表，结果流数据表为异构流数据表，字段类型为 BLOB 的字段包含了一条原始记录的全部信息，同时结果流数据表为持久化流数据表，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:6;601:83&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;enableTableShareAndPersistence&lt;/codeph&gt;函数把流数据表共享并把它持久化到磁盘上，使用持久化流数据表可以避免内存占用过大。当回放数据源包含逐笔成交（transaction ）或逐笔委托（order）时，本例实现了对相同时间戳的逐笔数据按交易所原始消息记录号（ApplSeqNum）进行排序（具体实现见 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#replayjob-函数定义回放任务内容&#34; xtrc=&#34;xref:22;601:245&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;replayJob 函数&lt;/xref&gt;），所以结果流数据表中必须冗余一列来存放排序列。若回放数据源仅包含快照（snapshot）时，则不需要冗余一列排序列。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:86;603:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;定义回放需要的其他参数。inputDict 构造了回放数据源列表字典，利用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:7;603:39&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;each&lt;/codeph&gt;函数可以对多个数据源进行简洁的定义。dateDict 和 timeDict 构造了回放数据源时间戳字典。最后通过&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:8;603:101&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;submitJob&lt;/codeph&gt;提交后台回放任务。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;632-dstb-函数构造回放数据源&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:24;605:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:26;605:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.3.2. dsTb 函数：构造回放数据源&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:24;605:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:87;607:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数定义代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:22;609:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;def dsTb(timeRS, startDate, endDate, stkList, replayName) { if(replayName == &#34;snapshot&#34;){ tab = loadTable(&#34;dfs://Test_snapshot&#34;, &#34;snapshot&#34;) } else if(replayName == &#34;order&#34;) { tab = loadTable(&#34;dfs://Test_order&#34;, &#34;order&#34;) } else if(replayName == &#34;transaction&#34;) { tab = loadTable(&#34;dfs://Test_transaction&#34;, &#34;transaction&#34;) } else { return NULL } ds = replayDS(sqlObj=&amp;lt;select * from tab where MDDate&amp;gt;=startDate and MDDate&amp;lt;endDate and HTSCSecurityID in stkList&amp;gt;, dateColumn='MDDate', timeColumn='MDTime', timeRepartitionSchema=timeRS) return ds }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:88;629:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数功能：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:89;631:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;自定义函数 dsTb 返回符合用户回放需求的数据源划分结果。主要是对内置 replayDS 函数进行了进一步的封装，函数首先对用户端输入的 replayName 进行判断，选择从数据库加载对应的表对象。利用 replayDS 对交易日期在 startDate 至 endDate 之间、股票代号在 stkList 内的数据按照 timeRS 进行数据源划分，返回某一个数据源的列表。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:90;633:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;timeRS 参数对应 replayDS 函数中的 timeRepartitionSchema 参数，是时间类型的向量，可用于将数据源划分为更小粒度的多个数据源，以保证查询 DFS 表中数据的效率以及控制内存大小。本例在 &lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;markdown&#34; format=&#34;dita&#34; href=&#34;#stkreplay-函数行情回放服务主函数&#34; xtrc=&#34;xref:23;633:112&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;stkReplay 函数&lt;/xref&gt; 中构造了 timeRS 变量，其意为对于一天的数据在有效时间段内平均分为 23 份。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:91;635:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;执行如下代码查看 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:9;635:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;dsTb&lt;/codeph&gt; 函数返回的结果：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:23;637:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;timeRS = cutPoints(09:30:00.000..15:00:00.000, 3) startDate = 2021.12.01 endDate = 2021.12.02 stkList = ['000616.SZ'] replayName = [&#34;order&#34;] ds = dsTb(timeRS, startDate, endDate, stkList, replayName)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:92;646:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;ds 为一个向量，其中每一个元素如下，数据源被划分为多个小的 SQL 查询语句，具体原理参考&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:10;646:47&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replayDS&lt;/codeph&gt;函数。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:24;648:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DataSource&amp;lt; select [4] * from tab where time(MDTime) &amp;lt; 09:30:00.000,nanotime(MDTime) &amp;gt;= 00:00:00.000000000,date(MDDate) == 2021.12.01,MDDate &amp;gt;= 2021.12.01 and MDDate &amp;lt; 2021.12.02 and SecurityID in [&#34;000616.SZ&#34;] order by MDDate asc,MDTime asc &amp;gt; DataSource&amp;lt; select [4] * from tab where time(MDTime) &amp;lt; 11:20:00.001,time(MDTime) &amp;gt;= 09:30:00.000,date(MDDate) == 2021.12.01,MDDate &amp;gt;= 2021.12.01 and MDDate &amp;lt; 2021.12.02 and SecurityID in [&#34;000616.SZ&#34;] order by MDDate asc,MDTime asc &amp;gt; DataSource&amp;lt; select [4] * from tab where time(MDTime) &amp;lt; 13:10:00.001,time(MDTime) &amp;gt;= 11:20:00.001,date(MDDate) == 2021.12.01,MDDate &amp;gt;= 2021.12.01 and MDDate &amp;lt; 2021.12.02 and SecurityID in [&#34;000616.SZ&#34;] order by MDDate asc,MDTime asc &amp;gt; DataSource&amp;lt; select [4] * from tab where time(MDTime) &amp;lt; 15:00:00.001,time(MDTime) &amp;gt;= 13:10:00.001,date(MDDate) == 2021.12.01,MDDate &amp;gt;= 2021.12.01 and MDDate &amp;lt; 2021.12.02 and SecurityID in [&#34;000616.SZ&#34;] order by MDDate asc,MDTime asc &amp;gt; DataSource&amp;lt; select [4] * from tab where nanotime(MDTime) &amp;lt;= 23:59:59.999999999,time(MDTime) &amp;gt;= 15:00:00.001,date(MDDate) == 2021.12.01,MDDate &amp;gt;= 2021.12.01 and MDDate &amp;lt; 2021.12.02 and SecurityID in [&#34;000616.SZ&#34;] order by MDDate asc,MDTime asc &amp;gt;&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;633-replayjob-函数定义回放任务内容&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:25;656:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:27;656:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.3.3. replayJob 函数：定义回放任务内容&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:25;656:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:93;658:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数定义代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:25;660:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;def replayJob(inputDict, tabName, dateDict, timeDict, replayRate, sortColumn) { if(sortColumn == &#34;NULL&#34;) { replay(inputTables=inputDict, outputTables=objByName(tabName), dateColumn=dateDict, timeColumn=timeDict, replayRate=int(replayRate), absoluteRate=false, parallelLevel=23) } else { replay(inputTables=inputDict, outputTables=objByName(tabName), dateColumn=dateDict, timeColumn=timeDict, replayRate=int(replayRate), absoluteRate=false, parallelLevel=23, sortColumns=sortColumn) } createEnd(tabName, sortColumn) }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:94;675:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数功能：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:95;677:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;自定义函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:11;677:7&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replayJob&lt;/codeph&gt; 提交用户数据回放并调用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:12;677:31&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;createEnd&lt;/codeph&gt; 函数，这里首先通过内置 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:13;677:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replay&lt;/codeph&gt; 函数回放用户需求数据，此处回放模式为 N 对 1 异构回放。&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:14;677:94&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replay&lt;/codeph&gt; 函数返回后即表示需要的数据已经全部回放结束，再执行自定义 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:15;677:132&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;createEnd&lt;/codeph&gt; 函数以构造结束信号写入回放结果里。调用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:16;677:164&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;createEnd&lt;/codeph&gt; 函数是可选的，其功能是在回放结束时再发布一条特殊的记录，以标识回放结束。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:96;679:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;参数 sortColumn 用于指定额外的排序列，如果用户回放的数据源为仅仅包含快照（snapshot），对于这种特殊情况需要指定 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:17;679:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replayJob&lt;/codeph&gt; 函数的回放时间戳排序列参数 sortColumn 为 NULL ，则调用内置的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:18;679:119&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replay&lt;/codeph&gt; 函数时不加入 sortColumn 参数。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;634-createend-函数构造回放结束信号&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:26;681:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:28;681:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.3.4. createEnd 函数：构造回放结束信号&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:26;681:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:97;683:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数定义代码：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:26;685:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;def createEnd(tabName, sortColumn) { dbName = &#34;dfs://End&#34; tbName = &#34;endline&#34; if(not existsDatabase(dbName)) { db = database(directory=dbName, partitionType=VALUE, partitionScheme=2023.04.03..2023.04.04) endTb = table(2200.01.01T23:59:59.000 as DateTime, `END as point, long(0) as ApplSeqNum) endLine = db.createPartitionedTable(table=endTb, tableName=tbName, partitionColumns=`DateTime) endLine.append!(endTb) } ds = replayDS(sqlObj=&amp;lt;select * from loadTable(dbName, tbName)&amp;gt;, dateColumn='DateTime', timeColumn='DateTime') inputEnd = dict([&#34;end&#34;], [ds]) dateEnd = dict([&#34;end&#34;], [`DateTime]) timeEnd = dict([&#34;end&#34;], [`DateTime]) if(sortColumn == &#34;NULL&#34;) { replay(inputTables=inputEnd, outputTables=objByName(tabName), dateColumn=dateEnd, timeColumn=timeEnd, replayRate=-1, absoluteRate=false, parallelLevel=1) } else { replay(inputTables=inputEnd, outputTables=objByName(tabName), dateColumn=dateEnd, timeColumn=timeEnd, replayRate=-1, absoluteRate=false, parallelLevel=1, sortColumns=sortColumn) } }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:98;714:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;函数功能：&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:99;716:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;自定义函数 createEnd 是在回放结束时给用户提供一条回放结束信号，利用了 replay 回放模式中的 N 对 1 异构回放构造回放信号，会往参数 tabName 指定的异构流数据表中写入一条消息类型列为 end 的记录。为方便后期异构消费解析以及复用，此处为结束信号独立建一个数据库并创建分区表，表内必须有时间列，其他字段可选。并向该表写入一条模拟数据，其数据内容没有任何强制要求。DolphinDB 建库建表相关知识可参考&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;database.md&#34; xtrc=&#34;xref:24;716:217&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;分区数据库&lt;/xref&gt; 。inputEnd、dateEnd、timeEnd 字典的 key 按需设置为字符串 end，将对应 replay 函数指定的输出表中的第二个字典，即消息类型。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:100;718:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;参数 sortColumn 用于指定额外的排序列，如果用户回放的数据源为仅仅包含快照（snapshot），则调用内置的 replay 函数时不加入 sortColumn 参数，结果流数据表中的结束信号记录如下。&lt;/p&gt;&lt;image class=&#34;- topic/image &#34; href=&#34;images/appendices_market_replay_bp/3_1.png&#34; xtrc=&#34;image:8;720:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; dita-ot:image-width=&#34;278&#34; dita-ot:image-height=&#34;51&#34;/&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;635-封装函数视图&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:27;722:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:29;722:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.3.5. 封装函数视图&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:27;722:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:101;724:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;将以上函数利用&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:19;724:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;addFunctionView&lt;/codeph&gt;封装成函数视图，具体代码如下。 API 端仅需要调用主函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:20;724:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;stkReplay&lt;/codeph&gt;，第四章回放全部基于该函数视图。&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:27;726:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;addFunctionView(dsTb) addFunctionView(createEnd) addFunctionView(replayJob) addFunctionView(stkReplay)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;64-api-提交回放&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:28;733:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:30;733:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.4. API 提交回放&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:28;733:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;641-c-api&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:29;735:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:31;735:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.4.1. C++ API&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:29;735:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:102;737:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本例程序运行在 Linux 系统 DolphinDB C++ API 环境下，编译成可执行文件以命令行输入参数执行。完整脚本见附录 &lt;xref class=&#34;- topic/xref &#34; format=&#34;cpp&#34; href=&#34;script/appendices_market_replay_bp/cpp_replay.cpp&#34; xtrc=&#34;xref:25;737:67&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;C++ 源码&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6411-c-api-调用回放服务&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:30;739:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:32;739:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.4.1.1. C++ API 调用回放服务&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:30;739:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:103;741:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;C++ API 调用回放服务代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:28;743:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DictionarySP result = conn.run(&#34;stkReplay&#34;, args); string errorCode = result-&amp;gt;get(Util::createString(&#34;errorCode&#34;))-&amp;gt;getString(); if (errorCode != &#34;1&#34;) { std::cout &amp;lt;&amp;lt; result-&amp;gt;getString() &amp;lt;&amp;lt; endl; return -1; }&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:104;753:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;conn 是 DolphinDB C++ API DBConnection 对象， C++ 应用可以通过它在 DolphinDB 服务器上执行脚本和函数并在两者之间双向传递数据。conn 通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:21;753:98&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;run&lt;/codeph&gt; 方法调用 stkReplay 自定义函数，args 容器内包含了 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:22;753:137&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;stkReplay&lt;/codeph&gt; 函数所需的参数。执行结果返回到字典 result 中，可以通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:23;753:181&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;get&lt;/codeph&gt; 方法来获得 key 为 errorCode 对应的值，如果错误代号不为 1 ，则代表回放执行错误，返回错误信息并结束程序。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:105;755:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;多用户进行回放时，需要对用户回放的流数据表进行命名，为了不重复命名以避免冲突，对每个回放用户生成唯一识别号，会生成形如 “Eq8Jk8Dd0Tw5Ej8D” 的识别字符串，代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:29;757:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;string uuid(int len) { char* str = (char*)malloc(len + 1); srand(getpid()); for (int i = 0; i &amp;lt; len; ++i) { switch (i % 3) { case 0: str[i] = 'A' + std::rand() % 26; break; case 1: str[i] = 'a' + std::rand() % 26; break; default: str[i] = '0' + std::rand() % 10; break; } } str[len] = '\0'; std::string rst = str; free(str); return rst; }&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;642-python-api&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:31;784:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:33;784:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.4.2. Python API&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:31;784:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:106;786:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;本例程序运行在 Windows 系统 DolphinDB Python API 环境下，可以在任何具备该环境的客户端执行。完整脚本见附录 &lt;xref class=&#34;- topic/xref &#34; format=&#34;py&#34; href=&#34;script/appendices_market_replay_bp/python_replay.py&#34; xtrc=&#34;xref:26;786:70&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;Python 源码&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6421-python-api-调用回放服务&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:32;788:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:34;788:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.4.2.1. Python API 调用回放服务&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:32;788:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:107;790:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Python API 调用回放服务代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:30;792:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;stk_list = ['000616.SZ','000681.SZ'] start_date = '20211201' end_date = '20211201' replay_rate = -1 replay_name = ['snapshot'] s.upload({'stk_list':stk_list, 'start_date':start_date, 'end_date':end_date, 'replay_rate':replay_rate, 'replay_uuid':uuidStr, 'replay_name':replay_name}) s.run(&#34;stkReplay(stk_list, start_date, end_date, replay_rate, replay_uuid, replay_name)&#34;)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:108;802:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;stk_list 是回放股票列表，start_date 是回放开始日期，end_date 是回放结束日期，replay_rate 是回放速率，replay_uuid 是回放流数据表名称，replay_name 是回放数据源列表。s 是 DolphinDB 会话，Python 应用通过会话在 DolphinDB 服务器上执行脚本和函数以及在两者之间双向传递数据。使用 s 的 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:24;802:189&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;upload&lt;/codeph&gt; 方法上传 Python 对象，使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:25;802:216&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;run&lt;/codeph&gt; 方法执行 stkReplay 函数。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:109;804:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;多用户进行回放时，需要对用户回放的流数据表进行命名，为了不重复命名以避免冲突，对每个回放用户生成唯一识别号，会生成形如“Eq8Jk8Dd0Tw5Ej8D”的识别字符串，代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:31;806:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;def uuid(length): str=&#34;&#34; for i in range(length): if(i % 3 == 0): str += chr(ord('A') + random.randint(0, os.getpid() + 1) % 26) elif(i % 3 == 1): str += chr(ord('a') + random.randint(0, os.getpid() + 1) % 26) else: str += chr(ord('0') + random.randint(0, os.getpid() + 1) % 10) return str uuidStr = uuid(16)&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;65-api-订阅消费&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:33;821:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:35;821:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5. API 订阅消费&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:33;821:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;651-c-api&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:34;823:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:36;823:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5.1. C++ API&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:34;823:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6511-反序列化器构造&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:35;825:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:37;825:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5.1.1. 反序列化器构造&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:35;825:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:110;827:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;为使异构流数据表反序列化输出，构造输出表结构，代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:32;829:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DictionarySP snap_full_schema = conn.run(&#34;loadTable(\&#34;dfs://Test_snapshot\&#34;, \&#34;snapshot\&#34;).schema()&#34;); DictionarySP order_full_schema = conn.run(&#34;loadTable(\&#34;dfs://Test_order\&#34;, \&#34;order\&#34;).schema()&#34;); DictionarySP transac_full_schema = conn.run(&#34;loadTable(\&#34;dfs://Test_transaction\&#34;, \&#34;transaction\&#34;).schema()&#34;); DictionarySP end_full_schema = conn.run(&#34;loadTable(\&#34;dfs://End\&#34;, \&#34;endline\&#34;).schema()&#34;); unordered_map&amp;lt;string, DictionarySP&amp;gt; sym2schema; sym2schema[&#34;snapshot&#34;] = snap_full_schema; sym2schema[&#34;order&#34;] = order_full_schema; sym2schema[&#34;transaction&#34;] = transac_full_schema; sym2schema[&#34;end&#34;] = end_full_schema; StreamDeserializerSP sdsp = new StreamDeserializer(sym2schema);&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:111;843:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;上述前四行分别是快照、逐笔委托、逐笔成交、结束信号的表结构构造，回放根据需要选择对应的表结构，结束信号表必须有。unordered_map 创建了 key-&amp;gt;schema 的映射表，可以将回放数据源和结束信号按照 schema 进行结构解析。通过 StreamDeserializer 对象来构造异构流数据表反序列化器。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6512-订阅回放服务&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:36;845:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:38;845:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5.1.2. 订阅回放服务&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:36;845:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:112;847:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在 DolphinDB C++ API 中订阅异构流数据表，代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:33;849:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;int listenport = 10260; ThreadedClient threadedClient(listenport); string tableNameUuid = &#34;replay_&#34; + uuidStr; auto thread = threadedClient.subscribe(hostName, port, myHandler, tableNameUuid, &#34;stkReplay&#34;, 0, true, nullptr, true, 500000, 0.001, false, &#34;admin&#34;, &#34;123456&#34;, sdsp); std::cout &amp;lt;&amp;lt; &#34;Successed to subscribe &#34; + tableNameUuid &amp;lt;&amp;lt; endl; thread-&amp;gt;join();&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:113;858:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;listenport 是单线程客户端的订阅端口号，tableNameUuid 是用户回放的流数据表名称，通过 threadedClient.subscribe 可以订阅回放的流数据表，详情用法参考 &lt;xref class=&#34;- topic/xref &#34; href=&#34;../api/cpp/cpp_api.dita&#34; xtrc=&#34;xref:27;858:101&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;C++ API 订阅&lt;/xref&gt; 。thread 指向循环调用 myHandler 的线程的指针，线程在 topic 被取消订阅后会退出。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6513-消费函数构造&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:37;860:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:39;860:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5.1.3. 消费函数构造&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:37;860:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:114;862:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;调用订阅函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:26;862:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;threadedClient.subscribe&lt;/codeph&gt; 订阅异构流数据表时，在最后一个参数指定相应的流数据反序列化实例 StreamDeserializerSP ，在订阅时会对收到的数据进行反序列化再传递给用户自定义的回调函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:27;862:121&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;myHandler&lt;/codeph&gt;，用户可以在回调函数内自定义消费，本文仅实现了简单的输出消费，当消息 msg 的标识为 end 时，通过 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:28;862:185&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;threadedClient.unsubscribe&lt;/codeph&gt; 取消订阅，代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:34;864:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;long sumcount = 0; long long starttime = Util::getNanoEpochTime(); auto myHandler = [&amp;amp;](vector&amp;lt;Message&amp;gt; msgs) { for (auto&amp;amp; msg : msgs) { std::cout &amp;lt;&amp;lt; msg.getSymbol() &amp;lt;&amp;lt; &#34; : &#34; &amp;lt;&amp;lt; msg-&amp;gt;getString() &amp;lt;&amp;lt; endl; if(msg.getSymbol() == &#34;end&#34;) { threadedClient.unsubscribe(hostName, port, tableNameUuid,&#34;stkReplay&#34;); } sumcount += msg-&amp;gt;get(0)-&amp;gt;size(); } long long speed = (Util::getNanoEpochTime() - starttime) / sumcount; std::cout &amp;lt;&amp;lt; &#34;callback speed: &#34; &amp;lt;&amp;lt; speed &amp;lt;&amp;lt; &#34;ns&#34; &amp;lt;&amp;lt; endl; };&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6514-程序执行&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:38;883:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:40;883:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5.1.4. 程序执行&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:38;883:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:115;885:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;将如上 C++ 程序代码写入 main.cpp 中，在 DolphinDB C++ API 环境下编译成可执行文件 main ，按照如下命令格式输入，回车，即可开始“回放-订阅-消费”过程。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:116;887:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;单支股票最大速度回放 “order“ 表一天数据命令：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:35;889:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;$ ./main 000616.SZ 20211201 20211201 -1 order&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:117;893:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;两支(多支)股票最大速度回放三张表一天数据命令：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:36;894:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;$ ./main 000616.SZ,000681.SZ 20211201 20211201 -1 snapshot,order,transaction&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6515-消费输出&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:39;897:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:41;897:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5.1.5. 消费输出&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:39;897:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:118;899:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;根据前文构造的消费函数，两支股票（“000616.SZ” &amp;amp;“000681.SZ”）最大速度回放三张表一天数据输出如下图所示：&lt;/p&gt;&lt;fig align=&#34;left&#34; class=&#34;- topic/fig &#34; xtrc=&#34;fig:3;901:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:42;901:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;消费输出结果&lt;/title&gt; &lt;image class=&#34;- topic/image &#34; href=&#34;images/appendices_market_replay_bp/5_1.png&#34; width=&#34;70%&#34; xtrc=&#34;image:9;901:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; dita-ot:image-width=&#34;1606&#34; dita-ot:image-height=&#34;916&#34;/&gt; &lt;/fig&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;652-python-api&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:40;908:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:43;908:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5.2. Python API&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:40;908:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6521-反序列化器构造&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:41;910:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:44;910:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5.2.1. 反序列化器构造&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:41;910:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:119;912:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;为使异构流数据表反序列化输出，Python API 通过 streamDeserializer 类来构造异构流数据表反序列化器，同时定义输出表结构，代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:37;914:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;sd = ddb.streamDeserializer({ 'snapshot': [&#34;dfs://Test_snapshot&#34;, &#34;snapshot&#34;], 'order': [&#34;dfs://Test_order&#34;, &#34;order&#34;], 'transaction': [&#34;dfs://Test_transaction&#34;, &#34;transaction&#34;], 'end': [&#34;dfs://End&#34;, &#34;endline&#34;], }, s)&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:120;923:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;上述主体部分分别是快照、逐笔委托、逐笔成交、结束信号的表结构构造，回放根据需要选择对应的表结构，结束信号表必须有。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6522-python-api-订阅回放服务&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:42;925:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:45;925:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5.2.2. Python API 订阅回放服务&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:42;925:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:121;927:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在 DolphinDB Python API 中订阅异构流数据表，代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:38;929:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;s.enableStreaming(0) s.subscribe(host=hostname, port=portname, handler=myHandler, tableName=&#34;replay_&#34;+uuidStr, actionName=&#34;replay_stock_data&#34;, offset=0, resub=False, msgAsTable=False, streamDeserializer=sd, userName=&#34;admin&#34;, password=&#34;123456&#34;) event.wait()&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:122;935:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:29;935:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;enableStreaming&lt;/codeph&gt; 函数启用流数据功能，函数参数指定开启数据订阅的端口。s 使用 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:30;935:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;subscribe&lt;/codeph&gt; 函数来订阅 DolphinDB 中的流数据表。订阅是异步执行的，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:31;935:94&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;event.wait()&lt;/codeph&gt; 保持主线程不退出。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6523-消费函数构造&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:43;937:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:46;937:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5.2.3. 消费函数构造&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:43;937:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:123;939:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;调用订阅函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:32;939:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;s.subscribe&lt;/codeph&gt; 订阅异构流数据表时，在参数指定相应的流数据反序列化实例 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:33;939:50&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;streamDeserializer&lt;/codeph&gt;,在订阅时会对收到的数据进行反序列化再传递给用户自定义的回调函数 &lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:34;939:103&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;myHandler&lt;/codeph&gt;，用户可以在回调函数内自定义消费，仅输出消费代码如下：&lt;/p&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:39;941:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;def myHandler(lst): if lst[-1] == &#34;snapshot&#34;: print(&#34;SNAPSHOT: &#34;, lst) elif lst[-1] == 'order': print(&#34;ORDER: &#34;, lst) elif lst[-1] == 'transaction': print(&#34;TRANSACTION: &#34;, lst) else: print(&#34;END: &#34;, lst) event.set()&lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;6524-消费输出&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:44;954:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:47;954:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.5.2.4. 消费输出&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:44;954:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:124;956:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;根据前文构造的消费函数，两支股票（“000616.SZ” &amp;amp;“000681.SZ”）最大速度回放三张表一天数据输出如下图所示：&lt;/p&gt;&lt;fig align=&#34;left&#34; class=&#34;- topic/fig &#34; xtrc=&#34;fig:4;958:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:48;958:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;消费输出结果&lt;/title&gt; &lt;image class=&#34;- topic/image &#34; href=&#34;images/appendices_market_replay_bp/5_2.png&#34; width=&#34;70%&#34; xtrc=&#34;image:10;958:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; dita-ot:image-width=&#34;1849&#34; dita-ot:image-height=&#34;647&#34;/&gt; &lt;/fig&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;66-性能测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:45;965:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:49;965:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.6. 性能测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:45;965:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:125;967:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;测试的交易日范围从 2021 年 12 月 1 日至 12 月 9 日共 7 个连续交易日。测试脚本见附录：&lt;xref class=&#34;- topic/xref &#34; format=&#34;cpp&#34; href=&#34;script/appendices_market_replay_bp/cpp_replay_test.cpp&#34; xtrc=&#34;xref:28;967:55&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;C++ 测试源码&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;67-测试服务器配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:46;969:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:50;969:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.7. 测试服务器配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:46;969:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:5;971:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;2&#34; xtrc=&#34;tgroup:5;971:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:20;971:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:21;971:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:5;971:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:18;971:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:80;971:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;CPU 类型&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:81;971:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:5;973:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:19;973:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:82;973:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;逻辑 CPU 总数&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:83;973:22&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;64&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:20;974:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:84;974:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;内存&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:85;974:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;503 GB&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:21;975:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:86;975:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;硬盘&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:87;975:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;SSD&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:22;976:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:88;976:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;OS&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:89;976:26&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;CentOS Linux release 7.9.2009 (Core)&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:23;977:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:90;977:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DolphinDB Server 版本&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:91;977:24&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;2.00.9.3 2023.03.29&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;671-50-支深交所股票一天全速并发回放性能测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:47;979:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:51;979:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.7.1. 50 支深交所股票一天全速并发回放性能测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:47;979:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:126;981:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;测试方法：选取深交所 2021 年 12 月 1 日 50 支交易股票数据，linux 后台同时启动多个第四章 C++ API 提交回放程序，提交多个并发回放任务。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:25;983:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:49;983:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;回放耗时=所有回放任务最晚结束时间-所有回放任务最早收到时间&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:50;984:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;回放速率=所有用户回放数据量总和/回放耗时&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:51;985:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;平均单个用户回放耗时=（所有回放任务结束时间和-所有回放任务开始时间和）/并发数量&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:52;986:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;平均单个用户回放速率=单个用户回放数据量/平均单个用户回放耗时&lt;/li&gt;&lt;/ul&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:6;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;7&#34; xtrc=&#34;tgroup:6;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:22;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:23;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:24;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:25;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col5&#34; colnum=&#34;5&#34; xtrc=&#34;colspec:26;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col6&#34; colnum=&#34;6&#34; xtrc=&#34;colspec:27;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col7&#34; colnum=&#34;7&#34; xtrc=&#34;colspec:28;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:6;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:24;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:92;988:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;并发数量&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:93;988:9&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;数据源&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:94;988:41&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;数据量&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:95;988:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;回放耗时&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:96;988:62&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;回放速率&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:97;988:69&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;单个用户回放耗时（平均）&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:98;988:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;单个用户回放速率（平均）&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:6;990:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:25;990:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:99;990:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:100;990:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransactionorder&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:101;990:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;2,775,129行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:102;990:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约2.669s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:103;990:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约104w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:104;990:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约2.669s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:105;990:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约104w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:26;991:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:106;991:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;10&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:107;991:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransactionorder&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:108;991:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;27,751,290行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:109;991:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约10.161s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:110;991:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约273w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:111;991:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约8.482s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:112;991:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约32w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:27;992:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:113;992:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;20&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:114;992:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransactionorder&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:115;992:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;55,502,580行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:116;992:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约18.761s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:117;992:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约296w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:118;992:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约16.728s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:119;992:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约16w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:28;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:120;993:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;40&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:121;993:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransactionorder&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:122;993:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;111,005,160行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:123;993:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约35.537s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:124;993:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约312w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:125;993:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约19.091s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:126;993:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约14w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:29;994:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:127;994:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:128;994:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransaction&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:129;994:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;1,416,548行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:130;994:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约2.003s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:131;994:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约70w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:132;994:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约2.003s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:133;994:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约70w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:30;995:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:134;995:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;10&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:135;995:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransaction&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:136;995:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;14,165,480行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:137;995:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约7.155s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:138;995:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约198w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:139;995:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约6.382s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:140;995:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约22w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:31;996:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:141;996:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;20&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:142;996:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransaction&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:143;996:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;28,330,960行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:144;996:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约13.115s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:145;996:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约216w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:146;996:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约11.436s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;8&#34; xtrc=&#34;entry:147;996:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约12w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:32;997:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:148;997:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;40&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:149;997:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransaction&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:150;997:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;56,661,920行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:151;997:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约27.003s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:152;997:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约210w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:153;997:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约13.740s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;9&#34; xtrc=&#34;entry:154;997:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约10w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:33;998:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:155;998:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;1&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:156;998:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshot&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:157;998:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;194,045行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:158;998:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约1.387s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:159;998:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约14w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:160;998:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约1.387s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;10&#34; xtrc=&#34;entry:161;998:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约14w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:34;999:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:162;999:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;10&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:163;999:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshot&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:164;999:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;1,940,450行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:165;999:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约6.428s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:166;999:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约30w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:167;999:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约5.128s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;11&#34; xtrc=&#34;entry:168;999:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约4w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:35;1000:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:169;1000:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;20&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:170;1000:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshot&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:171;1000:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;3,880,900行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:172;1000:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约11.782s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:173;1000:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约33w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:174;1000:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约10.539s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;12&#34; xtrc=&#34;entry:175;1000:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约2w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:36;1001:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:176;1001:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;40&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:177;1001:13&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshot&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:178;1001:48&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;7,761,800行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:179;1001:63&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约23.274s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col5&#34; dita-ot:x=&#34;5&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:180;1001:74&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约33w/s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col6&#34; dita-ot:x=&#34;6&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:181;1001:84&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约12.393s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col7&#34; dita-ot:x=&#34;7&#34; dita-ot:y=&#34;13&#34; xtrc=&#34;entry:182;1001:110&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约1w/s&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;672-50-支深交所股票跨天全速回放性能测试&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:48;1003:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:52;1003:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.7.2. 50 支深交所股票跨天全速回放性能测试&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:48;1003:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:127;1005:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;测试方法：选取深交所 50 支交易股票数据，linux 后台启动第四章 C++ API 提交回放程序，提交多天回放任务。&lt;/p&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:26;1007:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:53;1007:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;回放耗时=回放任务结束时间-回放任务收到时间&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:54;1008:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;回放速率=回放数据量/回放耗时&lt;/li&gt;&lt;/ul&gt;&lt;table class=&#34;- topic/table &#34; xtrc=&#34;table:7;1010:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;tgroup class=&#34;- topic/tgroup &#34; cols=&#34;4&#34; xtrc=&#34;tgroup:7;1010:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col1&#34; colnum=&#34;1&#34; xtrc=&#34;colspec:29;1010:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col2&#34; colnum=&#34;2&#34; xtrc=&#34;colspec:30;1010:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col3&#34; colnum=&#34;3&#34; xtrc=&#34;colspec:31;1010:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;colspec class=&#34;- topic/colspec &#34; colname=&#34;col4&#34; colnum=&#34;4&#34; xtrc=&#34;colspec:32;1010:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;thead class=&#34;- topic/thead &#34; xtrc=&#34;thead:7;1010:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:37;1010:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:183;1010:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;数据源&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:184;1010:34&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;数据量&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:185;1010:52&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;回放耗时&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;1&#34; xtrc=&#34;entry:186;1010:60&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;回放速率&lt;/entry&gt;&lt;/row&gt;&lt;/thead&gt;&lt;tbody class=&#34;- topic/tbody &#34; xtrc=&#34;tbody:7;1012:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:38;1012:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:187;1012:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransactionorder&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:188;1012:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;一天：2,775,129行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:189;1012:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约2.925s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;2&#34; xtrc=&#34;entry:190;1012:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约95w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:39;1013:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:191;1013:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransactionorder&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:192;1013:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;一周：17,366,642行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:193;1013:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约16.393s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;3&#34; xtrc=&#34;entry:194;1013:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约106w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:40;1014:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:195;1014:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransaction&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:196;1014:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;一天：1,416,548行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:197;1014:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约1.912s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;4&#34; xtrc=&#34;entry:198;1014:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约74w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:41;1015:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:199;1015:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshottransaction&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:200;1015:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;一周：8,899,562行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:201;1015:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约9.142s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;5&#34; xtrc=&#34;entry:202;1015:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约97w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:42;1016:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:203;1016:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshot&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:204;1016:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;一天：194,045行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:205;1016:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约1.267s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;6&#34; xtrc=&#34;entry:206;1016:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约15w/s&lt;/entry&gt;&lt;/row&gt;&lt;row class=&#34;- topic/row &#34; xtrc=&#34;row:43;1017:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col1&#34; dita-ot:x=&#34;1&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:207;1017:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;snapshot&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col2&#34; dita-ot:x=&#34;2&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:208;1017:37&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;一周：1,279,869行&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col3&#34; dita-ot:x=&#34;3&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:209;1017:54&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约6.659s&lt;/entry&gt;&lt;entry class=&#34;- topic/entry &#34; colname=&#34;col4&#34; dita-ot:x=&#34;4&#34; dita-ot:y=&#34;7&#34; xtrc=&#34;entry:210;1017:65&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;约19w/s&lt;/entry&gt;&lt;/row&gt;&lt;/tbody&gt;&lt;/tgroup&gt;&lt;/table&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;68-开发环境配置&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:49;1019:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:53;1019:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.8. 开发环境配置&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:49;1019:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;/&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;681-部署-dolphindb-server&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:50;1021:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:54;1021:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.8.1. 部署 DolphinDB Server&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:50;1021:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:27;1023:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:55;1023:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Server 版本：2.00.9.3 2023.03.29&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:56;1024:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Server 部署模式：单服务器集群&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:57;1025:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;配置文件：&lt;i class=&#34;+ topic/ph hi-d/i &#34; xtrc=&#34;i:1;1025:8&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;cluster.cfg&lt;/i&gt;&lt;/li&gt;&lt;/ul&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; xtrc=&#34;codeblock:40;1027:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;maxMemSize=128 maxConnections=5000 workerNum=24 webWorkerNum=2 chunkCacheEngineMemSize=16 newValuePartitionPolicy=add logLevel=INFO maxLogSize=512 node1.volumes=/ssd/ssd3/pocTSDB/volumes/node1,/ssd/ssd4/pocTSDB/volumes/node1 node2.volumes=/ssd/ssd5/pocTSDB/volumes/node2,/ssd/ssd6/pocTSDB/volumes/node2 node3.volumes=/ssd/ssd7/pocTSDB/volumes/node3,/ssd/ssd8/pocTSDB/volumes/node3 diskIOConcurrencyLevel=0 node1.redoLogDir=/ssd/ssd3/pocTSDB/redoLog/node1 node2.redoLogDir=/ssd/ssd4/pocTSDB/redoLog/node2 node3.redoLogDir=/ssd/ssd5/pocTSDB/redoLog/node3 node1.chunkMetaDir=/ssd/ssd3/pocTSDB/metaDir/chunkMeta/node1 node2.chunkMetaDir=/ssd/ssd4/pocTSDB/metaDir/chunkMeta/node2 node3.chunkMetaDir=/ssd/ssd5/pocTSDB/metaDir/chunkMeta/node3 node1.persistenceDir=/ssd/ssd6/pocTSDB/persistenceDir/node1 node2.persistenceDir=/ssd/ssd7/pocTSDB/persistenceDir/node2 node3.persistenceDir=/ssd/ssd8/pocTSDB/persistenceDir/node3 maxPubConnections=128 subExecutors=24 subThrottle=1 persistenceWorkerNum=1 node1.subPort=8825 node2.subPort=8826 node3.subPort=8827 maxPartitionNumPerQuery=200000 streamingHAMode=raft streamingRaftGroups=2:node1:node2:node3 node1.streamingHADir=/ssd/ssd6/pocTSDB/streamingHADir/node1 node2.streamingHADir=/ssd/ssd7/pocTSDB/streamingHADir/node2 node3.streamingHADir=/ssd/ssd8/pocTSDB/streamingHADir/node3 TSDBCacheEngineSize=16 TSDBCacheEngineCompression=false node1.TSDBRedoLogDir=/ssd/ssd3/pocTSDB/TSDBRedoLogDir/node1 node2.TSDBRedoLogDir=/ssd/ssd4/pocTSDB/TSDBRedoLogDir/node2 node3.TSDBRedoLogDir=/ssd/ssd5/pocTSDB/TSDBRedoLogDir/node3 TSDBLevelFileIndexCacheSize=20 TSDBLevelFileIndexCacheInvalidPercent=0.6 lanCluster=0 enableChunkGranularityConfig=true&lt;/codeblock&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:128;1073:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:16;1073:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;注意&lt;/b&gt;： 路径配置参数需要开发人员根据实际环境配置。&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:129;1075:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;有关单服务器集群部署教程，请参考：&lt;xref class=&#34;- topic/xref &#34; dita-ot:orig-format=&#34;md&#34; format=&#34;dita&#34; href=&#34;single_machine_cluster_deploy.md&#34; xtrc=&#34;xref:29;1075:18&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;单服务器集群部署&lt;/xref&gt;。&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;682-dolphindb-client-开发环境&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:51;1077:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:55;1077:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.8.2. DolphinDB client 开发环境&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:51;1077:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:28;1079:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:58;1079:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;CPU 类型：Intel(R) Core(TM) i5-11500 @ 2.70GHz 2.71 GHz&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:59;1080:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;逻辑 CPU 总数：12&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:60;1081:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;内存：16GB&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:61;1082:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;OS：Windows 11 专业版&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:62;1083:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;DolphinDB GUI 版本：1.30.20.1&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;683-dolphindb-c-api-安装&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:52;1086:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:56;1086:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.8.3. DolphinDB C++ API 安装&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:52;1086:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:29;1088:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:63;1088:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;C++ API 版本：release200.9&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:130;1090:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;b class=&#34;+ topic/ph hi-d/b &#34; xtrc=&#34;b:17;1090:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;注意&lt;/b&gt;： C++ API 版本建议按 DolphinDB server 版本选择，如 2.00.9 版本的 server 安装 release200.9 分支的 API&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:131;1092:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;C++ API 教程：&lt;xref class=&#34;- topic/xref &#34; href=&#34;../api/cpp/cpp_api.dita&#34; xtrc=&#34;xref:30;1092:12&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;C++ API 教程&lt;/xref&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;684-dolphindb-python-api-安装&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:53;1094:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:57;1094:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.8.4. DolphinDB Python API 安装&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:53;1094:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:30;1096:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:64;1096:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Python API 版本：1.30.21.1&lt;/li&gt;&lt;/ul&gt;&lt;p class=&#34;- topic/p &#34; xtrc=&#34;p:132;1098:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;Python API 教程：&lt;xref class=&#34;- topic/xref &#34; href=&#34;../api/python/py.dita&#34; xtrc=&#34;xref:31;1098:15&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34; type=&#34;topic&#34;&gt;&lt;?ditaot usertext?&gt;Python API 教程&lt;/xref&gt;&lt;/p&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;69-路线图-roadmap&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:54;1102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:58;1102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;6.9. 路线图 (Roadmap)&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:54;1102:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:31;1104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:65;1104:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在后续版本中，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:35;1104:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replay&lt;/codeph&gt; 函数将支持原速回放，即严格以两条记录的时间戳之差为输出间隔向下游注入数据；&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:66;1105:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;在后续版本中，&lt;codeph class=&#34;+ topic/ph pr-d/codeph &#34; xtrc=&#34;codeph:36;1105:10&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;replay&lt;/codeph&gt; 函数将支持原速倍速回放，即严格以两条记录的时间戳之差为输出间隔进行倍速再向下游注入数据。&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34; id=&#34;7-附录&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; xtrc=&#34;topic:55;1108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrc=&#34;title:59;1108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;7. 附录&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrc=&#34;body:55;1108:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;ul class=&#34;- topic/ul &#34; xtrc=&#34;ul:32;1110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:67;1110:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/stock_market_replay/01.stockMarketReplay.txt&#34; xtrc=&#34;xref:32;1110:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;股票行情回放.txt&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:68;1111:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/stock_market_replay/02.calTradeCost_asofJoin.txt&#34; xtrc=&#34;xref:33;1111:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;消费场景1：计算个股交易成本 _asofJoin 实现.txt&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:69;1112:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/stock_market_replay/03.calTradeCost_lookUpJoin.txt&#34; xtrc=&#34;xref:34;1112:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;消费场景1：计算个股交易成本 _lookUpJoin 实现.txt&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:70;1113:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/stock_market_replay/04.publishToKafka.txt&#34; xtrc=&#34;xref:35;1113:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;消费场景2：实时推送 Kafka.txt&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:71;1114:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;cpp&#34; href=&#34;script/stock_market_replay/05.subscribe.cpp&#34; xtrc=&#34;xref:36;1114:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;消费场景3：C++API 实时订阅.cpp&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:72;1115:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/stock_market_replay/06.cleanEnvironment.txt&#34; xtrc=&#34;xref:37;1115:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;清理环境.txt&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:73;1116:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;https://www.dolphindb.cn/downloads/docs/stock_market_replay.zip&#34; scope=&#34;external&#34; xtrc=&#34;xref:38;1116:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;样例数据：order.csv, trade.csv与snapshot.csv&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:74;1117:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;zip&#34; href=&#34;https://www.dolphindb.cn/downloads/docs/appendices_market_replay_bp_data.zip&#34; scope=&#34;external&#34; xtrc=&#34;xref:39;1117:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;原始行情数据文件&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:75;1118:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/appendices_market_replay_bp/order_create.txt&#34; xtrc=&#34;xref:40;1118:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;逐笔委托建库建表脚本&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:76;1119:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/appendices_market_replay_bp/transac_create.txt&#34; xtrc=&#34;xref:41;1119:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;逐笔成交建库建表脚本&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:77;1120:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/appendices_market_replay_bp/snap_create.txt&#34; xtrc=&#34;xref:42;1120:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;快照建库建表脚本&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:78;1121:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/appendices_market_replay_bp/order_upload.txt&#34; xtrc=&#34;xref:43;1121:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;逐笔委托示例导入脚本&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:79;1122:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/appendices_market_replay_bp/transac_upload.txt&#34; xtrc=&#34;xref:44;1122:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;逐笔成交示例导入脚本&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:80;1123:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/appendices_market_replay_bp/snap_upload.txt&#34; xtrc=&#34;xref:45;1123:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;快照示例导入脚本&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:81;1124:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;txt&#34; href=&#34;script/appendices_market_replay_bp/replay.txt&#34; xtrc=&#34;xref:46;1124:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;行情回放函数&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:82;1125:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;cpp&#34; href=&#34;script/appendices_market_replay_bp/cpp_replay.cpp&#34; xtrc=&#34;xref:47;1125:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;C++ 源码&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:83;1126:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;py&#34; href=&#34;script/appendices_market_replay_bp/python_replay.py&#34; xtrc=&#34;xref:48;1126:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;Python 源码&lt;/xref&gt;&lt;/li&gt;&lt;li class=&#34;- topic/li &#34; xtrc=&#34;li:84;1127:1&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;xref class=&#34;- topic/xref &#34; format=&#34;cpp&#34; href=&#34;script/appendices_market_replay_bp/cpp_replay_test.cpp&#34; xtrc=&#34;xref:49;1127:3&#34; xtrf=&#34;file:/var/lib/jenkins/workspace/packDocCN/documentation/zh/tutorials/stock_market_replay.md&#34;&gt;&lt;?ditaot usertext?&gt;C++ 测试源码&lt;/xref&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="tutorials/stock_market_replay.md"/><meta name="wh-out-relpath" content="tutorials/stock_market_replay_2.html"/>

    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/commons.css?buildId=2024012323"/>
    <link rel="stylesheet" type="text/css" href="../oxygen-webhelp/app/topic.css?buildId=2024012323"/>

    <script src="../oxygen-webhelp/app/options/properties.js?buildId=20240704100525"></script>
    <script src="../oxygen-webhelp/app/localization/strings.js?buildId=2024012323"></script>
    <script src="../oxygen-webhelp/app/search/index/keywords.js?buildId=20240704100525"></script>
    <script defer="defer" src="../oxygen-webhelp/app/commons.js?buildId=2024012323"></script>
    <script defer="defer" src="../oxygen-webhelp/app/topic.js?buildId=2024012323"></script>
<link rel="stylesheet" type="text/css" href="../oxygen-webhelp/template/styles.css?buildId=2024012323"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script></head>

    <body id="股票行情回放" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            跳转到主要内容
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div xmlns:whc="http://www.oxygenxml.com/webhelp/components" class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="https://www.dolphindb.cn" class=" wh_logo d-none d-sm-block "><img src="../logo.png" alt="  DolphinDB 文档中心  "/></a>
                    <div class=" wh_publication_title "><a href="../index.html"><span class="booktitle">  <span class="ph mainbooktitle">DolphinDB 文档中心</span>  </span></a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="../search.html"><div><input type="search" placeholder="搜索 " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="搜索查询" required="required"/><button type="submit" class="wh_search_button" aria-label="搜索"><span class="search_input_text">搜索</span></button></div></form>
            
            <script src="/vendors/react/umd/react.production.min.js" defer="defer"></script>
<script src="/vendors/react-dom/umd/react-dom.production.min.js" defer="defer"></script>
<script src="/vendors/dayjs/dayjs.min.js" defer="defer"></script>
<script src="/vendors/antd/dist/antd.min.js" defer="defer"></script>
<script src="/vendors/@ant-design/icons/dist/index.umd.min.js" defer="defer"></script>
<script src="/zh/index.js" type="module"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer="defer"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer="defer"><!--


--></script>

            
        </div></div>
    </div>
</header>
        
        
         
        
        
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="../index.html"><span>主页</span></a></span></li><li><div class="topicref" data-id="about_tutorials"><div class="title"><a href="../tutorials/about_tutorials.html"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div></li><li><div class="topicref"><div class="title"><a href="../tutorials/dolphinscheduler_integration.html">金融场景案例</a></div></div></li><li class="active"><div class="topicref" data-id="股票行情回放"><div class="title"><a href="../tutorials/stock_market_replay_2.html">股票行情回放</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="切换搜索突出显示" title="切换搜索突出显示"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="折叠截面" title="折叠截面"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="打印此页" aria-label="打印此页"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem"><div data-tocid="new_chap_about_sect_ddb_docs_intro-d9529e87" class="topicref" data-id="new_chap_about_sect_ddb_docs_intro" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../about/ddb_docs_intro.html" id="new_chap_about_sect_ddb_docs_intro-d9529e87-link">文档使用说明</a><div class="wh-tooltip"><p class="shortdesc">如何获取 DolphinDB 帮助信息</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap1_getstarted-d9529e140" class="topicref" data-id="chap1_getstarted" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap1_getstarted-d9529e140-link" class="wh-expand-btn"></span><div class="title"><a href="../getstarted/chap1_getstarted.html" id="chap1_getstarted-d9529e140-link"><span class="keyword label">快速上手</span></a><div class="wh-tooltip"><p class="shortdesc">如何快速部署 DolphinDB、建库建表、写入和查询数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="sectionddb_deployment-d9529e335" class="topicref" data-id="sectionddb_deployment" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action sectionddb_deployment-d9529e335-link" class="wh-expand-btn"></span><div class="title"><a href="../deploy/deploy_intro.html" id="sectionddb_deployment-d9529e335-link"><span class="keyword label">部署</span></a><div class="wh-tooltip"><p class="shortdesc">如何在不同的场景中部署 DolphinDB</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="new_chap_database_manage_new_chap_dbmanage_landing_page-d9529e2313" class="topicref" data-id="new_chap_database_manage_new_chap_dbmanage_landing_page" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action new_chap_database_manage_new_chap_dbmanage_landing_page-d9529e2313-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/cfg/db_intro.html" id="new_chap_database_manage_new_chap_dbmanage_landing_page-d9529e2313-link"><span class="keyword label">数据库</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 数据库的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_streaming-d9529e3490" class="topicref" data-id="chap7_tutorials_streaming" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_streaming-d9529e3490-link" class="wh-expand-btn"></span><div class="title"><a href="../stream/str_intro.html" id="chap7_tutorials_streaming-d9529e3490-link"><span class="keyword label">流数据</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 流数据引擎及流数据计算的基本概念</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e7385" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e7385-link" class="wh-expand-btn"></span><div class="title"><a href="../db_distr_comp/db_oper/import_data.html" id="tocId-d9529e7385-link">数据迁移</a><div class="wh-tooltip"><p class="shortdesc">如何从不同数据源向 DolphinDB 迁移数据</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_system_management-d9529e7812" class="topicref" data-id="chap7_tutorials_system_management" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_system_management-d9529e7812-link" class="wh-expand-btn"></span><div class="title"><a href="../sys_man/om_intro.html" id="chap7_tutorials_system_management-d9529e7812-link"><span class="keyword label">系统运维</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 的系统运维功能及方法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="about_language_resources-d9529e16490" class="topicref" data-id="about_language_resources" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action about_language_resources-d9529e16490-link" class="wh-expand-btn"></span><div class="title"><a href="../progr/progr_intro.html" id="about_language_resources-d9529e16490-link"><span class="keyword label">编程语言</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 编程基本概念与方法、SQL 在 DolphinDB 的应用</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="functions_references-d9529e26503" class="topicref" data-id="functions_references" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action functions_references-d9529e26503-link" class="wh-expand-btn"></span><div class="title"><a href="../funcs/funcs_intro.html" id="functions_references-d9529e26503-link"><span class="keyword label">函数参考</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 函数分类、语法、详解及示例</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="api_protocol-d9529e86456" class="topicref" data-id="api_protocol" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action api_protocol-d9529e86456-link" class="wh-expand-btn"></span><div class="title"><a href="../api/connapi_intro.html" id="api_protocol-d9529e86456-link"><span class="keyword label">连接器 &amp; API</span></a><div class="wh-tooltip"><p class="shortdesc">面向不同编程语言的 DolphinDB API 及连接器，相关协议和用法</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap6_plugin-d9529e91976" class="topicref" data-id="chap6_plugin" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap6_plugin-d9529e91976-link" class="wh-expand-btn"></span><div class="title"><a href="../plugins/plg_intro.html" id="chap6_plugin-d9529e91976-link"><span class="keyword label">插件</span></a><div class="wh-tooltip"><p class="shortdesc">多个应用场景的插件使用说明和插件开发指导</p></div></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="third_party-d9529e94749" class="topicref" data-id="third_party" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action third_party-d9529e94749-link" class="wh-expand-btn"></span><div class="title"><a href="../third_party.html" id="third_party-d9529e94749-link">第三方工具</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="about_tutorials-d9529e94980" class="topicref" data-id="about_tutorials" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action about_tutorials-d9529e94980-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/about_tutorials.html" id="about_tutorials-d9529e94980-link"><span class="keyword label">教程</span></a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 产品使用教程</p></div></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e95033" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e95033-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/import_data.html" id="tocId-d9529e95033-link">数据导入</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e95264" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e95264-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DolphinDB_TopN.html" id="tocId-d9529e95264-link">数据库</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e95910" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e95910-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/memory_management.html" id="tocId-d9529e95910-link">系统运维</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e96325" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e96325-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hybrid_programming_paradigms.html" id="tocId-d9529e96325-link">编程语言</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e97155" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e97155-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/data_sync_among_clusters.html" id="tocId-d9529e97155-link">安全与容灾</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e97386" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e97386-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_tutorial.html" id="tocId-d9529e97386-link">流数据</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e97893" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e97893-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DECIMAL.html" id="tocId-d9529e97893-link">数值处理</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="chap7_tutorials_modules-d9529e97986" class="topicref" data-id="chap7_tutorials_modules" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action chap7_tutorials_modules-d9529e97986-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/tu_modules.html" id="chap7_tutorials_modules-d9529e97986-link"><span class="keyword label">模块</span></a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="plugins_apply-d9529e98493" class="topicref" data-id="plugins_apply" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action plugins_apply-d9529e98493-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/plugins_apply.html" id="plugins_apply-d9529e98493-link">插件应用</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="tocId-d9529e98631" class="topicref" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action tocId-d9529e98631-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphinscheduler_integration.html" id="tocId-d9529e98631-link">金融场景案例</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="dolphindb-与-dolphinscheduler-的集成-d9529e98632" class="topicref" data-id="dolphindb-与-dolphinscheduler-的集成" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/dolphinscheduler_integration.html" id="dolphindb-与-dolphinscheduler-的集成-d9529e98632-link">DolphinDB 与 DolphinScheduler 的集成</a></div></div></li><li role="treeitem"><div data-tocid="gplearn-d9529e98678" class="topicref" data-id="gplearn" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/gplearn.html" id="gplearn-d9529e98678-link">Shark GPLearn 快速上手</a></div></div></li><li role="treeitem"><div data-tocid="量化金融范例-d9529e98724" class="topicref" data-id="量化金融范例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/quant_finance_examples.html" id="量化金融范例-d9529e98724-link">量化金融范例</a></div></div></li><li role="treeitem"><div data-tocid="利用缓存表快速实现-mysql-库间信息同步-d9529e98770" class="topicref" data-id="利用缓存表快速实现-mysql-库间信息同步" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/cachedtable.html" id="利用缓存表快速实现-mysql-库间信息同步-d9529e98770-link">利用缓存表快速实现 MySQL 库间信息同步</a></div></div></li><li role="treeitem"><div data-tocid="机器学习-d9529e98816" class="topicref" data-id="机器学习" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/machine_learning.html" id="机器学习-d9529e98816-link">机器学习</a></div></div></li><li role="treeitem"><div data-tocid="时区处理-d9529e98862" class="topicref" data-id="时区处理" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/timezone.html" id="时区处理-d9529e98862-link">时区处理</a></div></div></li><li role="treeitem"><div data-tocid="实时计算高频因子-d9529e98908" class="topicref" data-id="实时计算高频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/hf_factor_streaming_2.html" id="实时计算高频因子-d9529e98908-link">实时计算高频因子</a></div></div></li><li role="treeitem"><div data-tocid="计算基金日频因子-d9529e98954" class="topicref" data-id="计算基金日频因子" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/fund_factor_contrasted_by_py.html" id="计算基金日频因子-d9529e98954-link">计算基金日频因子</a></div></div></li><li role="treeitem"><div data-tocid="因子计算最佳实践-d9529e99000" class="topicref" data-id="因子计算最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practice_for_factor_calculation.html" id="因子计算最佳实践-d9529e99000-link">因子计算最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="因子计算平台构建-d9529e99046" class="topicref" data-id="因子计算平台构建" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Python_Celery.html" id="因子计算平台构建-d9529e99046-link">因子计算平台构建</a></div></div></li><li role="treeitem"><div data-tocid="金融因子流式实现-d9529e99092" class="topicref" data-id="金融因子流式实现" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/str_comp_fin_quant_2.html" id="金融因子流式实现-d9529e99092-link">金融因子流式实现</a></div></div></li><li role="treeitem"><div data-tocid="中高频多因子库存储最佳实践-d9529e99139" class="topicref" data-id="中高频多因子库存储最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practices_for_multi_factor.html" id="中高频多因子库存储最佳实践-d9529e99139-link">中高频多因子库存储最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比-d9529e99185" class="topicref" data-id="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Python_HDF5_vs_DolphinDB.html" id="python--hdf5-因子计算与-dolphindb-一体化因子计算方案对比-d9529e99185-link">Python + HDF5 因子计算与 DolphinDB 一体化因子计算方案对比</a></div></div></li><li role="treeitem"><div data-tocid="python--文件存储与-dolphindb-因子计算性能比较-d9529e99231" class="topicref" data-id="python--文件存储与-dolphindb-因子计算性能比较" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/DolphinDB_VS_PythonFile_Storage.html" id="python--文件存储与-dolphindb-因子计算性能比较-d9529e99231-link">Python + 文件存储与 DolphinDB 因子计算性能比较</a></div></div></li><li role="treeitem"><div data-tocid="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9529e99277" class="topicref" data-id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_snapshot_factor_calc_2.html" id="快速搭建-level-2-快照数据流批一体因子计算平台最佳实践-d9529e99277-link">快速搭建 Level-2 快照数据流批一体因子计算平台最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="k-线计算-d9529e99323" class="topicref" data-id="k-线计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/OHLC_2.html" id="k-线计算-d9529e99323-link">K 线计算</a></div></div></li><li role="treeitem"><div data-tocid="mvo_tutorial-d9529e99369" class="topicref" data-id="mvo_tutorial" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/MVO.html" id="mvo_tutorial-d9529e99369-link">优化投资组合：DolphinDB 最优化求解系列函数应用指南</a></div></div></li><li role="treeitem"><div data-tocid="面板数据处理-d9529e99415" class="topicref" data-id="面板数据处理" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/panel_data.html" id="面板数据处理-d9529e99415-link">面板数据处理</a></div></div></li><li role="treeitem"><div data-tocid="快照引擎-d9529e99461" class="topicref" data-id="快照引擎" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/snapshot_engine.html" id="快照引擎-d9529e99461-link">快照引擎</a></div></div></li><li role="treeitem"><div data-tocid="国内股票行情数据导入实例-d9529e99507" class="topicref" data-id="国内股票行情数据导入实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stockdata_csv_import_demo.html" id="国内股票行情数据导入实例-d9529e99507-link">国内股票行情数据导入实例</a></div></div></li><li role="treeitem"><div data-tocid="搭建行情回放服务的最佳实践-d9529e99553" class="topicref" data-id="搭建行情回放服务的最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/appendices_market_replay_bp.html" id="搭建行情回放服务的最佳实践-d9529e99553-link">搭建行情回放服务的最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="外汇掉期估值计算-d9529e99599" class="topicref" data-id="外汇掉期估值计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/FxSwapValuation.html" id="外汇掉期估值计算-d9529e99599-link">外汇掉期估值计算</a></div></div></li><li role="treeitem"><div data-tocid="深度不平衡买卖压力指标波动率计算-d9529e99646" class="topicref" data-id="深度不平衡买卖压力指标波动率计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/sql_performance_optimization_wap_di_rv.html" id="深度不平衡买卖压力指标波动率计算-d9529e99646-link">深度不平衡、买卖压力指标、波动率计算</a></div></div></li><li role="treeitem"><div data-tocid="金融实时实际波动率预测-d9529e99692" class="topicref" data-id="金融实时实际波动率预测" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ml_volatility_2.html" id="金融实时实际波动率预测-d9529e99692-link">金融实时实际波动率预测</a></div></div></li><li role="treeitem" class="active"><div data-tocid="股票行情回放-d9529e99738" class="topicref" data-id="股票行情回放" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/stock_market_replay_2.html" id="股票行情回放-d9529e99738-link">股票行情回放</a></div></div></li><li role="treeitem"><div data-tocid="实时计算日累计逐单资金流-d9529e99784" class="topicref" data-id="实时计算日累计逐单资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_daily_2.html" id="实时计算日累计逐单资金流-d9529e99784-link">实时计算日累计逐单资金流</a></div></div></li><li role="treeitem"><div data-tocid="实时计算分钟资金流-d9529e99830" class="topicref" data-id="实时计算分钟资金流" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_capital_flow_order_by_order_2.html" id="实时计算分钟资金流-d9529e99830-link">实时计算分钟资金流</a></div></div></li><li role="treeitem"><div data-tocid="基金份额参考价值-iopv-计算-d9529e99876" class="topicref" data-id="基金份额参考价值-iopv-计算" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming_IOPV_2.html" id="基金份额参考价值-iopv-计算-d9529e99876-link">基金份额参考价值 IOPV 计算</a></div></div></li><li role="treeitem"><div data-tocid="开发股票波动率预测模型的-676-个输入特征-d9529e99922" class="topicref" data-id="开发股票波动率预测模型的-676-个输入特征" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/metacode_derived_features_2.html" id="开发股票波动率预测模型的-676-个输入特征-d9529e99922-link">开发股票波动率预测模型的 676 个输入特征</a></div></div></li><li role="treeitem"><div data-tocid="流式计算中证-1000-指数主买主卖交易量-d9529e99968" class="topicref" data-id="流式计算中证-1000-指数主买主卖交易量" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/CSI_1000_2.html" id="流式计算中证-1000-指数主买主卖交易量-d9529e99968-link">流式计算中证 1000 指数主买/主卖交易量</a></div></div></li><li role="treeitem"><div data-tocid="利用-dolphindb-高效清洗数据-d9529e100014" class="topicref" data-id="利用-dolphindb-高效清洗数据" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/data_ETL.html" id="利用-dolphindb-高效清洗数据-d9529e100014-link">利用 DolphinDB 高效清洗数据</a></div></div></li><li role="treeitem"><div data-tocid="公募基金历史数据基础分析教程-d9529e100060" class="topicref" data-id="公募基金历史数据基础分析教程" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/public_fund_basic_analysis.html" id="公募基金历史数据基础分析教程-d9529e100060-link">公募基金历史数据基础分析教程</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-与-python-airflow-最佳实践-d9529e100106" class="topicref" data-id="dolphindb-与-python-airflow-最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/ddb_airflow.html" id="dolphindb-与-python-airflow-最佳实践-d9529e100106-link">DolphinDB 与 Python AirFlow 最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="处理-level-2-行情数据实例-d9529e100153" class="topicref" data-id="处理-level-2-行情数据实例" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/l2_stk_data_proc_2.html" id="处理-level-2-行情数据实例-d9529e100153-link">处理 Level-2 行情数据实例</a></div></div></li><li role="treeitem"><div data-tocid="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇-d9529e100199" class="topicref" data-id="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/LoadDataForPoc.html" id="金融-poc-用户历史数据导入指导手册之股票-level-2-逐笔篇-d9529e100199-link">金融 PoC 用户历史数据导入指导手册之股票 Level-2 逐笔篇</a></div></div></li><li role="treeitem"><div data-tocid="多数据源流式实时关联处理-d9529e100245" class="topicref" data-id="多数据源流式实时关联处理" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/streaming-real-time-correlation-processing_2.html" id="多数据源流式实时关联处理-d9529e100245-link">多数据源流式实时关联处理</a></div></div></li><li role="treeitem"><div data-tocid="实时计算涨幅榜-d9529e100291" class="topicref" data-id="实时计算涨幅榜" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/rt_stk_price_inc_calc_2.html" id="实时计算涨幅榜-d9529e100291-link">实时计算涨幅榜</a></div></div></li><li role="treeitem"><div data-tocid="python-parser-在金融量化分析场景的应用入门-d9529e100337" class="topicref" data-id="python-parser-在金融量化分析场景的应用入门" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/py_parser__quant_fin.html" id="python-parser-在金融量化分析场景的应用入门-d9529e100337-link">Python Parser 在金融量化分析场景的应用入门</a></div></div></li><li role="treeitem"><div data-tocid="存储金融数据的分区方案最佳实践-d9529e100383" class="topicref" data-id="存储金融数据的分区方案最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_practices_for_partitioned_storage.html" id="存储金融数据的分区方案最佳实践-d9529e100383-link">存储金融数据的分区方案最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="实时选取外汇行情多价源最优价-d9529e100429" class="topicref" data-id="实时选取外汇行情多价源最优价" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/best_price_selection.html" id="实时选取外汇行情多价源最优价-d9529e100429-link">实时选取外汇行情多价源最优价</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-insight-行情插件最佳实践指南-d9529e100475" class="topicref" data-id="dolphindb-insight-行情插件最佳实践指南" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/insight_plugin.html" id="dolphindb-insight-行情插件最佳实践指南-d9529e100475-link">DolphinDB INSIGHT 行情插件最佳实践指南</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-xtp-插件最佳实践-d9529e100521" class="topicref" data-id="dolphindb-xtp-插件最佳实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/xtp.html" id="dolphindb-xtp-插件最佳实践-d9529e100521-link">DolphinDB XTP 插件最佳实践</a></div></div></li><li role="treeitem"><div data-tocid="dolphindb-教程概率统计分析-d9529e100567" class="topicref" data-id="dolphindb-教程概率统计分析" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/probabilistic_and_statistical_analysis.html" id="dolphindb-教程概率统计分析-d9529e100567-link">DolphinDB 教程：概率统计分析</a></div></div></li><li role="treeitem"><div data-tocid="基于快照行情的股票和基金-k-线合成-d9529e100613" class="topicref" data-id="基于快照行情的股票和基金-k-线合成" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/k.html" id="基于快照行情的股票和基金-k-线合成-d9529e100613-link">基于快照行情的股票和基金 K 线合成</a></div></div></li><li role="treeitem"><div data-tocid="alphalens-在-dolphindb-中的应用因子分析建模实践-d9529e100660" class="topicref" data-id="alphalens-在-dolphindb-中的应用因子分析建模实践" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/Practical_Factor_Analysis_Modeling.html" id="alphalens-在-dolphindb-中的应用因子分析建模实践-d9529e100660-link">Alphalens 在 DolphinDB 中的应用：因子分析建模实践</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e100707" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e100707-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/iot_examples.html" id="tocId-d9529e100707-link">物联网场景案例</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e101629" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e101629-link" class="wh-expand-btn"></span><div class="title"><a href="../tutorials/cluster_scaleout_perf_test.html" id="tocId-d9529e101629-link">测试报告</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="tocId-d9529e101769" class="topicref" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action tocId-d9529e101769-link" class="wh-expand-btn"></span><div class="title"><a href="../rn/server/3_00_1.html" id="tocId-d9529e101769-link">版本说明</a><div class="wh-tooltip"><p class="shortdesc">DolphinDB 版本发布历史</p></div></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-7 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        <button id="wh_close_topic_toc_button" class="close-toc-button d-none" aria-label="Toggle topic table of content" aria-controls="wh_topic_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        <div class=" wh_topic_content body "><main role="main"><article class="- topic/topic topic" role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1">股票行情回放</h1><div class="- topic/body body"><p class="- topic/p p">一个量化策略在生产（交易）环境中运行时，实时数据的处理通常是由事件驱动的。为确保研发和生产使用同一套代码，通常在研发阶段需将历史数据，严格按照事件发生的时间顺序进行回放，以此模拟交易环境。一个交易所的行情数据通常包括逐笔委托、逐笔成交、快照等多种类型的数据。DolphinDB 提供了严格按照时间顺序将多个不同数据源同时进行回放的功能。</p><p class="- topic/p p">首先简要介绍 DolphinDB 数据回放功能和原理，之后介绍股票行情回放的应用方案和代码实现，最后给出搭建行情回放服务的最佳实践。</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="1-单表回放"><h2 class="- topic/title title topictitle2" id="ariaid-title2">1. 单表回放</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB 历史数据回放功能通过 replay 函数实现。replay 函数的作用是将内存表或数据库表中的记录以一定的速率写入到目标表中，以模拟实时注入的数据流。根据输入表的数量，回放分为单表回放和多表回放，其中单表回放是最基础的回放模式，即将一个输入表回放至一个相同表结构的目标表中，以下是不包括建表语句的单表回放示例：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python">tradeDS = replayDS(sqlObj=&lt;select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://trade"</span>, <span class="hl-string">"trade"</span>) where Date = <span class="hl-number">2020.12</span>.<span class="hl-number">31</span>&gt;, dateColumn=`Date, timeColumn=`Time)
replay(inputTables=tradeDS, outputTables=tradeStream, dateColumn=`Date, timeColumn=`Time, replayRate=<span class="hl-number">10000</span>, absoluteRate=true)</pre><p class="- topic/p p">以上脚本将数据库 "dfs://trade" 中的 "trade" 表中 2020 年 12 月 31 日的数据以每秒 1 万条的速度注入目标表 tradeStream 中。更多关于 replay、replayDS 函数的介绍可以参考 <a class="- topic/xref xref" href="data_replay.html">DolphinDB 历史数据回放教程</a>。</p><p class="- topic/p p">但是，单表回放并不能满足所有的回放要求。因为在实践中，一个领域问题往往需要多个不同类型的消息协作，例如金融领域的行情数据包括逐笔委托、逐笔成交、快照等，为了更好地模拟实际交易中的实时数据流，通常需要将以上三类数据同时进行回放，这时便提出了多表回放的需求。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title3" id="2-多表回放"><h2 class="- topic/title title topictitle2" id="ariaid-title3">2. 多表回放</h2><div class="- topic/body body"><p class="- topic/p p">DolphinDB不断优化拓展多表回放的功能，既支持N个输入表一对一回放至N个输出表的N对N回放，又在1.30.17/2.00.5及之后的版本中支持了N个不同结构的输入表同时回放至同一个输出表的N对一异构回放，异构回放能够保证多个数据源的严格时序回放和消费。本小节将对多表回放面临的难点、相应的 DolphinDB 技术解决方案和原理展开介绍。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title4" id="21-n-对-n回放"><h3 class="- topic/title title topictitle3" id="ariaid-title4">2.1. N 对 N回放</h3><div class="- topic/body body"><p class="- topic/p p">类似单表回放的原理，replay 函数提供了N 对 N模式的多表回放，即将多个输入表回放至多个目标表，输入表与目标表一一对应。以下是N 对 N模式的多表回放的示例：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python">orderDS = replayDS(sqlObj=&lt;select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://order"</span>, <span class="hl-string">"order"</span>) where Date = <span class="hl-number">2020.12</span>.<span class="hl-number">31</span>&gt;, dateColumn=`Date, timeColumn=`Time)
tradeDS = replayDS(sqlObj=&lt;select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://trade"</span>, <span class="hl-string">"trade"</span>) where Date = <span class="hl-number">2020.12</span>.<span class="hl-number">31</span>&gt;, dateColumn=`Date, timeColumn=`Time)
snapshotDS = replayDS(sqlObj=&lt;select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://snapshot"</span>, <span class="hl-string">"snapshot"</span>) where Date =<span class="hl-number">2020.12</span>.<span class="hl-number">31</span>&gt;, dateColumn=`Date, timeColumn=`Time)
replay(inputTables=[orderDS, tradeDS, snapshotDS], outputTables=[orderStream, tradeStream, snapshotStream], dateColumn=`Date, timeColumn=`Time, replayRate=<span class="hl-number">10000</span>, absoluteRate=true)</pre><p class="- topic/p p">以上脚本将三个数据库表中的历史数据分别注入三个目标表中。在N 对 N的模式中，不同表的在同一秒内的两条数据写入目标表的顺序可能和数据中的时间字段的先后关系不一致。此外，下游如果由三个处理线程分别对三个目标表进行订阅与消费，也很难保证表与表之间的数据被处理的顺序关系。因此，N 对 N回放不能保证整体上最严格的时序。</p><p class="- topic/p p">在实践中，一个领域中不同类型的消息是有先后顺序的，比如股票的逐笔成交和逐笔委托，所以在对多个数据源回放时要求每条数据都严格按照时间顺序注入目标表，为此我们需要解决以下问题：</p><ul class="- topic/ul ul"><li class="- topic/li li">不同结构的数据如何统一进行排序和注入以保证整体的顺序？</li><li class="- topic/li li">如何保证对多表回放结果的实时消费也是严格按照时序进行的？</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title5" id="22-n-对-1-异构回放"><h3 class="- topic/title title topictitle3" id="ariaid-title5">2.2. N 对 1 异构回放</h3><div class="- topic/body body"><p class="- topic/p p">面对上述多表回放的难点，DolphinDB 进一步增加了异构模式的多表回放，支持将多个不同表结构的数据表写入到同一张异构流数据表中，从而实现了严格按时间顺序的多表回放。以下是异构模式的多表回放示例：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python">orderDS = replayDS(sqlObj=&lt;select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://order"</span>, <span class="hl-string">"order"</span>) where Date = <span class="hl-number">2020.12</span>.<span class="hl-number">31</span>&gt;, dateColumn=`Date, timeColumn=`Time)
tradeDS = replayDS(sqlObj=&lt;select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://trade"</span>, <span class="hl-string">"trade"</span>) where Date = <span class="hl-number">2020.12</span>.<span class="hl-number">31</span>&gt;, dateColumn=`Date, timeColumn=`Time)
snapshotDS = replayDS(sqlObj=&lt;select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://snapshot"</span>, <span class="hl-string">"snapshot"</span>) where Date =<span class="hl-number">2020.12</span>.<span class="hl-number">31</span>&gt;, dateColumn=`Date, timeColumn=`Time)
inputDict = dict([<span class="hl-string">"order"</span>, <span class="hl-string">"trade"</span>, <span class="hl-string">"snapshot"</span>], [orderDS, tradeDS, snapshotDS])
replay(inputTables=inputDict, outputTables=messageStream, dateColumn=`Date, timeColumn=`Time, replayRate=<span class="hl-number">10000</span>, absoluteRate=true)</pre><p class="- topic/p p">异构回放时将 replay 函数的 inputTables 参数指定为字典，outputTables 参数指定为异构流数据表。inputTables 参数指定多个结构不同的数据源，字典的 key 是用户自定义的字符串，是数据源的唯一标识，将会对应 outputTables 参数指定的表的第二列，字典的 value 是通过 replayDS 定义的数据源或者表。</p><p class="- topic/p p">以上脚本中的输出表 messageStream 为异构流数据表，其表结构如下：</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="22-n-对-1-异构回放__entry__1">name</th><th class="- topic/entry entry colsep-0 rowsep-0" id="22-n-对-1-异构回放__entry__2">typeString</th><th class="- topic/entry entry colsep-0 rowsep-0" id="22-n-对-1-异构回放__entry__3">comment</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-n-对-1-异构回放__entry__1">msgTime</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-n-对-1-异构回放__entry__2">TIMESTAMP</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-n-对-1-异构回放__entry__3">消息时间</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-n-对-1-异构回放__entry__1">msgType</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-n-对-1-异构回放__entry__2">SYMBOL</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-n-对-1-异构回放__entry__3">数据源标识："order"、"trade"、"snapshot"</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-n-对-1-异构回放__entry__1">msgBody</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-n-对-1-异构回放__entry__2">BLOB</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="22-n-对-1-异构回放__entry__3">消息内容，以二进制格式存储</td></tr></tbody></table></div><p class="- topic/p p">异构回放时 outputTables 参数指定的表至少需要包含以上三列，此外，还可以指定各输入表的公共列（列名和类型一致的列）。回放完成后，表 messageStream 的数据预览如下：</p><br/><img class="- topic/image image" src="images/stock_market_replay/messageStream.png" alt="messageStream"/><br/><p class="- topic/p p">表中每行记录对应输入表中的一行记录，msgTime 字段是输入表中的时间列，msgType 字段用来区分来自哪张输入表，msgBody 字段以二进制格式存储了输入表中的记录内容。在回放的过程中，通过异构流数据表这样的数据结构可以对多个数据源进行全局排序，因而保证了多个数据源之间的严格时间顺序。同时，异构流数据表和普通流数据表一样可以被订阅，即多种类型的数据存储在同一张表中被发布并被同一个线程实时处理，因而也保证了消费的严格时序性。</p><p class="- topic/p p">若要对异构流数据表进行数据处理操作，如指标计算等，则需要将二进制格式的消息内容反序列化为原始结构的一行记录。DolphinDB 在脚本语言以及在 API 中均支持了对异构流数据表的解析功能。脚本支持流数据分发引擎 streamFilter 对异构流数据表进行反序列化以及反序列后结果的数据处理；同时，各类 API 在支持流数据订阅功能的基础上，扩展支持了在订阅时对异构流数据表进行反序列化。</p></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title6" id="3-多表回放应用股票行情回放"><h2 class="- topic/title title topictitle2" id="ariaid-title6">3. 多表回放应用：股票行情回放</h2><div class="- topic/body body"><p class="- topic/p p">基于上文提到的异构回放、异构流数据表解析以及 DolphinDB 流处理框架中的其他特性等，本章将结合股票行情回放展示 DolphinDB 异构模式的多表回放功能在实际场景中的应用，包括数据回放以及三种具体的回放结果消费方案：使用内置流计算引擎实时处理数据、实时推送外部消息中间件、外部程序订阅与实时消费。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title7" id="31-行情回放与消费方案"><h3 class="- topic/title title topictitle3" id="ariaid-title7">3.1. 行情回放与消费方案</h3><div class="- topic/body body"><p class="- topic/p p">行情多表回放方案的数据处理流程图如下：</p><br/><img class="- topic/image image" src="../stream/images/stock_market_replay_1.png"/><br/><p class="- topic/p p">处理流程图说明：</p><p class="- topic/p p">回放与消费流程围绕异构流数据表 messageStream 展开。</p><p class="- topic/p p">图中异构流数据表模块以上，为异构模式的多表回放的示意图，由数据回放工具即 replay 和 replayDS 函数，将存储在多个数据库中的原始数据回放至异构流数据表中。</p><p class="- topic/p p">图中异构流数据表模块以下，分为三条支路，分别对应对回放结果的三种不同的处理方式，从左至右依次是：</p><ul class="- topic/ul ul"><li class="- topic/li li">在 DolphinDB 的订阅中，通过内置的流计算引擎实时计算指标，本文将使用 asof join 引擎实时关联逐笔成交与快照数据，计算个股交易成本并写入结果流数据表；</li><li class="- topic/li li">在 DolphinDB 的订阅中，通过 Kafka 插件将回放结果实时写入外部的消息中间件 Kafka；</li><li class="- topic/li li">在外部程序中，通过 DolphinDB 的流数据 API 来实时订阅和消费回放结果，本文将使用 C++API。</li></ul></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title8" id="32-测试数据集"><h3 class="- topic/title title topictitle3" id="ariaid-title8">3.2. 测试数据集</h3><div class="- topic/body body"><p class="- topic/p p">本教程基于上交所某日的股票行情数据进行回放，包括逐笔委托、逐笔成交、Level2 快照三种行情数据，分别存放在分布式数据库 "dfs://order"、"dfs://trade"、"dfs://snapshot" 中，均使用 TSDB 存储引擎，数据概览如下：</p><div class="table-container"><table class="- topic/table table" data-cols="7"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="32-测试数据集__entry__1">数据集</th><th class="- topic/entry entry colsep-0 rowsep-0" id="32-测试数据集__entry__2">字段数</th><th class="- topic/entry entry colsep-0 rowsep-0" id="32-测试数据集__entry__3">总行数</th><th class="- topic/entry entry colsep-0 rowsep-0" id="32-测试数据集__entry__4">数据大小</th><th class="- topic/entry entry colsep-0 rowsep-0" id="32-测试数据集__entry__5">简称</th><th class="- topic/entry entry colsep-0 rowsep-0" id="32-测试数据集__entry__6">分区机制</th><th class="- topic/entry entry colsep-0 rowsep-0" id="32-测试数据集__entry__7">排序列</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__1">逐笔委托</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__2">20</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__3">49018552</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__4">6.8G</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__5">order</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__6">VALUE: 交易日, HASH: [SYMBOL, 20]</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__7">股票, 交易时间</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__1">逐笔成交</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__2">15</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__3">43652718</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__4">3.3G</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__5">trade</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__6">VALUE: 交易日, HASH: [SYMBOL, 20]</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__7">股票, 交易时间</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__1">Level2 行情快照</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__2">55</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__3">8410359</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__4">4.1G</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__5">snapshot</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__6">VALUE: 交易日, HASH: [SYMBOL, 20]</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="32-测试数据集__entry__7">股票, 交易时间</td></tr></tbody></table></div><p class="- topic/p p">后文也将提供部分原始数据的 csv 文件以及对应的数据导入脚本，以便快速体验回放功能。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title9" id="33-代码实现"><h3 class="- topic/title title topictitle3" id="ariaid-title9">3.3. 代码实现</h3><div class="- topic/body body"><p class="- topic/p p">本教程脚本开发工具采用 DolphinDB GUI，相关环境配置见后文<a class="- topic/xref xref" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">开发环境配置</a>。</p></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title10" id="331-股票行情回放"><h4 class="- topic/title title topictitle4" id="ariaid-title10">3.3.1. 股票行情回放</h4><div class="- topic/body body"><p class="- topic/p p">本小节脚本将三个数据库中的不同结构的数据回放至同一个异构流数据表中。完整脚本见附录 <a class="- topic/xref xref" href="script/stock_market_replay/01.stockMarketReplay.txt">股票行情回放. txt</a>。</p><ul class="- topic/ul ul"><li class="- topic/li li">创建异构流数据表 messageStream</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock python">colName = `msgTime`msgType`msgBody
colType = [TIMESTAMP,SYMBOL, BLOB]
messageTemp = streamTable(<span class="hl-number">1000000</span>:<span class="hl-number">0</span>, colName, colType)
enableTableShareAndPersistence(table=messageTemp, tableName=<span class="hl-string">"messageStream"</span>, asynWrite=true, compress=true, cacheSize=<span class="hl-number">1000000</span>, retentionMinutes=<span class="hl-number">1440</span>, flushMode=<span class="hl-number">0</span>, preCache=<span class="hl-number">10000</span>)
messageTemp = NULL</pre><p class="- topic/p p">messageStream 是共享的异步持久化异构流数据表。为了之后能够对该表进行订阅，必须将其定义为共享的流数据表，共享意味着在当前节点的所有会话中可见。同时此处对流数据表进行持久化，其主要目的是控制该表的最大内存占用，enableTableShareAndPersistence 函数中的 cacheSize 参数规定了该表在内存中最多保留 100 万行。流数据持久化也保障了流数据的备份和恢复，当节点异常关闭后，持久化的数据会在重启时自动载入流数据表以继续流数据消费。</p><ul class="- topic/ul ul"><li class="- topic/li li">三个数据源异构回放至流数据表 messageStream</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock python">timeRS = cutPoints(<span class="hl-number">09</span>:<span class="hl-number">15</span>:<span class="hl-number">00.000</span>.<span class="hl-number">.15</span>:<span class="hl-number">00</span>:<span class="hl-number">00.000</span>, <span class="hl-number">100</span>)
orderDS = replayDS(sqlObj=&lt;select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://order"</span>, <span class="hl-string">"order"</span>) where Date = <span class="hl-number">2020.12</span>.<span class="hl-number">31</span>&gt;, dateColumn=`Date, timeColumn=`Time, timeRepartitionSchema=timeRS)
tradeDS = replayDS(sqlObj=&lt;select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://trade"</span>, <span class="hl-string">"trade"</span>) where Date = <span class="hl-number">2020.12</span>.<span class="hl-number">31</span>&gt;, dateColumn=`Date, timeColumn=`Time, timeRepartitionSchema=timeRS)
snapshotDS = replayDS(sqlObj=&lt;select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://snapshot"</span>, <span class="hl-string">"snapshot"</span>) where Date =<span class="hl-number">2020.12</span>.<span class="hl-number">31</span>&gt;, dateColumn=`Date, timeColumn=`Time, timeRepartitionSchema=timeRS)
inputDict = dict([<span class="hl-string">"order"</span>, <span class="hl-string">"trade"</span>, <span class="hl-string">"snapshot"</span>], [orderDS, tradeDS, snapshotDS])

submitJob(<span class="hl-string">"replay"</span>, <span class="hl-string">"replay stock market"</span>, replay, inputDict, messageStream, `Date, `Time, , , <span class="hl-number">3</span>)</pre><p class="- topic/p p">上述脚本读取三个数据库中的结构不同的数据表进行全速的异构回放，回放通过 submitJob 函数提交后台作业来执行。下面讲解对于回放进行调优的相关参数和原理：</p><p class="- topic/p p">replayDS 函数中的 timeRepartitionSchema 参数：replayDS 函数将输入的 SQL 查询转化为数据源，其会根据输入表的分区以及 timeRepartitionSchema 参数，将原始的 SQL 查询按照时间顺序拆分成若干小的 SQL 查询。</p><p class="- topic/p p">replay 函数中的 parallelLevel 参数：parallelLevel 表示从数据库加载数据到内存的工作线程数量，即同时查询经过划分之后的小数据源的并行度，默认为 1，上述脚本中通过 submitjob 的参数设置为 3。</p><p class="- topic/p p">对数据库表的回放过程分为两步，其一是通过 SQL 查询历史数据至内存，查询包括对数据的排序，其二是将内存中的数据写入输出表，两步以流水线的方式执行。若将某日数据全部导入内存并排序，会占用大量内存甚至导致内存不足，同时由于全部数据的查询耗时比较长，会导致第二步写入输出表的时刻也相应推迟。以 orderDS 为例，若不设置 timeRepartitionSchema 参数，则相应的 SQL 查询为：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python">select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://order"</span>, <span class="hl-string">"order"</span>) where Date = <span class="hl-number">2020.12</span>.<span class="hl-number">31</span> order by Time</pre><p class="- topic/p p">因此针对大数据量的场景，本教程先对 replayDS 函数指定 timeRepartitionSchema 参数，将数据按照时间戳分为 100 个小数据源，则每次查询的最小单位为其中一个小数据源，同时提高 parallelLevel 参数来帮助提升查询速度。以 orderDS 为例，若设置上述 timeRepartitionSchema 参数，则相应的其中一个 SQL 查询为：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python">select * <strong class="hl-keyword">from</strong> loadTable(<span class="hl-string">"dfs://order"</span>, <span class="hl-string">"order"</span>) where Date = <span class="hl-number">2020.12</span>.<span class="hl-number">31</span>, <span class="hl-number">09</span>:<span class="hl-number">15</span>:<span class="hl-number">00.000</span> &lt;= Time &lt; <span class="hl-number">09</span>:<span class="hl-number">18</span>:<span class="hl-number">27.001</span> order by Time</pre><p class="- topic/p p">后文的 <a class="- topic/xref xref" href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95">性能测试</a> 章节利用本节的脚本进行了性能测试，最终总耗时 4m18s，内存占用峰值 4.7GB。内存主要由回放过程中的 SQL 查询和输出表等占用，通过对数据源进行切割以及对输出表进行持久化能有效控制内存使用。</p><p class="- topic/p p">作业运维：在 submitJob 函数提交后，通过 getRecentJobs 函数可以查看后台作业的状态，如果 endTime 和 errorMsg 为空，说明任务正在正常运行中。也可以用 cancelJob 函数取消回放，其输入参数 jobId 通过 getRecentJobs 获取。</p><p class="- topic/p p">若没有可作为数据源的数据库，也可以通过加载 csv 文件至内存中进行回放来快速体验本教程，附录中的数据文件提供了 100 支股票的某日完整行情数据，全部数据在内存中约占 700M。以下脚本需要修改 loadText 的路径为实际的 csv 文本数据存储路径。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock python">orderDS = select * <strong class="hl-keyword">from</strong> loadText(<span class="hl-string">"/yourDataPath/replayData/order.csv"</span>) order by Time
tradeDS = select * <strong class="hl-keyword">from</strong> loadText(<span class="hl-string">"/yourDataPath/replayData/trade.csv"</span>) order by Time
snapshotDS = select * <strong class="hl-keyword">from</strong> loadText(<span class="hl-string">"/yourDataPath/replayData/snapshot.csv"</span>) order by Time
inputDict = dict([<span class="hl-string">"order"</span>, <span class="hl-string">"trade"</span>, <span class="hl-string">"snapshot"</span>], [orderDS, tradeDS, snapshotDS])

submitJob(<span class="hl-string">"replay"</span>, <span class="hl-string">"replay text"</span>, replay, inputDict, messageStream, `Date, `Time, , , <span class="hl-number">1</span>)</pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title11" id="332-消费场景-1在-dolphindb-订阅中实时计算个股交易成本"><h4 class="- topic/title title topictitle4" id="ariaid-title11">3.3.2. 消费场景 1：在 DolphinDB 订阅中实时计算个股交易成本</h4><div class="- topic/body body"><p class="- topic/p p">本小节脚本将实时消费小节创建的流数据表 messageStream，使用 asof join 引擎实时关联逐笔成交与快照数据，并计算个股交易成本，完整脚本见附录 <a class="- topic/xref xref" href="script/stock_market_replay/02.calTradeCost_asofJoin.txt">消费场景 1: 计算个股交易成本_asofJoin 实现. txt</a>。</p><ul class="- topic/ul ul"><li class="- topic/li li">创建计算结果输出表 prevailingQuotes</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock python">colName = `TradeTime`SecurityID`Price`TradeQty`BidPX1`OfferPX1`Spread`SnapshotTime
colType = [TIME, SYMBOL, DOUBLE, INT, DOUBLE, DOUBLE, DOUBLE, TIME]
prevailingQuotesTemp = streamTable(<span class="hl-number">1000000</span>:<span class="hl-number">0</span>, colName, colType)
enableTableShareAndPersistence(table=prevailingQuotesTemp, tableName=<span class="hl-string">"prevailingQuotes"</span>, asynWrite=true, compress=true, cacheSize=<span class="hl-number">1000000</span>, retentionMinutes=<span class="hl-number">1440</span>, flushMode=<span class="hl-number">0</span>, preCache=<span class="hl-number">10000</span>)
prevailingQuotesTemp = NULL</pre><p class="- topic/p p">prevailingQuotes 被定义为共享流数据表，之后可以对其进行订阅和进一步的处理。</p><ul class="- topic/ul ul"><li class="- topic/li li">创建流计算 asof join 引擎</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock python"><strong class="hl-keyword">def</strong> createSchemaTable(dbName, tableName){
	schema = loadTable(dbName, tableName).schema().colDefs
	<strong class="hl-keyword">return</strong> table(<span class="hl-number">1</span>:<span class="hl-number">0</span>, schema.name, schema.typeString)
}
tradeSchema = createSchemaTable(<span class="hl-string">"dfs://trade"</span>, <span class="hl-string">"trade"</span>)
snapshotSchema = createSchemaTable(<span class="hl-string">"dfs://snapshot"</span>, <span class="hl-string">"snapshot"</span>)

joinEngine=createAsofJoinEngine(name=<span class="hl-string">"tradeJoinSnapshot"</span>, leftTable=tradeSchema, rightTable=snapshotSchema, outputTable=prevailingQuotes, metrics=&lt;[Price, TradeQty, BidPX1, OfferPX1, abs(Price-(BidPX1+OfferPX1)/<span class="hl-number">2</span>), snapshotSchema.Time]&gt;, matchingColumn=`SecurityID, timeColumn=`Time, useSystemTime=false, delayedTime=<span class="hl-number">1</span>)</pre><p class="- topic/p p">使用 asof join 引擎实现在对股票分组的基础上，对于每条输入的 trade 记录，实时关联与之在时间列上最接近的一条 snapshot 记录，并使用 trade 中的价格字段和 snapshot 中的报价字段进行指标计算。最终，以上配置的 asof join 引擎会输出和左表行数相同的结果。asof join 引擎更多介绍请参考第八章 <code class="+ topic/ph pr-d/codeph ph codeph">createAsofJoinEngine</code>的相关介绍。</p><p class="- topic/p p">考虑到实际的业务含义，此例中 asof join 引擎在用于两个数据流的实时关联时，配置参数 useSystemTime=false 以按照数据中的时间列进行关联计算。使用数据中的时间列，相较于使用数据注入引擎时的系统时间作为时间列，可以避免在实时场景中两个数据流到达引擎的时刻乱序而带来的问题。但是，在此处，因为异构回放能够严格保证两个数据流的处理顺序，因此也可以使用数据注入引擎的系统时间进行关联计算。除了在使用 asof join 引擎时配置参数 useSystemTime=true 外，使用 look up join 引擎也能够实现按系统时间进行实时关联，即当每一条 trade 表中的记录注入引擎时，总是立刻去关联已经注入引擎的最新的一条相应股票的 snapshot 记录，得到的计算结果会同上文中的 asof join 引擎实现完全一致，而由于 look up join 引擎在内部实现上更简单，所以在计算性能上会有稍好的表现，完成脚本见附录 <a class="- topic/xref xref" href="script/stock_market_replay/03.calTradeCost_lookUpJoin.txt">消费场景 1: 计算个股交易成本_lookUpJoin 实现. txt</a>。look up join 引擎更多介绍请参考第八章中<code class="+ topic/ph pr-d/codeph ph codeph">createLookUpJoinEngine</code>的相关介绍。</p><p class="- topic/p p">自定义函数 createSchemaTable，用于获取数据库表的表结构，以做为创建引擎时的参数传入。</p><ul class="- topic/ul ul"><li class="- topic/li li">创建流计算过滤与分发引擎</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock python"><strong class="hl-keyword">def</strong> appendLeftStream(msg){
	tempMsg = select * <strong class="hl-keyword">from</strong> msg where Price &gt; <span class="hl-number">0</span> <strong class="hl-keyword">and</strong> Time&gt;=<span class="hl-number">09</span>:<span class="hl-number">30</span>:<span class="hl-number">00.000</span>
	getLeftStream(getStreamEngine(`tradeJoinSnapshot)).tableInsert(tempMsg)
}
filter1 = dict(STRING,ANY)
filter1[<span class="hl-string">"condition"</span>] = <span class="hl-string">"trade"</span>
filter1[<span class="hl-string">"handler"</span>] = appendLeftStream
filter2 = dict(STRING,ANY)
filter2[<span class="hl-string">"condition"</span>] = <span class="hl-string">"snapshot"</span>
filter2[<span class="hl-string">"handler"</span>] = getRightStream(getStreamEngine(`tradeJoinSnapshot))
schema = dict([<span class="hl-string">"trade"</span>, <span class="hl-string">"snapshot"</span>], [tradeSchema, snapshotSchema])
engine = streamFilter(name=<span class="hl-string">"streamFilter"</span>, dummyTable=messageStream, filter=[filter1, filter2], msgSchema=schema)</pre><p class="- topic/p p">streamFilter 函数通过设置 msgSchema 参数，会对异构流数据表进行反序列，并根据 filter 参数中设置的 handler 来处理订阅的数据。当订阅数据到来时，handler 之间是串行执行的，这样就保证了对数据的处理严格按照时序进行。</p><p class="- topic/p p">handler 参数是一元函数或数据表，用于处理订阅的数据。当它是函数时，其唯一的参数是经过解析和过滤后的数据表。这里对于 trade 数据其 handler 设置为函数 appendLeftStream，该函数对订阅到的数据首先做过滤，再将符合条件的数据作为左表写入到 asof join 引擎。对于 snapshot 数据其 handler 设置为 asof join 引擎的右表，表示对于订阅到的 snapshot 数据直接作为右表写入 asof join 引擎。</p><ul class="- topic/ul ul"><li class="- topic/li li">订阅异构流数据表</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock python">subscribeTable(tableName=<span class="hl-string">"messageStream"</span>, actionName=<span class="hl-string">"tradeJoinSnapshot"</span>, offset=-<span class="hl-number">1</span>, handler=engine, msgAsTable=true, reconnect=true)</pre><p class="- topic/p p">设置参数 offset 为 -1，订阅将会从提交订阅时流数据表的当前行开始。为了消费到完整的数据，建议先执行此处脚本以提交订阅，再提交后台回放作业，参考 3.3.1 小节。</p><ul class="- topic/ul ul"><li class="- topic/li li">查看计算结果</li></ul><br/><img class="- topic/image image" src="images/stock_market_replay/prevailingQuotes.png"/><br/><p class="- topic/p p">asof join 引擎在 matchingColumn 的分组内输出表数据与输入时的顺序一致。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title12" id="333-消费场景-2在-dolphindb-订阅中将回放结果实时推送-kafka"><h4 class="- topic/title title topictitle4" id="ariaid-title12">3.3.3. 消费场景 2：在 DolphinDB 订阅中将回放结果实时推送 Kafka</h4><div class="- topic/body body"><p class="- topic/p p">本小节脚本将前文中创建的流数据表 messageStream 实时发送至消息中间件 Kafka。执行以下脚本，需要有可以写入的 Kafka server，并且安装 DolphinDB Kafka 插件，插件配置见后文<a class="- topic/xref xref" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">开发环境配置</a>。完整脚本见附录 <a class="- topic/xref xref" href="script/stock_market_replay/04.publishToKafka.txt">消费场景 2: 实时推送 Kafka.txt</a>。</p><ul class="- topic/ul ul"><li class="- topic/li li">加载 Kafka 插件并创建 Kafka producer</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock python">loadPlugin(<span class="hl-string">"/DolphinDB/server/plugins/kafka/PluginKafka.txt"</span>)
go
producerCfg = dict(STRING, ANY)
producerCfg[<span class="hl-string">"metadata.broker.list"</span>] = <span class="hl-string">"localhost"</span>
producer = kafka::producer(producerCfg)</pre><p class="- topic/p p">loadPlugin 的路径和 producer 配置请按需修改。本教程涉及的 Kafka server 和 DolphinDB server 在同一台服务器上，故 metadata.broker.list 参数为 localhost。</p><ul class="- topic/ul ul"><li class="- topic/li li">定义推送数据至 Kafka topic 的函数</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock python"><strong class="hl-keyword">def</strong> sendMsgToKafkaFunc(dataType, producer, msg){
	startTime = now()
	<strong class="hl-keyword">try</strong> {
		kafka::produce(producer, <span class="hl-string">"topic-message"</span>, <span class="hl-number">1</span>, msg, true)
		cost = now() - startTime
		writeLog(<span class="hl-string">"[Kafka Plugin] Successed to send"</span> + dataType + <span class="hl-string">":"</span> + msg.size() + <span class="hl-string">"rows,"</span> + cost + <span class="hl-string">"ms."</span>)
	}
	catch(ex) {writeLog(<span class="hl-string">"[Kafka Plugin] Failed to send msg to kafka with error:"</span> +ex)}
}</pre><p class="- topic/p p">kafka::produce 函数会将任意表结构的 msg 以 json 格式发送至指定的 Kafka topic。此处的 writeLog 函数在日志中打印每批推送的情况来方便运维观察。</p><ul class="- topic/ul ul"><li class="- topic/li li">注册流数据过滤与分发引擎</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock python">filter1 = dict(STRING,ANY)
filter1[<span class="hl-string">"condition"</span>] =  <span class="hl-string">"order"</span>
filter1[<span class="hl-string">"handler"</span>] = sendMsgToKafkaFunc{<span class="hl-string">"order"</span>, producer}
filter2 = dict(STRING,ANY)
filter2[<span class="hl-string">"condition"</span>] = <span class="hl-string">"trade"</span>
filter2[<span class="hl-string">"handler"</span>] = sendMsgToKafkaFunc{<span class="hl-string">"trade"</span>, producer}
filter3 = dict(STRING,ANY)
filter3[<span class="hl-string">"condition"</span>] = <span class="hl-string">"snapshot"</span>
filter3[<span class="hl-string">"handler"</span>] = sendMsgToKafkaFunc{<span class="hl-string">"snapshot"</span>, producer}

schema = dict([<span class="hl-string">"order"</span>,<span class="hl-string">"trade"</span>, <span class="hl-string">"snapshot"</span>], [loadTable(<span class="hl-string">"dfs://order"</span>, <span class="hl-string">"order"</span>), loadTable(<span class="hl-string">"dfs://trade"</span>, <span class="hl-string">"trade"</span>), loadTable(<span class="hl-string">"dfs://snapshot"</span>, <span class="hl-string">"snapshot"</span>)])

engine = streamFilter(name=<span class="hl-string">"streamFilter"</span>, dummyTable=messageStream, filter=[filter1, filter2, filter3], msgSchema=schema)</pre><p class="- topic/p p">streamFilter 函数通过设置 msgSchema 参数，会对异构流数据表进行反序列，并根据 filter 参数中设置的 handler 来处理订阅的数据。当订阅数据到来时，handler 之间是串行执行的，这样就保证了对数据的处理严格按照时序进行。</p><p class="- topic/p p">handler 参数是一元函数或数据表，用于处理订阅的数据。当它是函数时，其唯一的参数是经过解析和过滤后的数据表。sendMsgToKafka{"order", producer} 的写法是函数化编程中的部分应用，即指定函数 sendMsgToKafka 的部分参数，产生一个参数较少的新函数。</p><ul class="- topic/ul ul"><li class="- topic/li li">订阅异构流数据表</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock python">subscribeTable(tableName=<span class="hl-string">"messageStream"</span>, actionName=<span class="hl-string">"sendMsgToKafka"</span>, offset=-<span class="hl-number">1</span>, handler=engine, msgAsTable=true, reconnect=true)</pre><p class="- topic/p p">设置参数 offset 为 -1，订阅将会从提交订阅时流数据表的当前行开始。为了消费到完整的数据，建议先执行此处脚本以提交订阅，再提交后台回放作业，参考 3.3.1 小节。</p><ul class="- topic/ul ul"><li class="- topic/li li">在终端查看发送结果</li></ul><p class="- topic/p p">在命令行开启消费者进程，从第一条开始消费名为 topic-message 的 topic</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic topic-message</code></pre><p class="- topic/p p">返回：</p><br/><img class="- topic/image image" src="images/stock_market_replay/KafkaToipic.png"/><br/></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title13" id="334-消费场景-3在外部程序中通过-capi-实时订阅与处理"><h4 class="- topic/title title topictitle4" id="ariaid-title13">3.3.4. 消费场景 3：在外部程序中通过 C++API 实时订阅与处理</h4><div class="- topic/body body"><p class="- topic/p p">本小节代码为 C++ 程序，程序会订阅前文创建的异构流数据表 messageStream，并实时打印每条数据。以下代码依赖DolphinDB C++ API，API安装见后文<a class="- topic/xref xref" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">开发环境配置</a>。完整代码见附录 <a class="- topic/xref xref" href="script/stock_market_replay/05.subscribe.cpp">消费场景 3:C++API 实时订阅. cpp</a>。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock c++"><code>int main(int argc, char *argv[]){
    DBConnection conn;
    string hostName = "127.0.0.1";
    int port = 8848;
    bool ret = conn.connect(hostName, port);

    conn.run("login(\"admin\", \"123456\")");
    DictionarySP t1schema = conn.run("loadTable(\"dfs://snapshotL2\", \"snapshotL2\").schema()");
    DictionarySP t2schema = conn.run("loadTable(\"dfs://trade\", \"trade\").schema()");
    DictionarySP t3schema = conn.run("loadTable(\"dfs://order\", \"order\").schema()");

    unordered_map&lt;string, DictionarySP&gt; sym2schema;
    sym2schema["snapshot"] = t1schema;
    sym2schema["trade"] = t2schema;
    sym2schema["order"] = t3schema;
    StreamDeserializerSP sdsp = new StreamDeserializer(sym2schema);
    auto myHandler = [&amp;](Message msg) {
            const string &amp;symbol = msg.getSymbol();
            cout &lt;&lt; symbol &lt;&lt; ":";
            size_t len = msg-&gt;size();
            for (int i = 0; i &lt; len; i++) {
                    cout &lt;&lt;msg-&gt;get(i)-&gt;getString() &lt;&lt; ",";
            }
            cout &lt;&lt; endl;
    };

    int listenport = 10260;
    ThreadedClient threadedClient(listenport);
    auto thread = threadedClient.subscribe(hostName, port, myHandler, "messageStream", "printMessageStream", -1, true, nullptr, false, false, sdsp);
    cout&lt;&lt;"Successed to subscribe messageStream"&lt;&lt;endl;
    thread-&gt;join();

    return 0;
}</code></pre><p class="- topic/p p">调用订阅函数 ThreadedClient::subscribe 订阅异构流数据表时，在最后一个参数指定相应的流数据反序列化实例 StreamDeserializerSP，则在订阅时会对收到的数据进行反序列化再传递给用户自定义的回调函数 myHandler。</p><p class="- topic/p p">listenport 参数为单线程客户端的订阅端口号，设置 C++ 程序所在服务器的任意空闲端口即可。</p><ul class="- topic/ul ul"><li class="- topic/li li">在终端查看程序实时打印的内容：</li></ul><br/><img class="- topic/image image" src="images/stock_market_replay/C++API.png"/><br/></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title14" id="335-清理环境"><h4 class="- topic/title title topictitle4" id="ariaid-title14">3.3.5. 清理环境</h4><div class="- topic/body body"><p class="- topic/p p">如果反复执行上述脚本，可能需要清理流数据表、取消订阅、注销流计算引擎等操作，建议在运行回放与消费脚本前先清理环境。本教程的清理环境脚本见附录 <a class="- topic/xref xref" href="script/stock_market_replay/06.cleanEnvironment.txt">清理环境. txt</a>。</p></div></article></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title15" id="4-性能测试"><h2 class="- topic/title title topictitle2" id="ariaid-title15">4. 性能测试</h2><div class="- topic/body body"><p class="- topic/p p">本教程对异构模式下的多表回放功能进行了性能测试。以第三章提及的测试数据集作为回放的输入，以第三章第三小节的回放脚本作为测试脚本，该脚本不设定回放速率（即以最快的速率回放），并且输出表没有任何订阅，最终回放了 101,081,629 条数据至输出表中，总耗时 4m18s，每秒回放约 39 万条数据，内存占用峰值 4.7GB。测试使用的服务器的 CPU 为 Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz，更详细的服务器及DolphinDB server配置信息见后文<a class="- topic/xref xref" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">开发环境配置</a>。</p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title16" id="5-开发环境配置"><h2 class="- topic/title title topictitle2" id="ariaid-title16">5. 开发环境配置</h2><div class="- topic/body body"><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">服务器环境</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">CPU 类型：Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz</li><li class="- topic/li li">逻辑 CPU 总数：8</li><li class="- topic/li li">内存：64GB</li><li class="- topic/li li">OS：64 位 CentOS Linux 7 (Core)</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DolphinDB server 部署</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">server 版本：2.00.6</li><li class="- topic/li li">server 部署模式：单节点</li><li class="- topic/li li">配置文件：dolphindb.cfg</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>localSite=localhost:8848:local8848
mode=single
maxMemSize=32
maxConnections=512
workerNum=8
maxConnectionPerSite=15
newValuePartitionPolicy=add
webWorkerNum=2
dataSync=1
persistenceDir=/DolphinDB/server/persistenceDir
maxPubConnections=64
subExecutors=16
subPort=8849
subThrottle=1
persistenceWorkerNum=1
lanCluster=0</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>： 配置参数 <code class="+ topic/ph pr-d/codeph ph codeph">persistenceDir</code> 需要开发人员根据实际环境配置。</p><p class="- topic/p p">单节点部署教程：<a class="- topic/xref xref" href="standalone_server.html">单节点部署</a></p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DolphinDB client 开发环境</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">CPU 类型：Intel(R) Core(TM) i7-7700 CPU @ 3.60GHz   3.60 GHz</li><li class="- topic/li li">逻辑 CPU 总数：8</li><li class="- topic/li li">内存：32GB</li><li class="- topic/li li">OS：Windows 10 专业版</li><li class="- topic/li li">DolphinDB GUI 版本：1.30.15</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DolphinDB Kafka 插件安装</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">Kafka 插件版本：release200</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>： Kafka 插件版本建议按 DolphinDB server 版本选择，如 2.00.6 版本的 server 安装 release200 分支的插件</p><p class="- topic/p p">Kafka 插件教程：<a class="- topic/xref xref" href="../plugins/kafka/kafka.html">Kafka 插件教程</a></p><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">Kafka server 部署</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">zookeeper 版本：3.4.6</li><li class="- topic/li li">Kafka 版本：2.12-2.6.2</li><li class="- topic/li li">Kafka 部署模式：单节点</li><li class="- topic/li li">创建 Kafka topic</li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>./bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 4 --topic topic-message</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">DolphinDB C++ API 安装</strong></p><ul class="- topic/ul ul"><li class="- topic/li li">C++ API 版本：release200</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>： C++API 版本建议按 DolphinDB server 版本选择，如 2.00.6 版本的 server 安装 release200 分支的 API</p><p class="- topic/p p">C++ API 教程：<a class="- topic/xref xref" href="../api/cpp/cpp_api.html">C++ API 教程</a></p></div></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title17" id="6-搭建行情回放服务的最佳实践"><h2 class="- topic/title title topictitle2" id="ariaid-title17">6. 搭建行情回放服务的最佳实践</h2><div class="- topic/body body"><p class="- topic/p p">一个量化策略在生产（交易）环境中运行时，实时数据的处理通常是由事件驱动的。为确保研发和生产使用同一套代码，通常在研发阶段需将历史数据，严格按照事件发生的时间顺序进行回放，以此模拟交易环境。在 DolphinDB 中，用户通过 <code class="+ topic/ph pr-d/codeph ph codeph">replay</code> 函数可以实现对静态数据的回放，即将历史数据按照时间顺序以“实时数据”的方式注入流数据表中。对相同时间戳的数据还可以指定额外排序列，使数据回放顺序更接近实时交易场景。</p><p class="- topic/p p">在<a class="- topic/xref xref" href="data_replay.html">历史数据回放</a>、<a class="- topic/xref xref" href="stock_market_replay.html">股票行情回放</a>两篇教程中已经介绍了 DolphinDB 的回放功能，本教程更加侧重于回放功能的工程化实践。本教程将介绍如何基于 DolphinDB 分布式数据库、回放功能以及 DolphinDB API 搭建一个行情数据回放服务，该服务支持多个用户同时通过 C++ 、 Python 等客户端提交数据回放请求。</p></div><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title18" id="61-基于-dolphindb-的行情回放服务"><h3 class="- topic/title title topictitle3" id="ariaid-title18">6.1. 基于 DolphinDB 的行情回放服务</h3><div class="- topic/body body"><p class="- topic/p p">本教程实现的行情回放服务基于 3 类国内 A 股行情数"data_replay.md"数据，支持以下功能与特性：</p><ul class="- topic/ul ul"><li class="- topic/li li">C++、Python 客户端提交回放请求（指定回放股票列表 、回放日期、回放速率、回放数据源）</li><li class="- topic/li li">多个用户同时回放</li><li class="- topic/li li">多个数据源同时有序回放</li><li class="- topic/li li">在时间有序的基础上支持排序列有序（如：针对逐笔数据中的交易所原始消息记录号排序）</li><li class="- topic/li li">发布回放结束信号</li><li class="- topic/li li">对回放结果订阅消费</li></ul></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title19" id="611-行情回放服务架构"><h4 class="- topic/title title topictitle4" id="ariaid-title19">6.1.1. 行情回放服务架构</h4><div class="- topic/body body"><p class="- topic/p p">本教程示例 DolphinDB 搭建的行情回放服务架构如下图所示：</p><figure class="- topic/fig fig fignone"><figcaption data-caption-side="top" class="- topic/title title figcap"><span class="figtitleprefix fig--title-label">图<span class="fig--title-label-number"> 1</span><span class="fig--title-label-punctuation">. </span></span><span class="fig--title">行情回放服务架构</span></figcaption>
<img class="- topic/image image" src="../stream/images/stock_market_replay_2.png"/><br/>
    
</figure><ul class="- topic/ul ul"><li class="- topic/li li">行情数据接入：实时行情数据和历史行情数据可以通过 DolphinDB API 或插件存储到 DolphinDB 分布式时序数据库中。</li><li class="- topic/li li">函数模块封装：数据查询和回放过程可以通过 DolphinDB 函数视图封装内置，仅暴露股票列表 、回放日期、回放速率、回放数据源等关键参数给行情服务用户。</li><li class="- topic/li li">行情用户请求：需要进行行情回放的用户可以通过 DolphinDB 客户端软件（如 DolphinDB GUI 工具、DolphinDB VS Code 插件、DolphinDB API 等）调用封装好的回放函数对存储在数据库中的行情数据进行回放，同时，用户还可以在客户端对回放结果进行实时订阅消费。此外，支持多用户并发回放。</li></ul></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title20" id="612-回放服务搭建步骤"><h4 class="- topic/title title topictitle4" id="ariaid-title20">6.1.2. 回放服务搭建步骤</h4><div class="- topic/body body"><p class="- topic/p p">本教程示例 DolphinDB 搭建行情回放服务的具体操作步骤如下图所示：</p><figure class="- topic/fig fig fignone"><figcaption data-caption-side="top" class="- topic/title title figcap"><span class="figtitleprefix fig--title-label">图<span class="fig--title-label-number"> 2</span><span class="fig--title-label-punctuation">. </span></span><span class="fig--title">搭建步骤</span></figcaption>
<img class="- topic/image image" src="../stream/images/stock_market_replay_3.png"/><br/>
    
</figure><ul class="- topic/ul ul"><li class="- topic/li li">Step 1：服务提供者设计合理分区的数据库表，在 DolphinDB 集成开发环境中执行对应的建库建表、数据导入等脚本，以将历史行情数据存储到 DolphinDB 分布式数据库中作为回放服务的数据源。在第二章将给出本教程涉及的 3 类行情数据的分区存储方案及建库建表脚本。</li><li class="- topic/li li">Step 2：服务提供者在 DolphinDB 集成开发环境中将回放过程中的操作封装成函数视图，通过封装使得行情服务用户不需要关心 DolphinDB 回放功能的细节，只需要指定简单的回放参数（股票、日期、回放速率、数据源）即可提交回放请求。在第三章将给全部函数视图的定义脚本。</li><li class="- topic/li li">Step 3：服务提供者在外部程序中通过 DolphinDB API 调用上述函数视图实现提交回放的功能。在第四章将给出 API 端提交回放任务的 C++ 实现和 Python 实现。此外，在第四章提交回放的基础上，在第五章将介绍对回放结果的 API 端订阅与消费的代码实现。</li></ul><p class="- topic/p p">在第六章将给出多用户多表回放、多天回放的性能测试结果。最后两章为开发环境配置与总结。</p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title21" id="62-行情数据分区存储方案"><h3 class="- topic/title title topictitle3" id="ariaid-title21">6.2. 行情数据分区存储方案</h3><div class="- topic/body body"><p class="- topic/p p">本教程的回放服务基于 3 类国内 A 股行情数据源：逐笔成交数据、逐笔委托数据、快照数据，均使用 TSDB 存储引擎存储在 DolphinDB 分布式数据库中。</p><div class="table-container"><table class="- topic/table table" data-cols="6"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="62-行情数据分区存储方案__entry__1"><strong class="+ topic/ph hi-d/b ph b">数据源</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="62-行情数据分区存储方案__entry__2"><strong class="+ topic/ph hi-d/b ph b">代码样例中的分区数据库路径</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="62-行情数据分区存储方案__entry__3"><strong class="+ topic/ph hi-d/b ph b">代码样例中的表名</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="62-行情数据分区存储方案__entry__4"><strong class="+ topic/ph hi-d/b ph b">分区机制</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="62-行情数据分区存储方案__entry__5"><strong class="+ topic/ph hi-d/b ph b">排序列</strong></th><th class="- topic/entry entry align-left colsep-0 rowsep-0" id="62-行情数据分区存储方案__entry__6"><strong class="+ topic/ph hi-d/b ph b">建库建表脚本</strong></th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__1">逐笔委托</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__2">dfs://Test_order</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__3">order</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__4">VALUE: 交易日, HASH: [SYMBOL, 25]</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__5">股票ID，交易时间</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__6">附录 <a class="- topic/xref xref" href="script/appendices_market_replay_bp/order_create.txt">逐笔委托建库建表脚本</a></td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__1">逐笔成交</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__2">dfs://Test_transaction</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__3">transaction</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__4">VALUE: 交易日, HASH: [SYMBOL, 25]</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__5">股票ID，交易时间</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__6">附录 <a class="- topic/xref xref" href="script/appendices_market_replay_bp/transac_create.txt">逐笔成交建库建表脚本</a></td></tr><tr class="- topic/row"><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__1">快照</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__2">dfs://Test_snapshot</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__3">snapshot</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__4">VALUE: 交易日, HASH: [SYMBOL, 20]</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__5">股票ID，交易时间</td><td class="- topic/entry entry align-left colsep-0 rowsep-0" headers="62-行情数据分区存储方案__entry__6">附录 <a class="- topic/xref xref" href="script/appendices_market_replay_bp/snap_create.txt">快照建库建表脚本</a></td></tr></tbody></table></div><p class="- topic/p p">回放的原理是从数据库中读取需要的行情数据，并根据时间列排序后写入到相应的流数据表。因此，读数据库并排序的性能对回放速度有很大的影响，合理的分区机制将有助于提高数据加载速度。基于用户通常按照日期和股票提交回放请求的特点，设计了上表的分区方案。</p><p class="- topic/p p">此外，本教程的历史数据存储在三节点双副本的 DolphinDB 集群中，集群和副本同样可以提升读取性能，同时可以增加系统的可用性，分区的副本通常是存放在不同的物理节点的，所以一旦某个分区不可用，系统依然可以调用其它副本分区来保证回放服务的正常运转。</p><p class="- topic/p p">附录将提供部分原始数据的 csv 文件（原始行情数据文件）以及对应的示例导入脚本（逐笔委托示例导入脚本、逐笔成交示例导入脚本、快照示例导入脚本），以便读者快速体验搭建本教程所示的行情回放服务。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title22" id="63-行情回放自定义函数"><h3 class="- topic/title title topictitle3" id="ariaid-title22">6.3. 行情回放自定义函数</h3><div class="- topic/body body"><p class="- topic/p p">本章介绍回放过程中的主要函数功能及其实现，最后将函数封装成视图以便通过 API 等方式调用。</p><p class="- topic/p p">本章的开发工具采用 DolphinDB GUI，完整脚本见附录：<a class="- topic/xref xref" href="script/appendices_market_replay_bp/replay.txt">行情回放函数</a>。</p><div class="table-container"><table class="- topic/table table" data-cols="3"><caption></caption><colgroup><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="63-行情回放自定义函数__entry__1">函数名</th><th class="- topic/entry entry colsep-0 rowsep-0" id="63-行情回放自定义函数__entry__2">函数入参</th><th class="- topic/entry entry colsep-0 rowsep-0" id="63-行情回放自定义函数__entry__3">函数功能</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__1">stkReplay</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__2">stkList：回放股票列表startDate：回放开始日期endDate：回放结束日期replayRate：回放速率replayUuid：回放用户标识replayName：回放数据源名称</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__3">行情回放服务主函数</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__1">dsTb</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__2">timeRS：数据源时间划分startDate：回放开始日期endDate：回放结束日期stkList：回放股票列表replayName：回放数据源名称</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__3">构造回放数据源</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__1">createEnd</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__2">tabName：回放输出表名称sortColumn：相同时间戳时额外排序列名</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__3">构造回放结束信号</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__1">replayJob</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__2">inputDict：回放输入数据源tabName：回放输出表名称dateDict：回放排序时间列timeDict：回放排序时间列replayRate：回放速率sortColumn：相同时间戳时额外排序列名</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="63-行情回放自定义函数__entry__3">定义回放任务内容</td></tr></tbody></table></div></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title23" id="631-stkreplay-函数行情回放服务主函数"><h4 class="- topic/title title topictitle4" id="ariaid-title23">6.3.1. stkReplay 函数：行情回放服务主函数</h4><div class="- topic/body body"><p class="- topic/p p">函数定义代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def stkReplay(stkList, mutable startDate, mutable endDate, replayRate, replayUuid, replayName)
{
    maxCnt = 50
    returnBody = dict(STRING, STRING)
    startDate = datetimeParse(startDate, "yyyyMMdd")
    endDate = datetimeParse(endDate, "yyyyMMdd") + 1
    sortColumn = "ApplSeqNum"
    if(stkList.size() &gt; maxCnt)
    {
        returnBody["errorCode"] = "0"
        returnBody["errorMsg"] = "超过单次回放股票上限，最大回放上限：" + string(maxCnt)
        return returnBody
    }
    if(size(replayName) != 0)
    { 
        for(name in replayName)
        {
            if(not name in ["snapshot", "order", "transaction"])
            {
                returnBody["errorCode"] = "0"
                returnBody["errorMsg"] = "请输入正确的数据源名称，不能识别的数据源名称：" + name
                return returnBody
            }
        }
    }
    else
    {
        returnBody["errorCode"] = "0"
        returnBody["errorMsg"] = "缺少回放数据源，请输入正确的数据源名称"
        return returnBody
    }
    try 
    {
        if(size(replayName) == 1 &amp;&amp; replayName[0] == "snapshot")
        {
            colName = ["timestamp", "biz_type", "biz_data"]
            colType = [TIMESTAMP, SYMBOL, BLOB]
            sortColumn = "NULL"
        }
        else
        {
            colName = ["timestamp", "biz_type", "biz_data", sortColumn]
            colType = [TIMESTAMP, SYMBOL, BLOB, LONG]
        }
        msgTmp = streamTable(10000000:0, colName, colType)
        tabName = "replay_" + replayUuid
        enableTableShareAndPersistence(table=msgTmp, tableName=tabName, asynWrite=true, compress=true, cacheSize=10000000, retentionMinutes=60, flushMode=0, preCache=1000000)
        
        timeRS = cutPoints(09:30:00.000..15:00:00.000, 23)
        
        inputDict = dict(replayName, each(dsTb{timeRS, startDate, endDate, stkList}, replayName))
        dateDict = dict(replayName, take(`MDDate, replayName.size()))
        timeDict = dict(replayName, take(`MDTime, replayName.size()))
        
        jobId = "replay_" + replayUuid
        jobDesc = "replay stock data"
        submitJob(jobId, jobDesc, replayJob{inputDict, tabName, dateDict, timeDict, replayRate, sortColumn})
        returnBody["errorCode"] = "1"
        returnBody["errorMsg"] = "后台回放成功"
        return returnBody
    }
    catch(ex)
    {
        returnBody["errorCode"] = "0"
        returnBody["errorMsg"] = "回放行情数据异常，异常信息：" + ex
        return returnBody
    }
}</code></pre><p class="- topic/p p">函数功能：</p><p class="- topic/p p">自定义函数 stkReplay 是整个回放的主体函数，用户传入的参数在 stkReplay 里会进行有效性判断及格式处理，可以根据实际需求更改。</p><p class="- topic/p p">首先，用 maxCnt 来控制用户一次回放股票数量的最大上限，本例中设置的是 50 。returnBody 构造了信息字典，返回给用户以提示执行错误或执行成功。回放开始日期 startDate 和回放结束日期 endDate 利用<code class="+ topic/ph pr-d/codeph ph codeph">datetimeParse</code>函数进行格式处理 。replayRate 是回放速率，replayUuid 是回放表名名称，replayName 是回放数据源列表，sortColumn 是数据源同回放时间戳排序列列名。</p><p class="- topic/p p">当输入参数无误后，便初始化回放结果流数据表，结果流数据表为异构流数据表，字段类型为 BLOB 的字段包含了一条原始记录的全部信息，同时结果流数据表为持久化流数据表，<code class="+ topic/ph pr-d/codeph ph codeph">enableTableShareAndPersistence</code>函数把流数据表共享并把它持久化到磁盘上，使用持久化流数据表可以避免内存占用过大。当回放数据源包含逐笔成交（transaction ）或逐笔委托（order）时，本例实现了对相同时间戳的逐笔数据按交易所原始消息记录号（ApplSeqNum）进行排序（具体实现见 <a class="- topic/xref xref" href="#replayjob-%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89%E5%9B%9E%E6%94%BE%E4%BB%BB%E5%8A%A1%E5%86%85%E5%AE%B9">replayJob 函数</a>），所以结果流数据表中必须冗余一列来存放排序列。若回放数据源仅包含快照（snapshot）时，则不需要冗余一列排序列。</p><p class="- topic/p p">定义回放需要的其他参数。inputDict 构造了回放数据源列表字典，利用 <code class="+ topic/ph pr-d/codeph ph codeph">each</code>函数可以对多个数据源进行简洁的定义。dateDict 和 timeDict 构造了回放数据源时间戳字典。最后通过<code class="+ topic/ph pr-d/codeph ph codeph">submitJob</code>提交后台回放任务。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title24" id="632-dstb-函数构造回放数据源"><h4 class="- topic/title title topictitle4" id="ariaid-title24">6.3.2. dsTb 函数：构造回放数据源</h4><div class="- topic/body body"><p class="- topic/p p">函数定义代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def dsTb(timeRS, startDate, endDate, stkList, replayName)
{
    if(replayName == "snapshot"){
        tab = loadTable("dfs://Test_snapshot", "snapshot")
	}
	else if(replayName == "order") {
		tab = loadTable("dfs://Test_order", "order")
	}
	else if(replayName == "transaction") {
		tab = loadTable("dfs://Test_transaction", "transaction")
	}
	else {
		return NULL
	}
    ds = replayDS(sqlObj=&lt;select * from tab where MDDate&gt;=startDate and MDDate&lt;endDate and HTSCSecurityID in stkList&gt;, dateColumn='MDDate', timeColumn='MDTime', timeRepartitionSchema=timeRS)
    return ds
}</code></pre><p class="- topic/p p">函数功能：</p><p class="- topic/p p">自定义函数 dsTb 返回符合用户回放需求的数据源划分结果。主要是对内置 replayDS 函数进行了进一步的封装，函数首先对用户端输入的 replayName 进行判断，选择从数据库加载对应的表对象。利用 replayDS 对交易日期在 startDate 至 endDate 之间、股票代号在 stkList 内的数据按照 timeRS 进行数据源划分，返回某一个数据源的列表。</p><p class="- topic/p p">timeRS 参数对应 replayDS 函数中的 timeRepartitionSchema 参数，是时间类型的向量，可用于将数据源划分为更小粒度的多个数据源，以保证查询 DFS 表中数据的效率以及控制内存大小。本例在 <a class="- topic/xref xref" href="#stkreplay-%E5%87%BD%E6%95%B0%E8%A1%8C%E6%83%85%E5%9B%9E%E6%94%BE%E6%9C%8D%E5%8A%A1%E4%B8%BB%E5%87%BD%E6%95%B0">stkReplay 函数</a> 中构造了 timeRS 变量，其意为对于一天的数据在有效时间段内平均分为 23 份。</p><p class="- topic/p p">执行如下代码查看 <code class="+ topic/ph pr-d/codeph ph codeph">dsTb</code> 函数返回的结果：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>timeRS = cutPoints(09:30:00.000..15:00:00.000, 3)
startDate = 2021.12.01
endDate = 2021.12.02
stkList = ['000616.SZ']
replayName = ["order"]
ds = dsTb(timeRS, startDate, endDate, stkList, replayName)</code></pre><p class="- topic/p p">ds 为一个向量，其中每一个元素如下，数据源被划分为多个小的 SQL 查询语句，具体原理参考<code class="+ topic/ph pr-d/codeph ph codeph">replayDS</code>函数。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>DataSource&lt; select [4] * from tab where time(MDTime) &lt; 09:30:00.000,nanotime(MDTime) &gt;= 00:00:00.000000000,date(MDDate) == 2021.12.01,MDDate &gt;= 2021.12.01 and MDDate &lt; 2021.12.02 and SecurityID in ["000616.SZ"] order by MDDate asc,MDTime asc &gt;
DataSource&lt; select [4] * from tab where time(MDTime) &lt; 11:20:00.001,time(MDTime) &gt;= 09:30:00.000,date(MDDate) == 2021.12.01,MDDate &gt;= 2021.12.01 and MDDate &lt; 2021.12.02 and SecurityID in ["000616.SZ"] order by MDDate asc,MDTime asc &gt;
DataSource&lt; select [4] * from tab where time(MDTime) &lt; 13:10:00.001,time(MDTime) &gt;= 11:20:00.001,date(MDDate) == 2021.12.01,MDDate &gt;= 2021.12.01 and MDDate &lt; 2021.12.02 and SecurityID in ["000616.SZ"] order by MDDate asc,MDTime asc &gt;
DataSource&lt; select [4] * from tab where time(MDTime) &lt; 15:00:00.001,time(MDTime) &gt;= 13:10:00.001,date(MDDate) == 2021.12.01,MDDate &gt;= 2021.12.01 and MDDate &lt; 2021.12.02 and SecurityID in ["000616.SZ"] order by MDDate asc,MDTime asc &gt;
DataSource&lt; select [4] * from tab where nanotime(MDTime) &lt;= 23:59:59.999999999,time(MDTime) &gt;= 15:00:00.001,date(MDDate) == 2021.12.01,MDDate &gt;= 2021.12.01 and MDDate &lt; 2021.12.02 and SecurityID in ["000616.SZ"] order by MDDate asc,MDTime asc &gt;</code></pre></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title25" id="633-replayjob-函数定义回放任务内容"><h4 class="- topic/title title topictitle4" id="ariaid-title25">6.3.3. replayJob 函数：定义回放任务内容</h4><div class="- topic/body body"><p class="- topic/p p">函数定义代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def replayJob(inputDict, tabName, dateDict, timeDict, replayRate, sortColumn)
{
    if(sortColumn == "NULL")
    {
        replay(inputTables=inputDict, outputTables=objByName(tabName), dateColumn=dateDict, timeColumn=timeDict, replayRate=int(replayRate), absoluteRate=false, parallelLevel=23)
    }
    else
    {
        replay(inputTables=inputDict, outputTables=objByName(tabName), dateColumn=dateDict, timeColumn=timeDict, replayRate=int(replayRate), absoluteRate=false, parallelLevel=23, sortColumns=sortColumn)    
    }
    createEnd(tabName, sortColumn)
}</code></pre><p class="- topic/p p">函数功能：</p><p class="- topic/p p">自定义函数 <code class="+ topic/ph pr-d/codeph ph codeph">replayJob</code> 提交用户数据回放并调用 <code class="+ topic/ph pr-d/codeph ph codeph">createEnd</code> 函数，这里首先通过内置 <code class="+ topic/ph pr-d/codeph ph codeph">replay</code> 函数回放用户需求数据，此处回放模式为 N 对 1 异构回放。<code class="+ topic/ph pr-d/codeph ph codeph">replay</code> 函数返回后即表示需要的数据已经全部回放结束，再执行自定义 <code class="+ topic/ph pr-d/codeph ph codeph">createEnd</code> 函数以构造结束信号写入回放结果里。调用 <code class="+ topic/ph pr-d/codeph ph codeph">createEnd</code> 函数是可选的，其功能是在回放结束时再发布一条特殊的记录，以标识回放结束。</p><p class="- topic/p p">参数 sortColumn 用于指定额外的排序列，如果用户回放的数据源为仅仅包含快照（snapshot），对于这种特殊情况需要指定 <code class="+ topic/ph pr-d/codeph ph codeph">replayJob</code> 函数的回放时间戳排序列参数 sortColumn 为 NULL ，则调用内置的 <code class="+ topic/ph pr-d/codeph ph codeph">replay</code> 函数时不加入 sortColumn 参数。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title26" id="634-createend-函数构造回放结束信号"><h4 class="- topic/title title topictitle4" id="ariaid-title26">6.3.4. createEnd 函数：构造回放结束信号</h4><div class="- topic/body body"><p class="- topic/p p">函数定义代码：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def createEnd(tabName, sortColumn)
{
    dbName = "dfs://End"
    tbName = "endline"
    if(not existsDatabase(dbName))
    {
        db = database(directory=dbName, partitionType=VALUE, partitionScheme=2023.04.03..2023.04.04)
        endTb = table(2200.01.01T23:59:59.000 as DateTime, `END as point, long(0) as ApplSeqNum)
        endLine = db.createPartitionedTable(table=endTb, tableName=tbName, partitionColumns=`DateTime)
        endLine.append!(endTb)
    }
     
    ds = replayDS(sqlObj=&lt;select * from loadTable(dbName, tbName)&gt;, dateColumn='DateTime', timeColumn='DateTime')
    
    inputEnd = dict(["end"], [ds])
    dateEnd = dict(["end"], [`DateTime])
    timeEnd = dict(["end"], [`DateTime])
    if(sortColumn == "NULL")
    {
        replay(inputTables=inputEnd, outputTables=objByName(tabName), dateColumn=dateEnd, timeColumn=timeEnd, replayRate=-1, absoluteRate=false, parallelLevel=1)
    }
    else
    {
        replay(inputTables=inputEnd, outputTables=objByName(tabName), dateColumn=dateEnd, timeColumn=timeEnd, replayRate=-1, absoluteRate=false, parallelLevel=1, sortColumns=sortColumn)
    }
}</code></pre><p class="- topic/p p">函数功能：</p><p class="- topic/p p">自定义函数 createEnd 是在回放结束时给用户提供一条回放结束信号，利用了 replay 回放模式中的 N 对 1 异构回放构造回放信号，会往参数 tabName 指定的异构流数据表中写入一条消息类型列为 end 的记录。为方便后期异构消费解析以及复用，此处为结束信号独立建一个数据库并创建分区表，表内必须有时间列，其他字段可选。并向该表写入一条模拟数据，其数据内容没有任何强制要求。DolphinDB 建库建表相关知识可参考<a class="- topic/xref xref" href="database.html">分区数据库</a> 。inputEnd、dateEnd、timeEnd 字典的 key 按需设置为字符串 end，将对应 replay 函数指定的输出表中的第二个字典，即消息类型。</p><p class="- topic/p p">参数 sortColumn 用于指定额外的排序列，如果用户回放的数据源为仅仅包含快照（snapshot），则调用内置的 replay 函数时不加入 sortColumn 参数，结果流数据表中的结束信号记录如下。</p><img class="- topic/image image" src="images/appendices_market_replay_bp/3_1.png"/><br/></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title27" id="635-封装函数视图"><h4 class="- topic/title title topictitle4" id="ariaid-title27">6.3.5. 封装函数视图</h4><div class="- topic/body body"><p class="- topic/p p">将以上函数利用<code class="+ topic/ph pr-d/codeph ph codeph">addFunctionView</code>封装成函数视图，具体代码如下。 API 端仅需要调用主函数 <code class="+ topic/ph pr-d/codeph ph codeph">stkReplay</code>，第四章回放全部基于该函数视图。</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>addFunctionView(dsTb)
addFunctionView(createEnd)
addFunctionView(replayJob)
addFunctionView(stkReplay)</code></pre></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title28" id="64-api-提交回放"><h3 class="- topic/title title topictitle3" id="ariaid-title28">6.4. API 提交回放</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title29" id="641-c-api"><h4 class="- topic/title title topictitle4" id="ariaid-title29">6.4.1. C++ API</h4><div class="- topic/body body"><p class="- topic/p p">本例程序运行在 Linux 系统 DolphinDB C++ API 环境下，编译成可执行文件以命令行输入参数执行。完整脚本见附录 <a class="- topic/xref xref" href="script/appendices_market_replay_bp/cpp_replay.cpp">C++ 源码</a>。</p></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title30" id="6411-c-api-调用回放服务"><h5 class="- topic/title title topictitle5" id="ariaid-title30">6.4.1.1. C++ API 调用回放服务</h5><div class="- topic/body body"><p class="- topic/p p">C++ API 调用回放服务代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>DictionarySP result = conn.run("stkReplay", args);
string errorCode = result-&gt;get(Util::createString("errorCode"))-&gt;getString();
if (errorCode != "1") 
{
    std::cout &lt;&lt; result-&gt;getString() &lt;&lt; endl;
    return -1;
}</code></pre><p class="- topic/p p">conn 是 DolphinDB C++ API DBConnection 对象， C++ 应用可以通过它在 DolphinDB 服务器上执行脚本和函数并在两者之间双向传递数据。conn 通过 <code class="+ topic/ph pr-d/codeph ph codeph">run</code> 方法调用 stkReplay 自定义函数，args 容器内包含了 <code class="+ topic/ph pr-d/codeph ph codeph">stkReplay</code> 函数所需的参数。执行结果返回到字典 result 中，可以通过 <code class="+ topic/ph pr-d/codeph ph codeph">get</code> 方法来获得 key 为 errorCode 对应的值，如果错误代号不为 1 ，则代表回放执行错误，返回错误信息并结束程序。</p><p class="- topic/p p">多用户进行回放时，需要对用户回放的流数据表进行命名，为了不重复命名以避免冲突，对每个回放用户生成唯一识别号，会生成形如 “Eq8Jk8Dd0Tw5Ej8D” 的识别字符串，代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>string uuid(int len)
{
    char* str = (char*)malloc(len + 1);
    srand(getpid());
    for (int i = 0; i &lt; len; ++i)
    {
        switch (i % 3)
        {
        case 0:
            str[i] = 'A' + std::rand() % 26;
            break;
        case 1:
            str[i] = 'a' + std::rand() % 26;
            break;
        default:
            str[i] = '0' + std::rand() % 10;
            break;
        }
    }
    str[len] = '\0';
    std::string rst = str;
    free(str);
    return rst;
}</code></pre></div></article></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title31" id="642-python-api"><h4 class="- topic/title title topictitle4" id="ariaid-title31">6.4.2. Python API</h4><div class="- topic/body body"><p class="- topic/p p">本例程序运行在 Windows 系统 DolphinDB Python API 环境下，可以在任何具备该环境的客户端执行。完整脚本见附录 <a class="- topic/xref xref" href="script/appendices_market_replay_bp/python_replay.py">Python 源码</a>。</p></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title32" id="6421-python-api-调用回放服务"><h5 class="- topic/title title topictitle5" id="ariaid-title32">6.4.2.1. Python API 调用回放服务</h5><div class="- topic/body body"><p class="- topic/p p">Python API 调用回放服务代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>stk_list = ['000616.SZ','000681.SZ']
start_date = '20211201'
end_date = '20211201'
replay_rate = -1
replay_name = ['snapshot']
s.upload({'stk_list':stk_list, 'start_date':start_date, 'end_date':end_date, 'replay_rate':replay_rate, 'replay_uuid':uuidStr, 'replay_name':replay_name})
s.run("stkReplay(stk_list, start_date, end_date, replay_rate, replay_uuid, replay_name)")</code></pre><p class="- topic/p p">stk_list 是回放股票列表，start_date 是回放开始日期，end_date 是回放结束日期，replay_rate 是回放速率，replay_uuid 是回放流数据表名称，replay_name 是回放数据源列表。s 是 DolphinDB 会话，Python 应用通过会话在 DolphinDB 服务器上执行脚本和函数以及在两者之间双向传递数据。使用 s 的 <code class="+ topic/ph pr-d/codeph ph codeph">upload</code> 方法上传 Python 对象，使用 <code class="+ topic/ph pr-d/codeph ph codeph">run</code> 方法执行 stkReplay 函数。</p><p class="- topic/p p">多用户进行回放时，需要对用户回放的流数据表进行命名，为了不重复命名以避免冲突，对每个回放用户生成唯一识别号，会生成形如“Eq8Jk8Dd0Tw5Ej8D”的识别字符串，代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def uuid(length):
    str=""
    for i in range(length):
        if(i % 3 == 0):
            str += chr(ord('A') + random.randint(0, os.getpid() + 1) % 26)
        elif(i % 3 == 1):
            str += chr(ord('a') + random.randint(0, os.getpid() + 1) % 26)
        else:
            str += chr(ord('0') + random.randint(0, os.getpid() + 1) % 10)
    return str

uuidStr = uuid(16)</code></pre></div></article></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title33" id="65-api-订阅消费"><h3 class="- topic/title title topictitle3" id="ariaid-title33">6.5. API 订阅消费</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title34" id="651-c-api"><h4 class="- topic/title title topictitle4" id="ariaid-title34">6.5.1. C++ API</h4><div class="- topic/body body"></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title35" id="6511-反序列化器构造"><h5 class="- topic/title title topictitle5" id="ariaid-title35">6.5.1.1. 反序列化器构造</h5><div class="- topic/body body"><p class="- topic/p p">为使异构流数据表反序列化输出，构造输出表结构，代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>DictionarySP snap_full_schema = conn.run("loadTable(\"dfs://Test_snapshot\", \"snapshot\").schema()");
DictionarySP order_full_schema = conn.run("loadTable(\"dfs://Test_order\", \"order\").schema()");
DictionarySP transac_full_schema = conn.run("loadTable(\"dfs://Test_transaction\", \"transaction\").schema()");
DictionarySP end_full_schema = conn.run("loadTable(\"dfs://End\", \"endline\").schema()");

unordered_map&lt;string, DictionarySP&gt; sym2schema;
sym2schema["snapshot"] = snap_full_schema;
sym2schema["order"] = order_full_schema;
sym2schema["transaction"] = transac_full_schema;
sym2schema["end"] = end_full_schema;
StreamDeserializerSP sdsp = new StreamDeserializer(sym2schema);</code></pre><p class="- topic/p p">上述前四行分别是快照、逐笔委托、逐笔成交、结束信号的表结构构造，回放根据需要选择对应的表结构，结束信号表必须有。unordered_map 创建了 key-&gt;schema 的映射表，可以将回放数据源和结束信号按照 schema 进行结构解析。通过 StreamDeserializer 对象来构造异构流数据表反序列化器。</p></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title36" id="6512-订阅回放服务"><h5 class="- topic/title title topictitle5" id="ariaid-title36">6.5.1.2. 订阅回放服务</h5><div class="- topic/body body"><p class="- topic/p p">在 DolphinDB C++ API 中订阅异构流数据表，代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>int listenport = 10260;
ThreadedClient threadedClient(listenport);
string tableNameUuid = "replay_" + uuidStr;
auto thread = threadedClient.subscribe(hostName, port, myHandler, tableNameUuid, "stkReplay", 0, true, nullptr, true, 500000, 0.001, false, "admin", "123456", sdsp);
std::cout &lt;&lt; "Successed to subscribe " + tableNameUuid &lt;&lt; endl;
thread-&gt;join();</code></pre><p class="- topic/p p">listenport 是单线程客户端的订阅端口号，tableNameUuid 是用户回放的流数据表名称，通过 threadedClient.subscribe 可以订阅回放的流数据表，详情用法参考  <a class="- topic/xref xref" href="../api/cpp/cpp_api.html">C++ API 订阅</a> 。thread 指向循环调用 myHandler 的线程的指针，线程在 topic 被取消订阅后会退出。</p></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title37" id="6513-消费函数构造"><h5 class="- topic/title title topictitle5" id="ariaid-title37">6.5.1.3. 消费函数构造</h5><div class="- topic/body body"><p class="- topic/p p">调用订阅函数 <code class="+ topic/ph pr-d/codeph ph codeph">threadedClient.subscribe</code> 订阅异构流数据表时，在最后一个参数指定相应的流数据反序列化实例 StreamDeserializerSP ，在订阅时会对收到的数据进行反序列化再传递给用户自定义的回调函数 <code class="+ topic/ph pr-d/codeph ph codeph">myHandler</code>，用户可以在回调函数内自定义消费，本文仅实现了简单的输出消费，当消息 msg 的标识为 end 时，通过 <code class="+ topic/ph pr-d/codeph ph codeph">threadedClient.unsubscribe</code> 取消订阅，代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>long sumcount = 0;
long long starttime = Util::getNanoEpochTime();
auto myHandler = [&amp;](vector&lt;Message&gt; msgs) 
{
    for (auto&amp; msg : msgs) 
    {
        std::cout &lt;&lt; msg.getSymbol() &lt;&lt; " : " &lt;&lt; msg-&gt;getString() &lt;&lt; endl;
        if(msg.getSymbol() == "end")
        {
            threadedClient.unsubscribe(hostName, port, tableNameUuid,"stkReplay");
        }
        sumcount += msg-&gt;get(0)-&gt;size();
    }
    long long speed = (Util::getNanoEpochTime() - starttime) / sumcount;
    std::cout &lt;&lt; "callback speed: " &lt;&lt; speed &lt;&lt; "ns" &lt;&lt; endl;
};</code></pre></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title38" id="6514-程序执行"><h5 class="- topic/title title topictitle5" id="ariaid-title38">6.5.1.4. 程序执行</h5><div class="- topic/body body"><p class="- topic/p p">将如上 C++ 程序代码写入 main.cpp 中，在 DolphinDB C++ API 环境下编译成可执行文件 main ，按照如下命令格式输入，回车，即可开始“回放-订阅-消费”过程。</p><p class="- topic/p p">单支股票最大速度回放 “order“ 表一天数据命令：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>$  ./main 000616.SZ 20211201 20211201 -1 order</code></pre><p class="- topic/p p">两支(多支)股票最大速度回放三张表一天数据命令：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>$  ./main 000616.SZ,000681.SZ 20211201 20211201 -1 snapshot,order,transaction</code></pre></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title39" id="6515-消费输出"><h5 class="- topic/title title topictitle5" id="ariaid-title39">6.5.1.5. 消费输出</h5><div class="- topic/body body"><p class="- topic/p p">根据前文构造的消费函数，两支股票（“000616.SZ” &amp;“000681.SZ”）最大速度回放三张表一天数据输出如下图所示：</p><figure class="- topic/fig fig fignone"><figcaption data-caption-side="top" class="- topic/title title figcap"><span class="figtitleprefix fig--title-label">图<span class="fig--title-label-number"> 3</span><span class="fig--title-label-punctuation">. </span></span><span class="fig--title">消费输出结果</span></figcaption>
<img class="- topic/image image" src="images/appendices_market_replay_bp/5_1.png"/><br/>
    
</figure></div></article></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title40" id="652-python-api"><h4 class="- topic/title title topictitle4" id="ariaid-title40">6.5.2. Python API</h4><div class="- topic/body body"></div><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title41" id="6521-反序列化器构造"><h5 class="- topic/title title topictitle5" id="ariaid-title41">6.5.2.1. 反序列化器构造</h5><div class="- topic/body body"><p class="- topic/p p">为使异构流数据表反序列化输出，Python API 通过 streamDeserializer 类来构造异构流数据表反序列化器，同时定义输出表结构，代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>sd = ddb.streamDeserializer({
    'snapshot':  ["dfs://Test_snapshot", "snapshot"],
    'order': ["dfs://Test_order", "order"],
    'transaction': ["dfs://Test_transaction", "transaction"],
    'end': ["dfs://End", "endline"],
}, s)</code></pre><p class="- topic/p p">上述主体部分分别是快照、逐笔委托、逐笔成交、结束信号的表结构构造，回放根据需要选择对应的表结构，结束信号表必须有。</p></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title42" id="6522-python-api-订阅回放服务"><h5 class="- topic/title title topictitle5" id="ariaid-title42">6.5.2.2. Python API 订阅回放服务</h5><div class="- topic/body body"><p class="- topic/p p">在 DolphinDB Python API 中订阅异构流数据表，代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>s.enableStreaming(0)
s.subscribe(host=hostname, port=portname, handler=myHandler, tableName="replay_"+uuidStr, actionName="replay_stock_data", offset=0, resub=False, msgAsTable=False, streamDeserializer=sd, userName="admin", password="123456")
event.wait()</code></pre><p class="- topic/p p"><code class="+ topic/ph pr-d/codeph ph codeph">enableStreaming</code> 函数启用流数据功能，函数参数指定开启数据订阅的端口。s 使用 <code class="+ topic/ph pr-d/codeph ph codeph">subscribe</code> 函数来订阅 DolphinDB 中的流数据表。订阅是异步执行的，<code class="+ topic/ph pr-d/codeph ph codeph">event.wait()</code> 保持主线程不退出。</p></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title43" id="6523-消费函数构造"><h5 class="- topic/title title topictitle5" id="ariaid-title43">6.5.2.3. 消费函数构造</h5><div class="- topic/body body"><p class="- topic/p p">调用订阅函数 <code class="+ topic/ph pr-d/codeph ph codeph">s.subscribe</code> 订阅异构流数据表时，在参数指定相应的流数据反序列化实例 <code class="+ topic/ph pr-d/codeph ph codeph">streamDeserializer</code>,在订阅时会对收到的数据进行反序列化再传递给用户自定义的回调函数 <code class="+ topic/ph pr-d/codeph ph codeph">myHandler</code>，用户可以在回调函数内自定义消费，仅输出消费代码如下：</p><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>def myHandler(lst):
    if lst[-1] == "snapshot":
        print("SNAPSHOT: ", lst)
    elif lst[-1] == 'order':
        print("ORDER: ", lst)
    elif lst[-1] == 'transaction':
        print("TRANSACTION: ", lst)
    else:
        print("END: ", lst)
        event.set()</code></pre></div></article><article class="- topic/topic topic nested4" aria-labelledby="ariaid-title44" id="6524-消费输出"><h5 class="- topic/title title topictitle5" id="ariaid-title44">6.5.2.4. 消费输出</h5><div class="- topic/body body"><p class="- topic/p p">根据前文构造的消费函数，两支股票（“000616.SZ” &amp;“000681.SZ”）最大速度回放三张表一天数据输出如下图所示：</p><figure class="- topic/fig fig fignone"><figcaption data-caption-side="top" class="- topic/title title figcap"><span class="figtitleprefix fig--title-label">图<span class="fig--title-label-number"> 4</span><span class="fig--title-label-punctuation">. </span></span><span class="fig--title">消费输出结果</span></figcaption>
<img class="- topic/image image" src="images/appendices_market_replay_bp/5_2.png"/><br/>
    
</figure></div></article></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title45" id="66-性能测试"><h3 class="- topic/title title topictitle3" id="ariaid-title45">6.6. 性能测试</h3><div class="- topic/body body"><p class="- topic/p p">测试的交易日范围从 2021 年 12 月 1 日至 12 月 9 日共 7 个连续交易日。测试脚本见附录：<a class="- topic/xref xref" href="script/appendices_market_replay_bp/cpp_replay_test.cpp">C++ 测试源码</a>。</p></div></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title46" id="67-测试服务器配置"><h3 class="- topic/title title topictitle3" id="ariaid-title46">6.7. 测试服务器配置</h3><div class="- topic/body body"><div class="table-container"><table class="- topic/table table" data-cols="2"><caption></caption><colgroup><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="67-测试服务器配置__entry__1">CPU 类型</th><th class="- topic/entry entry colsep-0 rowsep-0" id="67-测试服务器配置__entry__2">Intel(R) Xeon(R) Silver 4216 CPU @ 2.10GHz</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="67-测试服务器配置__entry__1">逻辑 CPU 总数</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="67-测试服务器配置__entry__2">64</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="67-测试服务器配置__entry__1">内存</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="67-测试服务器配置__entry__2">503 GB</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="67-测试服务器配置__entry__1">硬盘</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="67-测试服务器配置__entry__2">SSD</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="67-测试服务器配置__entry__1">OS</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="67-测试服务器配置__entry__2">CentOS Linux release 7.9.2009 (Core)</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="67-测试服务器配置__entry__1">DolphinDB Server 版本</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="67-测试服务器配置__entry__2">2.00.9.3 2023.03.29</td></tr></tbody></table></div></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title47" id="671-50-支深交所股票一天全速并发回放性能测试"><h4 class="- topic/title title topictitle4" id="ariaid-title47">6.7.1. 50 支深交所股票一天全速并发回放性能测试</h4><div class="- topic/body body"><p class="- topic/p p">测试方法：选取深交所 2021 年 12 月 1 日 50 支交易股票数据，linux 后台同时启动多个第四章 C++ API 提交回放程序，提交多个并发回放任务。</p><ul class="- topic/ul ul"><li class="- topic/li li">回放耗时=所有回放任务最晚结束时间-所有回放任务最早收到时间</li><li class="- topic/li li">回放速率=所有用户回放数据量总和/回放耗时</li><li class="- topic/li li">平均单个用户回放耗时=（所有回放任务结束时间和-所有回放任务开始时间和）/并发数量</li><li class="- topic/li li">平均单个用户回放速率=单个用户回放数据量/平均单个用户回放耗时</li></ul><div class="table-container"><table class="- topic/table table" data-cols="7"><caption></caption><colgroup><col/><col/><col/><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="671-50-支深交所股票一天全速并发回放性能测试__entry__1">并发数量</th><th class="- topic/entry entry colsep-0 rowsep-0" id="671-50-支深交所股票一天全速并发回放性能测试__entry__2">数据源</th><th class="- topic/entry entry colsep-0 rowsep-0" id="671-50-支深交所股票一天全速并发回放性能测试__entry__3">数据量</th><th class="- topic/entry entry colsep-0 rowsep-0" id="671-50-支深交所股票一天全速并发回放性能测试__entry__4">回放耗时</th><th class="- topic/entry entry colsep-0 rowsep-0" id="671-50-支深交所股票一天全速并发回放性能测试__entry__5">回放速率</th><th class="- topic/entry entry colsep-0 rowsep-0" id="671-50-支深交所股票一天全速并发回放性能测试__entry__6">单个用户回放耗时（平均）</th><th class="- topic/entry entry colsep-0 rowsep-0" id="671-50-支深交所股票一天全速并发回放性能测试__entry__7">单个用户回放速率（平均）</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshottransactionorder</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">2,775,129行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约2.669s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约104w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约2.669s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约104w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">10</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshottransactionorder</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">27,751,290行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约10.161s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约273w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约8.482s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约32w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">20</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshottransactionorder</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">55,502,580行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约18.761s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约296w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约16.728s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约16w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">40</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshottransactionorder</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">111,005,160行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约35.537s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约312w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约19.091s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约14w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshottransaction</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">1,416,548行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约2.003s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约70w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约2.003s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约70w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">10</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshottransaction</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">14,165,480行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约7.155s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约198w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约6.382s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约22w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">20</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshottransaction</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">28,330,960行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约13.115s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约216w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约11.436s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约12w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">40</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshottransaction</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">56,661,920行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约27.003s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约210w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约13.740s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约10w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">1</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshot</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">194,045行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约1.387s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约14w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约1.387s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约14w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">10</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshot</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">1,940,450行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约6.428s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约30w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约5.128s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约4w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">20</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshot</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">3,880,900行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约11.782s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约33w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约10.539s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约2w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__1">40</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__2">snapshot</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__3">7,761,800行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__4">约23.274s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__5">约33w/s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__6">约12.393s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="671-50-支深交所股票一天全速并发回放性能测试__entry__7">约1w/s</td></tr></tbody></table></div></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title48" id="672-50-支深交所股票跨天全速回放性能测试"><h4 class="- topic/title title topictitle4" id="ariaid-title48">6.7.2. 50 支深交所股票跨天全速回放性能测试</h4><div class="- topic/body body"><p class="- topic/p p">测试方法：选取深交所 50 支交易股票数据，linux 后台启动第四章 C++ API 提交回放程序，提交多天回放任务。</p><ul class="- topic/ul ul"><li class="- topic/li li">回放耗时=回放任务结束时间-回放任务收到时间</li><li class="- topic/li li">回放速率=回放数据量/回放耗时</li></ul><div class="table-container"><table class="- topic/table table" data-cols="4"><caption></caption><colgroup><col/><col/><col/><col/></colgroup><thead class="- topic/thead thead"><tr class="- topic/row"><th class="- topic/entry entry colsep-0 rowsep-0" id="672-50-支深交所股票跨天全速回放性能测试__entry__1">数据源</th><th class="- topic/entry entry colsep-0 rowsep-0" id="672-50-支深交所股票跨天全速回放性能测试__entry__2">数据量</th><th class="- topic/entry entry colsep-0 rowsep-0" id="672-50-支深交所股票跨天全速回放性能测试__entry__3">回放耗时</th><th class="- topic/entry entry colsep-0 rowsep-0" id="672-50-支深交所股票跨天全速回放性能测试__entry__4">回放速率</th></tr></thead><tbody class="- topic/tbody tbody"><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__1">snapshottransactionorder</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__2">一天：2,775,129行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__3">约2.925s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__4">约95w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__1">snapshottransactionorder</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__2">一周：17,366,642行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__3">约16.393s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__4">约106w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__1">snapshottransaction</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__2">一天：1,416,548行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__3">约1.912s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__4">约74w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__1">snapshottransaction</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__2">一周：8,899,562行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__3">约9.142s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__4">约97w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__1">snapshot</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__2">一天：194,045行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__3">约1.267s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__4">约15w/s</td></tr><tr class="- topic/row"><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__1">snapshot</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__2">一周：1,279,869行</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__3">约6.659s</td><td class="- topic/entry entry colsep-0 rowsep-0" headers="672-50-支深交所股票跨天全速回放性能测试__entry__4">约19w/s</td></tr></tbody></table></div></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title49" id="68-开发环境配置"><h3 class="- topic/title title topictitle3" id="ariaid-title49">6.8. 开发环境配置</h3><div class="- topic/body body"></div><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title50" id="681-部署-dolphindb-server"><h4 class="- topic/title title topictitle4" id="ariaid-title50">6.8.1. 部署 DolphinDB Server</h4><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">Server 版本：2.00.9.3 2023.03.29</li><li class="- topic/li li">Server 部署模式：单服务器集群</li><li class="- topic/li li">配置文件：<em class="+ topic/ph hi-d/i ph i">cluster.cfg</em></li></ul><pre class="+ topic/pre pr-d/codeblock pre codeblock"><code>maxMemSize=128
maxConnections=5000
workerNum=24
webWorkerNum=2
chunkCacheEngineMemSize=16
newValuePartitionPolicy=add
logLevel=INFO
maxLogSize=512
node1.volumes=/ssd/ssd3/pocTSDB/volumes/node1,/ssd/ssd4/pocTSDB/volumes/node1
node2.volumes=/ssd/ssd5/pocTSDB/volumes/node2,/ssd/ssd6/pocTSDB/volumes/node2
node3.volumes=/ssd/ssd7/pocTSDB/volumes/node3,/ssd/ssd8/pocTSDB/volumes/node3
diskIOConcurrencyLevel=0
node1.redoLogDir=/ssd/ssd3/pocTSDB/redoLog/node1
node2.redoLogDir=/ssd/ssd4/pocTSDB/redoLog/node2
node3.redoLogDir=/ssd/ssd5/pocTSDB/redoLog/node3
node1.chunkMetaDir=/ssd/ssd3/pocTSDB/metaDir/chunkMeta/node1
node2.chunkMetaDir=/ssd/ssd4/pocTSDB/metaDir/chunkMeta/node2
node3.chunkMetaDir=/ssd/ssd5/pocTSDB/metaDir/chunkMeta/node3
node1.persistenceDir=/ssd/ssd6/pocTSDB/persistenceDir/node1
node2.persistenceDir=/ssd/ssd7/pocTSDB/persistenceDir/node2
node3.persistenceDir=/ssd/ssd8/pocTSDB/persistenceDir/node3
maxPubConnections=128
subExecutors=24
subThrottle=1
persistenceWorkerNum=1
node1.subPort=8825
node2.subPort=8826
node3.subPort=8827
maxPartitionNumPerQuery=200000
streamingHAMode=raft
streamingRaftGroups=2:node1:node2:node3
node1.streamingHADir=/ssd/ssd6/pocTSDB/streamingHADir/node1
node2.streamingHADir=/ssd/ssd7/pocTSDB/streamingHADir/node2
node3.streamingHADir=/ssd/ssd8/pocTSDB/streamingHADir/node3
TSDBCacheEngineSize=16
TSDBCacheEngineCompression=false
node1.TSDBRedoLogDir=/ssd/ssd3/pocTSDB/TSDBRedoLogDir/node1
node2.TSDBRedoLogDir=/ssd/ssd4/pocTSDB/TSDBRedoLogDir/node2
node3.TSDBRedoLogDir=/ssd/ssd5/pocTSDB/TSDBRedoLogDir/node3
TSDBLevelFileIndexCacheSize=20
TSDBLevelFileIndexCacheInvalidPercent=0.6
lanCluster=0
enableChunkGranularityConfig=true</code></pre><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>： 路径配置参数需要开发人员根据实际环境配置。</p><p class="- topic/p p">有关单服务器集群部署教程，请参考：<a class="- topic/xref xref" href="single_machine_cluster_deploy.html">单服务器集群部署</a>。</p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title51" id="682-dolphindb-client-开发环境"><h4 class="- topic/title title topictitle4" id="ariaid-title51">6.8.2. DolphinDB client 开发环境</h4><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">CPU 类型：Intel(R) Core(TM) i5-11500 @ 2.70GHz   2.71 GHz</li><li class="- topic/li li">逻辑 CPU 总数：12</li><li class="- topic/li li">内存：16GB</li><li class="- topic/li li">OS：Windows 11 专业版</li><li class="- topic/li li">DolphinDB GUI 版本：1.30.20.1</li></ul></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title52" id="683-dolphindb-c-api-安装"><h4 class="- topic/title title topictitle4" id="ariaid-title52">6.8.3. DolphinDB C++ API 安装</h4><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">C++ API 版本：release200.9</li></ul><p class="- topic/p p"><strong class="+ topic/ph hi-d/b ph b">注意</strong>： C++ API 版本建议按 DolphinDB server 版本选择，如 2.00.9 版本的 server 安装 release200.9 分支的 API</p><p class="- topic/p p">C++ API 教程：<a class="- topic/xref xref" href="../api/cpp/cpp_api.html">C++ API 教程</a></p></div></article><article class="- topic/topic topic nested3" aria-labelledby="ariaid-title53" id="684-dolphindb-python-api-安装"><h4 class="- topic/title title topictitle4" id="ariaid-title53">6.8.4. DolphinDB Python API 安装</h4><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">Python API 版本：1.30.21.1</li></ul><p class="- topic/p p">Python API 教程：<a class="- topic/xref xref" href="../api/python/py.html">Python API 教程</a></p></div></article></article><article class="- topic/topic topic nested2" aria-labelledby="ariaid-title54" id="69-路线图-roadmap"><h3 class="- topic/title title topictitle3" id="ariaid-title54">6.9. 路线图 (Roadmap)</h3><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li">在后续版本中，<code class="+ topic/ph pr-d/codeph ph codeph">replay</code> 函数将支持原速回放，即严格以两条记录的时间戳之差为输出间隔向下游注入数据；</li><li class="- topic/li li">在后续版本中，<code class="+ topic/ph pr-d/codeph ph codeph">replay</code> 函数将支持原速倍速回放，即严格以两条记录的时间戳之差为输出间隔进行倍速再向下游注入数据。</li></ul></div></article></article><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title55" id="7-附录"><h2 class="- topic/title title topictitle2" id="ariaid-title55">7. 附录</h2><div class="- topic/body body"><ul class="- topic/ul ul"><li class="- topic/li li"><a class="- topic/xref xref" href="script/stock_market_replay/01.stockMarketReplay.txt">股票行情回放.txt</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/stock_market_replay/02.calTradeCost_asofJoin.txt">消费场景1：计算个股交易成本 _asofJoin 实现.txt</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/stock_market_replay/03.calTradeCost_lookUpJoin.txt">消费场景1：计算个股交易成本 _lookUpJoin 实现.txt</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/stock_market_replay/04.publishToKafka.txt">消费场景2：实时推送 Kafka.txt</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/stock_market_replay/05.subscribe.cpp">消费场景3：C++API 实时订阅.cpp</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/stock_market_replay/06.cleanEnvironment.txt">清理环境.txt</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="https://www.dolphindb.cn/downloads/docs/stock_market_replay.zip" target="_blank" rel="external noopener">样例数据：order.csv, trade.csv与snapshot.csv</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="https://www.dolphindb.cn/downloads/docs/appendices_market_replay_bp_data.zip" target="_blank" rel="external noopener">原始行情数据文件</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/appendices_market_replay_bp/order_create.txt">逐笔委托建库建表脚本</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/appendices_market_replay_bp/transac_create.txt">逐笔成交建库建表脚本</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/appendices_market_replay_bp/snap_create.txt">快照建库建表脚本</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/appendices_market_replay_bp/order_upload.txt">逐笔委托示例导入脚本</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/appendices_market_replay_bp/transac_upload.txt">逐笔成交示例导入脚本</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/appendices_market_replay_bp/snap_upload.txt">快照示例导入脚本</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/appendices_market_replay_bp/replay.txt">行情回放函数</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/appendices_market_replay_bp/cpp_replay.cpp">C++ 源码</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/appendices_market_replay_bp/python_replay.py">Python 源码</a></li><li class="- topic/li li"><a class="- topic/xref xref" href="script/appendices_market_replay_bp/cpp_replay_test.cpp">C++ 测试源码</a></li></ul></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                        <nav role="navigation" id="wh_topic_toc" aria-label="On this page" class="col-lg-2 d-none d-lg-block navbar d-print-none"> 
                            <div id="wh_topic_toc_content">
		                        
	                            <div class=" wh_topic_toc "><div class="wh_topic_label">在本页上</div><ul><li class="topic-item"><a href="#1-%E5%8D%95%E8%A1%A8%E5%9B%9E%E6%94%BE" data-tocid="1-单表回放">1. 单表回放</a></li><li class="topic-item"><a href="#2-%E5%A4%9A%E8%A1%A8%E5%9B%9E%E6%94%BE" data-tocid="2-多表回放">2. 多表回放</a><ul><li class="topic-item"><a href="#21-n-%E5%AF%B9-n%E5%9B%9E%E6%94%BE" data-tocid="21-n-对-n回放">2.1. N 对 N回放</a></li><li class="topic-item"><a href="#22-n-%E5%AF%B9-1-%E5%BC%82%E6%9E%84%E5%9B%9E%E6%94%BE" data-tocid="22-n-对-1-异构回放">2.2. N 对 1 异构回放</a></li></ul></li><li class="topic-item"><a href="#3-%E5%A4%9A%E8%A1%A8%E5%9B%9E%E6%94%BE%E5%BA%94%E7%94%A8%E8%82%A1%E7%A5%A8%E8%A1%8C%E6%83%85%E5%9B%9E%E6%94%BE" data-tocid="3-多表回放应用股票行情回放">3. 多表回放应用：股票行情回放</a><ul><li class="topic-item"><a href="#31-%E8%A1%8C%E6%83%85%E5%9B%9E%E6%94%BE%E4%B8%8E%E6%B6%88%E8%B4%B9%E6%96%B9%E6%A1%88" data-tocid="31-行情回放与消费方案">3.1. 行情回放与消费方案</a></li><li class="topic-item"><a href="#32-%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E9%9B%86" data-tocid="32-测试数据集">3.2. 测试数据集</a></li><li class="topic-item"><a href="#33-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" data-tocid="33-代码实现">3.3. 代码实现</a><ul><li class="topic-item"><a href="#331-%E8%82%A1%E7%A5%A8%E8%A1%8C%E6%83%85%E5%9B%9E%E6%94%BE" data-tocid="331-股票行情回放">3.3.1. 股票行情回放</a></li><li class="topic-item"><a href="#332-%E6%B6%88%E8%B4%B9%E5%9C%BA%E6%99%AF-1%E5%9C%A8-dolphindb-%E8%AE%A2%E9%98%85%E4%B8%AD%E5%AE%9E%E6%97%B6%E8%AE%A1%E7%AE%97%E4%B8%AA%E8%82%A1%E4%BA%A4%E6%98%93%E6%88%90%E6%9C%AC" data-tocid="332-消费场景-1在-dolphindb-订阅中实时计算个股交易成本">3.3.2. 消费场景 1：在 DolphinDB 订阅中实时计算个股交易成本</a></li><li class="topic-item"><a href="#333-%E6%B6%88%E8%B4%B9%E5%9C%BA%E6%99%AF-2%E5%9C%A8-dolphindb-%E8%AE%A2%E9%98%85%E4%B8%AD%E5%B0%86%E5%9B%9E%E6%94%BE%E7%BB%93%E6%9E%9C%E5%AE%9E%E6%97%B6%E6%8E%A8%E9%80%81-kafka" data-tocid="333-消费场景-2在-dolphindb-订阅中将回放结果实时推送-kafka">3.3.3. 消费场景 2：在 DolphinDB 订阅中将回放结果实时推送 Kafka</a></li><li class="topic-item"><a href="#334-%E6%B6%88%E8%B4%B9%E5%9C%BA%E6%99%AF-3%E5%9C%A8%E5%A4%96%E9%83%A8%E7%A8%8B%E5%BA%8F%E4%B8%AD%E9%80%9A%E8%BF%87-capi-%E5%AE%9E%E6%97%B6%E8%AE%A2%E9%98%85%E4%B8%8E%E5%A4%84%E7%90%86" data-tocid="334-消费场景-3在外部程序中通过-capi-实时订阅与处理">3.3.4. 消费场景 3：在外部程序中通过 C++API 实时订阅与处理</a></li><li class="topic-item"><a href="#335-%E6%B8%85%E7%90%86%E7%8E%AF%E5%A2%83" data-tocid="335-清理环境">3.3.5. 清理环境</a></li></ul></li></ul></li><li class="topic-item"><a href="#4-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" data-tocid="4-性能测试">4. 性能测试</a></li><li class="topic-item"><a href="#5-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE" data-tocid="5-开发环境配置">5. 开发环境配置</a></li><li class="topic-item"><a href="#6-%E6%90%AD%E5%BB%BA%E8%A1%8C%E6%83%85%E5%9B%9E%E6%94%BE%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" data-tocid="6-搭建行情回放服务的最佳实践">6. 搭建行情回放服务的最佳实践</a><ul><li class="topic-item"><a href="#61-%E5%9F%BA%E4%BA%8E-dolphindb-%E7%9A%84%E8%A1%8C%E6%83%85%E5%9B%9E%E6%94%BE%E6%9C%8D%E5%8A%A1" data-tocid="61-基于-dolphindb-的行情回放服务">6.1. 基于 DolphinDB 的行情回放服务</a><ul><li class="topic-item"><a href="#611-%E8%A1%8C%E6%83%85%E5%9B%9E%E6%94%BE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84" data-tocid="611-行情回放服务架构">6.1.1. 行情回放服务架构</a></li><li class="topic-item"><a href="#612-%E5%9B%9E%E6%94%BE%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E6%AD%A5%E9%AA%A4" data-tocid="612-回放服务搭建步骤">6.1.2. 回放服务搭建步骤</a></li></ul></li><li class="topic-item"><a href="#62-%E8%A1%8C%E6%83%85%E6%95%B0%E6%8D%AE%E5%88%86%E5%8C%BA%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88" data-tocid="62-行情数据分区存储方案">6.2. 行情数据分区存储方案</a></li><li class="topic-item"><a href="#63-%E8%A1%8C%E6%83%85%E5%9B%9E%E6%94%BE%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0" data-tocid="63-行情回放自定义函数">6.3. 行情回放自定义函数</a><ul><li class="topic-item"><a href="#631-stkreplay-%E5%87%BD%E6%95%B0%E8%A1%8C%E6%83%85%E5%9B%9E%E6%94%BE%E6%9C%8D%E5%8A%A1%E4%B8%BB%E5%87%BD%E6%95%B0" data-tocid="631-stkreplay-函数行情回放服务主函数">6.3.1. stkReplay 函数：行情回放服务主函数</a></li><li class="topic-item"><a href="#632-dstb-%E5%87%BD%E6%95%B0%E6%9E%84%E9%80%A0%E5%9B%9E%E6%94%BE%E6%95%B0%E6%8D%AE%E6%BA%90" data-tocid="632-dstb-函数构造回放数据源">6.3.2. dsTb 函数：构造回放数据源</a></li><li class="topic-item"><a href="#633-replayjob-%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89%E5%9B%9E%E6%94%BE%E4%BB%BB%E5%8A%A1%E5%86%85%E5%AE%B9" data-tocid="633-replayjob-函数定义回放任务内容">6.3.3. replayJob 函数：定义回放任务内容</a></li><li class="topic-item"><a href="#634-createend-%E5%87%BD%E6%95%B0%E6%9E%84%E9%80%A0%E5%9B%9E%E6%94%BE%E7%BB%93%E6%9D%9F%E4%BF%A1%E5%8F%B7" data-tocid="634-createend-函数构造回放结束信号">6.3.4. createEnd 函数：构造回放结束信号</a></li><li class="topic-item"><a href="#635-%E5%B0%81%E8%A3%85%E5%87%BD%E6%95%B0%E8%A7%86%E5%9B%BE" data-tocid="635-封装函数视图">6.3.5. 封装函数视图</a></li></ul></li><li class="topic-item"><a href="#64-api-%E6%8F%90%E4%BA%A4%E5%9B%9E%E6%94%BE" data-tocid="64-api-提交回放">6.4. API 提交回放</a><ul><li class="topic-item"><a href="#641-c-api" data-tocid="641-c-api">6.4.1. C++ API</a><ul><li class="topic-item"><a href="#6411-c-api-%E8%B0%83%E7%94%A8%E5%9B%9E%E6%94%BE%E6%9C%8D%E5%8A%A1" data-tocid="6411-c-api-调用回放服务">6.4.1.1. C++ API 调用回放服务</a></li></ul></li><li class="topic-item"><a href="#642-python-api" data-tocid="642-python-api">6.4.2. Python API</a><ul><li class="topic-item"><a href="#6421-python-api-%E8%B0%83%E7%94%A8%E5%9B%9E%E6%94%BE%E6%9C%8D%E5%8A%A1" data-tocid="6421-python-api-调用回放服务">6.4.2.1. Python API 调用回放服务</a></li></ul></li></ul></li><li class="topic-item"><a href="#65-api-%E8%AE%A2%E9%98%85%E6%B6%88%E8%B4%B9" data-tocid="65-api-订阅消费">6.5. API 订阅消费</a><ul><li class="topic-item"><a href="#651-c-api" data-tocid="651-c-api">6.5.1. C++ API</a><ul><li class="topic-item"><a href="#6511-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8%E6%9E%84%E9%80%A0" data-tocid="6511-反序列化器构造">6.5.1.1. 反序列化器构造</a></li><li class="topic-item"><a href="#6512-%E8%AE%A2%E9%98%85%E5%9B%9E%E6%94%BE%E6%9C%8D%E5%8A%A1" data-tocid="6512-订阅回放服务">6.5.1.2. 订阅回放服务</a></li><li class="topic-item"><a href="#6513-%E6%B6%88%E8%B4%B9%E5%87%BD%E6%95%B0%E6%9E%84%E9%80%A0" data-tocid="6513-消费函数构造">6.5.1.3. 消费函数构造</a></li><li class="topic-item"><a href="#6514-%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C" data-tocid="6514-程序执行">6.5.1.4. 程序执行</a></li><li class="topic-item"><a href="#6515-%E6%B6%88%E8%B4%B9%E8%BE%93%E5%87%BA" data-tocid="6515-消费输出">6.5.1.5. 消费输出</a></li></ul></li><li class="topic-item"><a href="#652-python-api" data-tocid="652-python-api">6.5.2. Python API</a><ul><li class="topic-item"><a href="#6521-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8%E6%9E%84%E9%80%A0" data-tocid="6521-反序列化器构造">6.5.2.1. 反序列化器构造</a></li><li class="topic-item"><a href="#6522-python-api-%E8%AE%A2%E9%98%85%E5%9B%9E%E6%94%BE%E6%9C%8D%E5%8A%A1" data-tocid="6522-python-api-订阅回放服务">6.5.2.2. Python API 订阅回放服务</a></li><li class="topic-item"><a href="#6523-%E6%B6%88%E8%B4%B9%E5%87%BD%E6%95%B0%E6%9E%84%E9%80%A0" data-tocid="6523-消费函数构造">6.5.2.3. 消费函数构造</a></li><li class="topic-item"><a href="#6524-%E6%B6%88%E8%B4%B9%E8%BE%93%E5%87%BA" data-tocid="6524-消费输出">6.5.2.4. 消费输出</a></li></ul></li></ul></li><li class="topic-item"><a href="#66-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" data-tocid="66-性能测试">6.6. 性能测试</a></li><li class="topic-item"><a href="#67-%E6%B5%8B%E8%AF%95%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE" data-tocid="67-测试服务器配置">6.7. 测试服务器配置</a><ul><li class="topic-item"><a href="#671-50-%E6%94%AF%E6%B7%B1%E4%BA%A4%E6%89%80%E8%82%A1%E7%A5%A8%E4%B8%80%E5%A4%A9%E5%85%A8%E9%80%9F%E5%B9%B6%E5%8F%91%E5%9B%9E%E6%94%BE%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" data-tocid="671-50-支深交所股票一天全速并发回放性能测试">6.7.1. 50 支深交所股票一天全速并发回放性能测试</a></li><li class="topic-item"><a href="#672-50-%E6%94%AF%E6%B7%B1%E4%BA%A4%E6%89%80%E8%82%A1%E7%A5%A8%E8%B7%A8%E5%A4%A9%E5%85%A8%E9%80%9F%E5%9B%9E%E6%94%BE%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" data-tocid="672-50-支深交所股票跨天全速回放性能测试">6.7.2. 50 支深交所股票跨天全速回放性能测试</a></li></ul></li><li class="topic-item"><a href="#68-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE" data-tocid="68-开发环境配置">6.8. 开发环境配置</a><ul><li class="topic-item"><a href="#681-%E9%83%A8%E7%BD%B2-dolphindb-server" data-tocid="681-部署-dolphindb-server">6.8.1. 部署 DolphinDB Server</a></li><li class="topic-item"><a href="#682-dolphindb-client-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83" data-tocid="682-dolphindb-client-开发环境">6.8.2. DolphinDB client 开发环境</a></li><li class="topic-item"><a href="#683-dolphindb-c-api-%E5%AE%89%E8%A3%85" data-tocid="683-dolphindb-c-api-安装">6.8.3. DolphinDB C++ API 安装</a></li><li class="topic-item"><a href="#684-dolphindb-python-api-%E5%AE%89%E8%A3%85" data-tocid="684-dolphindb-python-api-安装">6.8.4. DolphinDB Python API 安装</a></li></ul></li><li class="topic-item"><a href="#69-%E8%B7%AF%E7%BA%BF%E5%9B%BE-roadmap" data-tocid="69-路线图-roadmap">6.9. 路线图 (Roadmap)</a></li></ul></li><li class="topic-item"><a href="#7-%E9%99%84%E5%BD%95" data-tocid="7-附录">7. 附录</a></li></ul></div>
	                        	
                        	</div>
                        </nav>
                    
                </div>
            </div>
            
            
            
        </div> 
        <footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
<title>Copyright</title><p><b> ©2024 浙江智臾科技有限公司 浙ICP备18048711号-3</b></p>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>